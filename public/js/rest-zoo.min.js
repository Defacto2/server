/* rest-zoo.min.js */
(()=>{"use strict";const T=t=>`${location.protocol}//${location.host}/zoo/prod/${t}`,m=document.getElementById("demozooProdID"),c=document.getElementById("demozooProd"),d=document.getElementById("demozooProdTitle"),f=document.getElementById("demozooProdAuthors"),a=document.getElementById("demozooProdPlat"),p=document.getElementById("demozooProdDate"),o=document.getElementById("demozooProdInvalid"),E=document.getElementById("demozooProdReset"),i=document.getElementById("demozooSubmit"),s="d-none",l="This prod id is not valid",y=999999,v=500;let h=null;m.addEventListener("input",x),m.addEventListener("paste",t=>{u(),g(t)}),E.addEventListener("click",u),i.addEventListener("click",function(t){document.getElementById("demozooProdUploader").submit()});function x(t){clearTimeout(h),u(),t.target.value!==""&&(c.classList.remove(s),d.innerText=`Will lookup ${t.target.value}...`),h=setTimeout(()=>{g(t)},v)}function g(t){const e=t.target.value;if(e===""){i.disabled=!0;return}const n=e.match(/\d+/g);if(n===null){o.classList.remove(s),o.innerText=l;return}const r=n.map(Number);if(r.length!==0){if(r[0]>y){o.classList.remove(s),o.innerText=l;return}t.target.value=r[0],b(r[0])}}function u(){i.disabled=!0,c.classList.add(s),o.classList.add(s),d.innerText="",f.innerText="",a.innerText="",p.innerText=""}function b(t){console.info(`Requesting the Demozoo API for production #${t}`),fetch(T(t),{method:"GET",headers:{"Content-Type":"application/json charset=UTF-8"}}).then(e=>{if(!e.ok){if(i.disabled=!0,o.classList.remove(s),e.status===404){o.innerText=l+` ${t}`;return}const n="A network error occurred requesting API";throw o.innerText=`${n}: ${e.statusText}`,new Error(`${n}: ${e.statusText} ${e.status}`)}return e.json()}).then(e=>{d.innerText=e.title,f.innerText=z(e.author_nicks),a.innerText=I(e.platforms),a.innerText===""&&e.supertype==="graphics"&&(a.innerText="graphic or image"),p.innerText="from "+e.release_date,c.classList.remove(s);const n=P(e);n!==""&&(i.disabled=!0,o.classList.remove(s),o.innerText=n),i.disabled=!1}).catch(e=>{typeof e>"u"||console.error(e)})}function z(t){if(t===null)return"";let e=[];return t.forEach(n=>{n.releaser.is_group&&e.push(n.releaser.name)}),e.length===0?"":"by "+e.join(" + ")}function I(t){if(t===null)return"";let e=[];return t.forEach(n=>{e.push(n.name)}),e.length===0?"":"for "+e.join(" + ")}function P(t){if(t===null)return"result error is null";switch(t.supertype){case"production":break;case"graphics":return"";default:return`production type ${t.supertype} is not allowed`}let e=[];if(t.platforms.forEach(r=>{switch(r.id){case 1:case 4:case 7:case 10:case 46:case 48:case 84:case 94:e.push(r.name);break}}),e.length===0)return"platform is not allowed";let n=[];return t.types.forEach(r=>{switch(r.id){case 1:case 4:case 5:case 6:case 9:case 13:case 23:case 24:case 25:case 26:case 27:case 34:case 36:case 41:case 47:case 49:case 51:n.push(r.name);break}}),n.length===0?"production type is not allowed":""}})();
