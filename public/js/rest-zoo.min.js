/* rest-zoo.min.js */
(()=>{"use strict";const E=e=>`${location.protocol}//${location.host}/zoo/prod/${e}`,u=document.getElementById("demozooProdID"),c=document.getElementById("demozooProd"),a=document.getElementById("demozooProdTitle"),m=document.getElementById("demozooProdAuthors"),i=document.getElementById("demozooProdPlat"),p=document.getElementById("demozooProdDate"),r=document.getElementById("demozooProdInvalid"),T=document.getElementById("demozooProdReset"),d=document.getElementById("demozooSubmit"),s="d-none",f="This prod id is not valid",y=999999,v=500;let h=null;u.addEventListener("input",x),u.addEventListener("paste",e=>{l(),g(e)}),T.addEventListener("click",l),d.addEventListener("click",function(e){document.getElementById("demozooProdUploader").submit()});function x(e){clearTimeout(h),l(),e.target.value!==""&&(c.classList.remove(s),a.innerText=`Will lookup ${e.target.value}...`),h=setTimeout(()=>{g(e)},v)}function g(e){const t=e.target.value;if(t===""){d.disabled=!0;return}const n=t.match(/\d+/g);if(n===null){r.classList.remove(s),r.innerText=f;return}const o=n.map(Number);if(o.length!==0){if(o[0]>y){r.classList.remove(s),r.innerText=f;return}e.target.value=o[0],I(o[0])}}function l(){c.classList.add(s),r.classList.add(s),a.innerText="",m.innerText="",i.innerText="",p.innerText=""}function I(e){console.info(`Requesting the Demozoo API for production #${e}`),fetch(E(e),{method:"GET",headers:{"Content-Type":"application/json charset=UTF-8"}}).then(t=>{if(!t.ok){const n="A network error occurred requesting API";throw new Error(`${n}: ${t.statusText} ${t.status}`)}return t.json()}).then(t=>{a.innerText=t.title,m.innerText=z(t.author_nicks),i.innerText=P(t.platforms),i.innerText===""&&t.supertype==="graphics"&&(i.innerText="graphic or image"),p.innerText="from "+t.release_date,c.classList.remove(s);const n=b(t);n!==""&&(d.disabled=!0,r.classList.remove(s),r.innerText=n)})}function z(e){if(e===null)return"";let t=[];return e.forEach(n=>{n.releaser.is_group&&t.push(n.releaser.name)}),t.length===0?"":"by "+t.join(" + ")}function P(e){if(e===null)return"";let t=[];return e.forEach(n=>{t.push(n.name)}),t.length===0?"":"for "+t.join(" + ")}function b(e){if(e===null)return"result error is null";switch(e.supertype){case"production":break;case"graphics":return"";default:return`production type ${e.supertype} is not allowed`}let t=[];if(e.platforms.forEach(o=>{switch(o.id){case 1:case 4:case 7:case 10:case 46:case 48:case 84:case 94:t.push(o.name);break}}),t.length===0)return"platform is not allowed";let n=[];return e.types.forEach(o=>{switch(o.id){case 1:case 4:case 5:case 6:case 9:case 13:case 23:case 24:case 25:case 26:case 27:case 34:case 36:case 41:case 47:case 49:case 51:n.push(o.name);break}}),n.length===0?"production type is not allowed":""}})();
