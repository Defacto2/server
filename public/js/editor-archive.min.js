/* editor-archive.min.js Â© Defacto2 2024 */
(()=>{"use strict";const L="text-danger",t="is-invalid",n="is-valid",y="valid-feedback",g="invalid-feedback",l={"Content-type":"application/json; charset=UTF-8"},m="server could not save the change",c=document.getElementById("recordID");if(c==null){console.info("the editor modal is not open so the editor archive script is not needed");return}const s=document.getElementById("edCopyMe");if(s==null){console.info("this file artifact is a single-file so the editor archive script is not needed");return}s.addEventListener("input",function(){if(s.classList.remove(t),s.classList.remove(n),s.value=="")return;const r=document.getElementById("edCopyMeList");if(!Array.from(r.options).some(o=>o.value===s.value)){s.classList.add(t),document.getElementById("edCopyMeErr").textContent="unknown filename",r.classList.remove(t);return}fetch("/editor/readme/copy",{method:"POST",body:JSON.stringify({id:parseInt(c.value),target:s.value}),headers:l}).then(o=>{if(!o.ok)throw new Error(m);return s.classList.add(n),o.json()}).catch(o=>{document.getElementById("edCopyMeErr").textContent=o.message,r.classList.add(t)})}),document.getElementById("edCopyMeReset").addEventListener("click",function(){s.value="",s.classList.remove(t),s.classList.remove(n),a.classList.remove(t),a.classList.remove(n),document.getElementById("edCopyMeList").classList.remove(t)});const a=document.getElementById("edHideMe");a.checked==!0&&(document.getElementById("edHideMeLabel").classList.add(L),s.disabled=!0),a.addEventListener("change",function(){const r=document.getElementById("edHideMeLabel");a.checked==!0?(r.classList.add(L),s.disabled=!0):(r.classList.remove(L),s.disabled=!1),fetch("/editor/readme/hide",{method:"POST",body:JSON.stringify({id:parseInt(c.value),readme:a.checked}),headers:l}).then(e=>{if(!e.ok)throw new Error(m);return a.classList.add(n),e.json()}).catch(e=>{document.getElementById("edHideMeErr").textContent=e.message,a.classList.add(t)})});const d=document.getElementById("edCopyPreview"),u=document.getElementById("edCopyPreviewList"),E=document.getElementById("edCopyPreviewBtn");d.addEventListener("input",function(){d.classList.remove(t),d.classList.remove(n),d.value!=""}),E.addEventListener("click",function(){if(!Array.from(u.options).some(e=>e.value===d.value)){d.classList.add(t),document.getElementById("edCopyPreviewErr").textContent="unknown filename",u.classList.remove(t);return}fetch("/editor/images/copy",{method:"POST",body:JSON.stringify({id:parseInt(c.value),target:d.value}),headers:l}).then(e=>{if(console.log(e),!e.ok)throw console.log("not ok"),new Error(m);return d.classList.add(n),e.json()}).catch(e=>{console.log(e),document.getElementById("edCopyPreviewErr").textContent=e.message,u.classList.add(t)})}),document.getElementById("edCopyPreviewReset").addEventListener("click",function(){d.value="",d.classList.remove(t),d.classList.remove(n),document.getElementById("edCopyPreviewErr").textContent="",u.classList.remove(t)});const i=document.getElementById("edAnsiLove"),v=document.getElementById("edAnsiLoveList"),h=document.getElementById("edAnsiLoveBtn");i.addEventListener("input",function(){i.classList.remove(t),i.classList.remove(n),i.value!=""}),h.addEventListener("click",function(){if(!Array.from(v.options).some(e=>e.value===i.value)){i.classList.add(t),document.getElementById("edAnsiLoveErr").textContent="unknown filename",v.classList.remove(t);return}fetch("/editor/ansilove/copy",{method:"POST",body:JSON.stringify({id:parseInt(c.value),target:i.value}),headers:l}).then(e=>{if(console.log(e),!e.ok)throw console.log("not ok"),new Error(m);return i.classList.add(n),e.json()}).catch(e=>{console.log(e),document.getElementById("edAnsiLoveErr").textContent=e.message,v.classList.add(t)})}),document.getElementById("edAnsiLoveReset").addEventListener("click",function(){i.value="",i.classList.remove(t),i.classList.remove(n),document.getElementById("edAnsiLoveErr").textContent="",v.classList.remove(t)});const f=document.getElementById("asset-editor-delete-text");f.disabled=!1,f.addEventListener("click",function(){if(!window.confirm("Delete the readme or textfile?"))return;const r=document.getElementById("asset-editor-hidden"),e=document.getElementById("asset-editor-feedback");fetch("/editor/readme/delete",{method:"POST",body:JSON.stringify({id:parseInt(c.value)}),headers:l}).then(o=>{if(!o.ok)throw new Error(m);return r.classList.add(n),e.classList.add(y),e.textContent="readme or textfile deleted, refresh the page to see the change",o.json()}).catch(o=>{r.classList.add(t),e.classList.add(g),e.textContent=o.message,console.log(o)})})})();
