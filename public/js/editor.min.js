/* editor.min.js © Defacto2 2024 */
(()=>{"use strict";const h="text-danger",e="is-invalid",d="is-valid",T="d-none",y={"Content-type":"application/json; charset=UTF-8"},O="server could not save the change",b=document.getElementById("recordID");if(b==null){console.info("the editor modal is not open so the editor script is not needed");return}const B=document.getElementById("recordOnline"),k=document.getElementById("recordOnlineLabel");B==null?console.info("the online checkbox is not present"):k==null?console.info("the online checkbox label is not present"):(B.checked!=!0&&k.classList.add(h),B.addEventListener("change",()=>{let t="/editor/online/false";B.checked==!0&&(t="/editor/online/true"),fetch(t,{method:"POST",body:JSON.stringify({id:parseInt(b.value)}),headers:y}).then(s=>{if(!s.ok)throw new Error(O);return B.checked==!0?k.classList.remove(h):k.classList.add(h),s.json()}).catch(s=>{B.checked=!B.checked,console.info(`the artifact online status could not be saved: ${s.message}`)})}));const L=document.getElementById("recordTitle");L==null?console.info("the record title is not present"):L.addEventListener("input",()=>{const t=document.getElementById("recordTitleErr");if(t==null){console.info("the record title error is not present");return}const s=document.getElementById("recordTitleOG");if(s==null){console.info("the record title original label is not present");return}const c=document.getElementById("recordTitleOGValue").textContent;if(c==null){console.info("the record title original value is not present");return}L.value!=c&&L.value.length>0?s.classList.remove(T):s.classList.add(T),L.classList.remove(e),t.classList.add(T),fetch("/editor/title",{method:"POST",body:JSON.stringify({id:parseInt(b.value),value:L.value}),headers:y}).then(f=>{if(!f.ok)throw new Error(O);return t.classList.add(T),L.classList.remove(e),L.classList.add(d),f.json()}).catch(f=>{t.classList.remove(T),L.classList.add(e),L.value=c,console.info(`the title could not be saved: ${f.message}`)})});const v=document.getElementById("recordReleasers");v==null?console.info("the record releasers is not present"):v.addEventListener("input",function(){if(v.value=v.value.toUpperCase(),v.value=v.value.replace(/[^a-zA-Z0-9-+& ]/g,""),v.value==""){v.classList.add(e);return}v.classList.remove(e);const t=document.getElementById("recordReleasersMax");if(t==null){console.info("the record releasers max is not present");return}if(v.value.split("+").length>2){v.classList.add(e),t.classList.add(h);return}v.classList.remove(e),t.classList.remove(h),fetch("/editor/releasers",{method:"POST",body:JSON.stringify({id:parseInt(b.value),value:v.value}),headers:y}).then(f=>{if(!f.ok)throw new Error(O);return f.json()}).catch(f=>{console.info(`the title could not be saved: ${f.message}`)})});const $=document.getElementById("recordLMBtn");$==null?console.info("the last modification button is not present"):$.addEventListener("click",function(){l.classList.remove(e),a.classList.remove(e),n.classList.remove(e),l.classList.remove(d),a.classList.remove(d),n.classList.remove(d);const t=document.getElementById("recordLastMod").value.split("-");if(t.length!=3){console.error("invalid last modified date provided by server");return}l.value=t[0],a.value=t[1],n.value=t[2]});const i=document.getElementById("recordYMDSave");i==null?console.info("the record ymd save button is not present"):i.addEventListener("click",function(){l.classList.remove(d),a.classList.remove(d),n.classList.remove(d),fetch("/editor/ymd",{method:"POST",body:JSON.stringify({id:parseInt(b.value),year:parseInt(l.value),month:parseInt(a.value),day:parseInt(n.value)}),headers:y}).then(t=>{if(!t.ok)throw new Error(O);return l.classList.add(d),a.classList.add(d),n.classList.add(d),i.classList.remove(h),t.json()}).catch(t=>{i.classList.add(h),console.info(`the ymd could not be saved: ${t.message}`)})});const z=document.getElementById("recordYMDReset");z==null||i==null?console.info("the record ymd reset button is not present or usable"):z.addEventListener("click",function(){const t=document.getElementById("recordOgY").value,s=document.getElementById("recordOgM").value,c=document.getElementById("recordOgD").value;l.value=t,a.value=s,n.value=c,l.classList.remove(e),a.classList.remove(e),n.classList.remove(e),l.classList.remove(d),a.classList.remove(d),n.classList.remove(d),i.disabled=!1});const l=document.getElementById("recordYear");l==null||i==null?console.info("the record year is not present or usable"):l.addEventListener("input",function(){if(l.value>=1980&&l.value<=2023){l.classList.remove(e),i.disabled=!1;return}if(l==null||a==null||n==null){console.info("the record year, month, or day is not present");return}if(l.value==""&&a.value==""&&n.value==""){l.classList.remove(e),a.classList.remove(e),n.classList.remove(e),i.disabled=!1;return}l.classList.add(e),i.disabled=!0});const a=document.getElementById("recordMonth");a==null||i==null?console.info("the record month is not present or usable"):a.addEventListener("input",function(){if(a.value>=1&&a.value<=12){a.classList.remove(e),i.disabled=!1;return}if(l==null||a==null||n==null){console.info("the record year, month, or day is not present");return}if(l.value==""&&a.value==""&&n.value==""){l.classList.remove(e),a.classList.remove(e),n.classList.remove(e),i.disabled=!1;return}if(a.value==""&&n.value==""){a.classList.remove(e),n?.classList.remove(e),i.disabled=!1;return}a.classList.add(e),i.disabled=!0});const n=document.getElementById("recordDay");n==null||i==null?console.info("the record day is not present or usable"):n.addEventListener("input",function(){if(n.value>=1&&n.value<=31){n.classList.remove(e),i.disabled=!1;return}if(l==null||a==null||n==null){console.info("the record year, month, or day is not present");return}if(l.value==""&&a.value==""&&n.value==""){l.classList.remove(e),a.classList.remove(e),n.classList.remove(e),i.disabled=!1;return}if(a.value==""&&n.value==""){a.classList.remove(e),n.classList.remove(e),i.disabled=!1;return}if(n.value==""){n.classList.remove(e),i.disabled=!1;return}n.classList.add(e),i.disabled=!0});function x(t){let s=t;return s=s.toLowerCase(),s=s.replace(/[^A-Za-z0-9À-ÖØ-öø-ÿ\s,]/g,""),s}const S=document.getElementById("recordArtist"),R=document.getElementById("recordCoder"),j=document.getElementById("recordMusic"),N=document.getElementById("recordWriter");S.addEventListener("input",function(){S.value=x(S.value)}),R.addEventListener("input",function(){R.value=x(R.value)}),j.addEventListener("input",function(){j.value=x(j.value)}),N.addEventListener("input",function(){N.value=x(N.value)});const u=document.getElementById("recordDemozoo");u.addEventListener("paste",function(){setTimeout(()=>{try{if(new URL(`${u.value}`).hostname!="demozoo.org"){u.classList.add(e);return}}catch{return}try{const c=new URL(`${u.value}`).pathname.split("/").filter(Boolean);if(c.length!=2){u.classList.add(e);return}switch(c[0]){case"productions":u.value=c[1];break;case"graphics":u.value=c[1];break;default:u.classList.add(e);return}u.classList.remove(e)}catch{u.classList.add(e)}},0)}),u.addEventListener("input",function(){const t=Number(u.value);if(isNaN(t)){u.classList.add(e);return}if(t<0||t>999999){u.classList.add(e);return}t==0&&(u.value=""),u.classList.remove(e)});const m=document.getElementById("recordPouet");m.addEventListener("paste",function(){setTimeout(()=>{try{const t=new URL(`${m.value}`);if(console.log(t.hostname),t.hostname!="www.pouet.net"){m.classList.add(e);return}}catch{return}try{const t=new URL(`${m.value}`);if(t.pathname!="/prod.php"){m.classList.add(e);return}const f=new URLSearchParams(t.search).get("which");m.value=f,m.classList.remove(e)}catch{m.classList.add(e)}},0)}),m.addEventListener("input",function(){const t=Number(m.value);if(isNaN(t)){m.classList.add(e);return}if(t<0||t>199999){m.classList.add(e);return}t==0&&(m.value=""),m.classList.remove(e)});const p=document.getElementById("record16colors");p.addEventListener("paste",function(){setTimeout(()=>{try{const t=new URL(`${p.value}`);if(t.hostname!="16colo.rs"){p.classList.add(e);return}const s=t.pathname;p.value=s,p.classList.remove(e)}catch{}},0)}),p.addEventListener("input",function(){if(p.value==""){p.classList.remove(e);return}});const E=document.getElementById("recordGitHub");E.addEventListener("paste",function(){setTimeout(()=>{try{const t=new URL(`${E.value}`);if(t.hostname!="github.com"){E.classList.add(e);return}const s=t.pathname;E.value=s,E.classList.remove(e)}catch{}},0)}),E.addEventListener("input",function(){if(E.value==""){E.classList.remove(e);return}});const g=document.getElementById("recordYouTube");g.addEventListener("paste",function(){setTimeout(()=>{try{const t=new URL(`${g.value}`);if(t.hostname!="youtube.com"&&t.hostname!="www.youtube.com"){g.classList.add(e);return}const c=new URLSearchParams(t.search).get("v");g.value=c,E.classList.remove(e)}catch{}},0)}),g.addEventListener("input",function(){setTimeout(()=>{if(g.value==""){g.classList.remove(e);return}if(new RegExp("^[a-zA-Z0-9_-]{11}$").test(g.value)){g.classList.remove(e);return}g.classList.add(e)},0)});const w=document.getElementById("recordFilename");w.addEventListener("input",function(){if(w.value=w.value.trimStart(),w.value==""){w.classList.add(e);return}w.classList.remove(e)});const r=document.getElementById("recordPlatform");r.addEventListener("change",function(t){r.classList.remove(e);const s=t.target.value;if(s.length==0){r.classList.add(e);return}C(s)});function C(t){fetch("/editor/platform",{method:"POST",body:JSON.stringify({id:parseInt(b.value),value:t}),headers:y}).then(s=>{if(!s.ok)throw new Error(O);return r.classList.remove(e),r.classList.add(d),s.json()}).catch(s=>{r.classList.remove(d),r.classList.add(h),console.log(s.message)}),U(t,o.value)}const o=document.getElementById("recordTag");o.addEventListener("change",function(t){const s=t.target.value;P(s)});function P(t){if(o.classList.remove(e),U(r.value,t),A(t),t.length==0){o.classList.add(e),o.value="";return}fetch("/editor/tag",{method:"POST",body:JSON.stringify({id:parseInt(b.value),value:t}),headers:y}).then(s=>{if(!s.ok)throw new Error(O);return o.classList.remove(e),o.classList.add(d),s.json()}).catch(s=>{o.classList.remove(d),o.classList.add(h),document.getElementById("tagInfo").textContent="",console.log(s.message)})}function U(t,s){fetch("/editor/platform+tag",{method:"POST",body:JSON.stringify({platform:t,tag:s}),headers:y}).then(c=>c.text()).then(c=>{document.getElementById("platformTagInfo").textContent=c})}function A(t){fetch("/editor/tag/info",{method:"POST",body:JSON.stringify({tag:t}),headers:y}).then(s=>s.text()).then(s=>{document.getElementById("tagInfo").textContent=s})}document.getElementById("recTagsReset").addEventListener("click",function(){const t=document.getElementById("recOSOg").value,s=document.getElementById("recTagOg").value;r.value=t,o.value=s,r.classList.remove(e),o.classList.remove(e),r.value.length==0&&r.classList.add(e),o.value.length==0&&o.classList.add(e),C(t),P(s)});const D=document.getElementById("recordReleasersLabel"),J=document.getElementById("recordTitleLabel");o.addEventListener("change",function(){setTimeout(()=>{if(o.value=="magazine"){M();return}I()},0)});function M(){D.textContent="Magazine",J.textContent="Issue"}function I(){D.textContent="Releasers",J.textContent="Title"}document.getElementById("recordDosText").addEventListener("click",function(){C("text"),P(""),I()}),document.getElementById("recordAmigaText").addEventListener("click",function(){r.value="textamiga",r.classList.remove(e),o.value="",o.classList.add(e),I()}),document.getElementById("recordProof").addEventListener("click",function(){r.value="image",r.classList.remove(e),o.value="releaseproof",o.classList.remove(e),I()}),document.getElementById("recordDostro").addEventListener("click",function(){r.value="dos",r.classList.remove(e),o.value="releaseadvert",o.classList.remove(e),I()}),document.getElementById("recordWintro").addEventListener("click",function(){r.value="windows",r.classList.remove(e),o.value="releaseadvert",o.classList.remove(e),I()}),document.getElementById("recordBBStro").addEventListener("click",function(){r.value="dos",r.classList.remove(e),o.value="bbs",o.classList.remove(e),I()}),document.getElementById("recordBBSAnsi").addEventListener("click",function(){r.value="ansi",r.classList.remove(e),o.value="bbs",o.classList.remove(e),I()}),document.getElementById("recordTextMag").addEventListener("click",function(){r.value="text",o.value="magazine",M()}),document.getElementById("recordDosMag").addEventListener("click",function(){r.value="dos",r.classList.remove(e),o.value="magazine",o.classList.remove(e),M()}),document.getElementById("recordReset")==null&&console.info("the editor reset button is not present")})();
