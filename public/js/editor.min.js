/* editor.min.js © Defacto2 2024 */
(()=>{"use strict";const f="text-danger",e="is-invalid",d="is-valid",O="d-none",y={"Content-type":"application/json; charset=UTF-8"},T="server could not save the change",I=document.getElementById("recordID");if(I==null){console.info("the editor modal is not open so the editor script is not needed");return}let i=document.getElementById("recordOnline"),w=document.getElementById("recordOnlineLabel");i==null?console.info("the online checkbox is not present"):w==null?console.info("the online checkbox label is not present"):(i.checked!=!0&&w.classList.add(f),i.addEventListener("change",()=>{let t="/editor/online/false";i.checked==!0&&(t="/editor/online/true"),fetch(t,{method:"POST",body:JSON.stringify({id:parseInt(I.value)}),headers:y}).then(s=>{if(!s.ok)throw new Error(T);return i.checked==!0?w.classList.remove(f):w.classList.add(f),s.json()}).catch(s=>{i.checked=!i.checked,console.info(`the artifact online status could not be saved: ${s.message}`)})})),i=document.getElementById("recordTitle"),i==null?console.info("the record title is not present"):i.addEventListener("input",()=>{const t=document.getElementById("recordTitleErr");if(t==null){console.info("the record title error is not present");return}const s=document.getElementById("recordTitleOG");if(s==null){console.info("the record title original label is not present");return}const u=document.getElementById("recordTitleOGValue").textContent;if(u==null){console.info("the record title original value is not present");return}i.value!=u&&i.value.length>0?s.classList.remove(O):s.classList.add(O),i.classList.remove(e),t.classList.add(O),console.info(`id ${I.value} title ${i.value} headers ${y}`),fetch("/editor/title",{method:"POST",body:JSON.stringify({id:parseInt(I.value),value:i.value}),headers:y}).then(b=>{if(!b.ok)throw new Error(T);return t.classList.add(O),i.classList.remove(e),i.classList.add(d),b.json()}).catch(b=>{t.classList.remove(O),i.classList.add(e),i.value=u,console.info(`the title could not be saved: ${b.message}`)})}),i=document.getElementById("recordLMBtn"),i==null?console.info("the last modification button is not present"):i.addEventListener("click",function(){c.classList.remove(e),l.classList.remove(e),n.classList.remove(e),c.classList.remove(d),l.classList.remove(d),n.classList.remove(d);const t=document.getElementById("recordLastMod").value.split("-");if(t.length!=3){console.error("invalid last modified date provided by server");return}c.value=t[0],l.value=t[1],n.value=t[2]});const a=document.getElementById("recordYMDSave");a==null?console.info("the record ymd save button is not present"):a.addEventListener("click",function(){c.classList.remove(d),l.classList.remove(d),n.classList.remove(d),fetch("/editor/ymd",{method:"POST",body:JSON.stringify({id:parseInt(I.value),year:parseInt(c.value),month:parseInt(l.value),day:parseInt(n.value)}),headers:y}).then(t=>{if(!t.ok)throw new Error(T);return c.classList.add(d),l.classList.add(d),n.classList.add(d),a.classList.remove(f),t.json()}).catch(t=>{a.classList.add(f),console.info(`the ymd could not be saved: ${t.message}`)})}),i=document.getElementById("recordYMDReset"),i==null?console.info("the record ymd reset button is not present"):i.addEventListener("click",function(){const t=document.getElementById("recordOgY").value,s=document.getElementById("recordOgM").value,u=document.getElementById("recordOgD").value;c.value=t,l.value=s,n.value=u,c.classList.remove(e),l.classList.remove(e),n.classList.remove(e),c.classList.remove(d),l.classList.remove(d),n.classList.remove(d),a!=null&&(a.disabled=!1)});const c=document.getElementById("recordYear");c==null?console.info("the record year is not present"):c.addEventListener("input",function(){if(c.value>=1980&&c.value<=2023){c.classList.remove(e),a!=null&&(a.disabled=!1);return}if(c==null||l==null||n==null){console.info("the record year, month, or day is not present");return}if(c.value==""&&l.value==""&&n.value==""){c.classList.remove(e),l.classList.remove(e),n.classList.remove(e),a!=null&&(a.disabled=!1);return}c.classList.add(e),a!=null&&(a.disabled=!0)});const l=document.getElementById("recordMonth");l==null?console.info("the record month is not present"):l.addEventListener("input",function(){if(l.value>=1&&l.value<=12){l.classList.remove(e),a!=null&&(a.disabled=!1);return}if(c==null||l==null||n==null){console.info("the record year, month, or day is not present");return}if(c.value==""&&l.value==""&&n.value==""){c.classList.remove(e),l.classList.remove(e),n.classList.remove(e),a!=null&&(a.disabled=!1);return}if(l.value==""&&n.value==""){l.classList.remove(e),n?.classList.remove(e),a!=null&&(a.disabled=!1);return}l.classList.add(e),a!=null&&(a.disabled=!0)});const n=document.getElementById("recordDay");n==null?console.info("the record day is not present"):n.addEventListener("input",function(){if(n.value>=1&&n.value<=31){n.classList.remove(e),a!=null&&(a.disabled=!1);return}if(c==null||l==null||n==null){console.info("the record year, month, or day is not present");return}if(c.value==""&&l.value==""&&n.value==""){c.classList.remove(e),l.classList.remove(e),n.classList.remove(e),a.disabled=!1;return}if(l.value==""&&n.value==""){l.classList.remove(e),n.classList.remove(e),a!=null&&(a.disabled=!1);return}if(n.value==""){n.classList.remove(e),a!=null&&(a.disabled=!1);return}n.classList.add(e),a!=null&&(a.disabled=!0)});const L=document.getElementById("recordReleasers"),S=document.getElementById("recordReleasersMax");L.addEventListener("input",function(){if(L.value=L.value.toUpperCase(),L.value=L.value.replace(/[^a-zA-Z0-9-+& ]/g,""),L.value==""){L.classList.add(e);return}L.classList.remove(e),L.value.split("+").length>2?(L.classList.add(e),S.classList.add(f)):(L.classList.remove(e),S.classList.remove(f))});function k(t){let s=t;return s=s.toLowerCase(),s=s.replace(/[^A-Za-z0-9À-ÖØ-öø-ÿ\s,]/g,""),s}const R=document.getElementById("recordArtist"),j=document.getElementById("recordCoder"),C=document.getElementById("recordMusic"),N=document.getElementById("recordWriter");R.addEventListener("input",function(){R.value=k(R.value)}),j.addEventListener("input",function(){j.value=k(j.value)}),C.addEventListener("input",function(){C.value=k(C.value)}),N.addEventListener("input",function(){N.value=k(N.value)});const m=document.getElementById("recordDemozoo");m.addEventListener("paste",function(){setTimeout(()=>{try{if(new URL(`${m.value}`).hostname!="demozoo.org"){m.classList.add(e);return}}catch{return}try{const u=new URL(`${m.value}`).pathname.split("/").filter(Boolean);if(u.length!=2){m.classList.add(e);return}switch(u[0]){case"productions":m.value=u[1];break;case"graphics":m.value=u[1];break;default:m.classList.add(e);return}m.classList.remove(e)}catch{m.classList.add(e)}},0)}),m.addEventListener("input",function(){let t=Number(m.value);if(isNaN(t)){m.classList.add(e);return}if(t<0||t>999999){m.classList.add(e);return}t==0&&(m.value=""),m.classList.remove(e)});const v=document.getElementById("recordPouet");v.addEventListener("paste",function(){setTimeout(()=>{try{const t=new URL(`${v.value}`);if(console.log(t.hostname),t.hostname!="www.pouet.net"){v.classList.add(e);return}}catch{return}try{const t=new URL(`${v.value}`);if(t.pathname!="/prod.php"){v.classList.add(e);return}const b=new URLSearchParams(t.search).get("which");v.value=b,v.classList.remove(e)}catch{v.classList.add(e)}},0)}),v.addEventListener("input",function(){let t=Number(v.value);if(isNaN(t)){v.classList.add(e);return}if(t<0||t>199999){v.classList.add(e);return}t==0&&(v.value=""),v.classList.remove(e)});const p=document.getElementById("record16colors");p.addEventListener("paste",function(){setTimeout(()=>{try{const t=new URL(`${p.value}`);if(t.hostname!="16colo.rs"){p.classList.add(e);return}const s=t.pathname;p.value=s,p.classList.remove(e)}catch{}},0)}),p.addEventListener("input",function(){if(p.value==""){p.classList.remove(e);return}});const g=document.getElementById("recordGitHub");g.addEventListener("paste",function(){setTimeout(()=>{try{const t=new URL(`${g.value}`);if(t.hostname!="github.com"){g.classList.add(e);return}const s=t.pathname;g.value=s,g.classList.remove(e)}catch{}},0)}),g.addEventListener("input",function(){if(g.value==""){g.classList.remove(e);return}});const h=document.getElementById("recordYouTube");h.addEventListener("paste",function(){setTimeout(()=>{try{const t=new URL(`${h.value}`);if(t.hostname!="youtube.com"&&t.hostname!="www.youtube.com"){h.classList.add(e);return}const u=new URLSearchParams(t.search).get("v");h.value=u,g.classList.remove(e)}catch{}},0)}),h.addEventListener("input",function(){setTimeout(()=>{if(h.value==""){h.classList.remove(e);return}if(new RegExp("^[a-zA-Z0-9_-]{11}$").test(h.value)){h.classList.remove(e);return}h.classList.add(e)},0)});const B=document.getElementById("recordFilename");B.addEventListener("input",function(){if(B.value=B.value.trimStart(),B.value==""){B.classList.add(e);return}B.classList.remove(e)});const r=document.getElementById("recordPlatform");r.addEventListener("change",function(t){r.classList.remove(e);const s=t.target.value;if(s.length==0){r.classList.add(e);return}$(s)});function $(t){fetch("/editor/platform",{method:"POST",body:JSON.stringify({id:parseInt(I.value),value:t}),headers:y}).then(s=>{if(!s.ok)throw new Error(T);return r.classList.remove(e),r.classList.add(d),s.json()}).catch(s=>{r.classList.remove(d),r.classList.add(f),console.log(s.message)}),z(t,o.value)}const o=document.getElementById("recordTag");o.addEventListener("change",function(t){const s=t.target.value;M(s)});function M(t){if(o.classList.remove(e),z(r.value,t),A(t),t.length==0){o.classList.add(e),o.value="";return}fetch("/editor/tag",{method:"POST",body:JSON.stringify({id:parseInt(I.value),value:t}),headers:y}).then(s=>{if(!s.ok)throw new Error(T);return o.classList.remove(e),o.classList.add(d),s.json()}).catch(s=>{o.classList.remove(d),o.classList.add(f),document.getElementById("tagInfo").textContent="",console.log(s.message)})}function z(t,s){fetch("/editor/platform+tag",{method:"POST",body:JSON.stringify({platform:t,tag:s}),headers:y}).then(u=>u.text()).then(u=>{document.getElementById("platformTagInfo").textContent=u})}function A(t){fetch("/editor/tag/info",{method:"POST",body:JSON.stringify({tag:t}),headers:y}).then(s=>s.text()).then(s=>{document.getElementById("tagInfo").textContent=s})}document.getElementById("recTagsReset").addEventListener("click",function(){const t=document.getElementById("recOSOg").value,s=document.getElementById("recTagOg").value;r.value=t,o.value=s,r.classList.remove(e),o.classList.remove(e),r.value.length==0&&r.classList.add(e),o.value.length==0&&o.classList.add(e),$(t),M(s)});const P=document.getElementById("recordReleasersLabel"),U=document.getElementById("recordTitleLabel");o.addEventListener("change",function(){setTimeout(()=>{if(o.value=="magazine"){x();return}E()},0)});function x(){P.textContent="Magazine",U.textContent="Issue"}function E(){P.textContent="Releasers",U.textContent="Title"}document.getElementById("recordDosText").addEventListener("click",function(){$("text"),M(""),E()}),document.getElementById("recordAmigaText").addEventListener("click",function(){r.value="textamiga",r.classList.remove(e),o.value="",o.classList.add(e),E()}),document.getElementById("recordProof").addEventListener("click",function(){r.value="image",r.classList.remove(e),o.value="releaseproof",o.classList.remove(e),E()}),document.getElementById("recordDostro").addEventListener("click",function(){r.value="dos",r.classList.remove(e),o.value="releaseadvert",o.classList.remove(e),E()}),document.getElementById("recordWintro").addEventListener("click",function(){r.value="windows",r.classList.remove(e),o.value="releaseadvert",o.classList.remove(e),E()}),document.getElementById("recordBBStro").addEventListener("click",function(){r.value="dos",r.classList.remove(e),o.value="bbs",o.classList.remove(e),E()}),document.getElementById("recordBBSAnsi").addEventListener("click",function(){r.value="ansi",r.classList.remove(e),o.value="bbs",o.classList.remove(e),E()}),document.getElementById("recordTextMag").addEventListener("click",function(){r.value="text",o.value="magazine",x()}),document.getElementById("recordDosMag").addEventListener("click",function(){r.value="dos",r.classList.remove(e),o.value="magazine",o.classList.remove(e),x()});const D=document.getElementById("recordReset");D==null?console.info("the editor reset button is not present"):D.addEventListener("click",function(){setTimeout(()=>{online.checked!=!0?onlineL.classList.add(f):onlineL.classList.remove(f),S.classList.remove(f),o.value=="magazine"?x():E(),document.querySelectorAll("input").forEach(s=>{s.classList.remove(e)},0)})})})();
