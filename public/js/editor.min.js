/* editor.min.js © Defacto2 2024 */
(()=>{"use strict";const v="text-danger",e="is-invalid",l="is-valid",T="d-none",p={"Content-type":"application/json; charset=UTF-8"},O="server could not save the change",B=document.getElementById("recordID");if(B==null){console.info("the editor modal is not open so the editor script is not needed");return}const w=document.getElementById("recordOnline"),k=document.getElementById("recordOnlineLabel");w.checked!=!0&&k.classList.add(v),w.addEventListener("change",function(){let t="/editor/online/false";w.checked==!0&&(t="/editor/online/true"),fetch(t,{method:"POST",body:JSON.stringify({id:parseInt(B.value)}),headers:p}).then(s=>{if(!s.ok)throw new Error(O);return w.checked==!0?k.classList.remove(v):k.classList.add(v),s.json()}).catch(s=>{console.log(s.message)})});const E=document.getElementById("recordTitle");E.addEventListener("input",function(){const t=document.getElementById("recordTitleErr"),s=document.getElementById("recordTitleOG"),u=document.getElementById("recordTitleOGValue").textContent;E.value!=u&&E.value.length>0?s.classList.remove(T):s.classList.add(T),E.classList.remove(e),t.classList.add(T),fetch("/editor/title",{method:"POST",body:JSON.stringify({id:parseInt(B.value),value:E.value}),headers:p}).then(I=>{if(!I.ok)throw new Error(O);return t.classList.add(T),E.classList.remove(e),E.classList.add(l),I.json()}).catch(I=>{t.classList.remove(T),E.classList.add(e),console.log(I.message)})});const d=document.getElementById("recordYMDSave");d.addEventListener("click",function(){c.classList.remove(l),o.classList.remove(l),r.classList.remove(l),fetch("/editor/ymd",{method:"POST",body:JSON.stringify({id:parseInt(B.value),year:parseInt(c.value),month:parseInt(o.value),day:parseInt(r.value)}),headers:p}).then(t=>{if(!t.ok)throw new Error(O);return c.classList.add(l),o.classList.add(l),r.classList.add(l),d.classList.remove(v),t.json()}).catch(t=>{d.classList.add(v),console.log(t.message)})}),document.getElementById("recordLMBtn").addEventListener("click",function(){c.classList.remove(e),o.classList.remove(e),r.classList.remove(e),c.classList.remove(l),o.classList.remove(l),r.classList.remove(l);const t=document.getElementById("recordLastMod").value.split("-");if(t.length!=3){console.error("invalid last modified date provided by server");return}c.value=t[0],o.value=t[1],r.value=t[2]}),document.getElementById("recordYMDReset").addEventListener("click",function(){const t=document.getElementById("recordOgY").value,s=document.getElementById("recordOgM").value,u=document.getElementById("recordOgD").value;c.value=t,o.value=s,r.value=u,c.classList.remove(e),o.classList.remove(e),r.classList.remove(e),c.classList.remove(l),o.classList.remove(l),r.classList.remove(l),d.disabled=!1});const c=document.getElementById("recordYear"),o=document.getElementById("recordMonth"),r=document.getElementById("recordDay");c.addEventListener("input",function(){if(c.value>=1980&&c.value<=2023){c.classList.remove(e),d.disabled=!1;return}if(c.value==""&&o.value==""&&r.value==""){c.classList.remove(e),o.classList.remove(e),r.classList.remove(e),d.disabled=!1;return}c.classList.add(e),d.disabled=!0}),o.addEventListener("input",function(){if(o.value>=1&&o.value<=12){o.classList.remove(e),d.disabled=!1;return}if(c.value==""&&o.value==""&&r.value==""){c.classList.remove(e),o.classList.remove(e),r.classList.remove(e),d.disabled=!1;return}if(o.value==""&&r.value==""){o.classList.remove(e),r.classList.remove(e),d.disabled=!1;return}o.classList.add(e),d.disabled=!0}),r.addEventListener("input",function(){if(r.value>=1&&r.value<=31){r.classList.remove(e),d.disabled=!1;return}if(c.value==""&&o.value==""&&r.value==""){c.classList.remove(e),o.classList.remove(e),r.classList.remove(e),d.disabled=!1;return}if(o.value==""&&r.value==""){o.classList.remove(e),r.classList.remove(e),d.disabled=!1;return}if(r.value==""){r.classList.remove(e),d.disabled=!1;return}r.classList.add(e),d.disabled=!0});const L=document.getElementById("recordReleasers"),R=document.getElementById("recordReleasersMax");L.addEventListener("input",function(){if(L.value=L.value.toUpperCase(),L.value=L.value.replace(/[^a-zA-Z0-9-+& ]/g,""),L.value==""){L.classList.add(e);return}L.classList.remove(e),L.value.split("+").length>2?(L.classList.add(e),R.classList.add(v)):(L.classList.remove(e),R.classList.remove(v))});function x(t){let s=t;return s=s.toLowerCase(),s=s.replace(/[^A-Za-z0-9À-ÖØ-öø-ÿ\s,]/g,""),s}const j=document.getElementById("recordArtist"),C=document.getElementById("recordCoder"),N=document.getElementById("recordMusic"),M=document.getElementById("recordWriter");j.addEventListener("input",function(){j.value=x(j.value)}),C.addEventListener("input",function(){C.value=x(C.value)}),N.addEventListener("input",function(){N.value=x(N.value)}),M.addEventListener("input",function(){M.value=x(M.value)});const i=document.getElementById("recordDemozoo");i.addEventListener("paste",function(){setTimeout(()=>{try{if(new URL(`${i.value}`).hostname!="demozoo.org"){i.classList.add(e);return}}catch{return}try{const u=new URL(`${i.value}`).pathname.split("/").filter(Boolean);if(u.length!=2){i.classList.add(e);return}switch(u[0]){case"productions":i.value=u[1];break;case"graphics":i.value=u[1];break;default:i.classList.add(e);return}i.classList.remove(e)}catch{i.classList.add(e)}},0)}),i.addEventListener("input",function(){let t=Number(i.value);if(isNaN(t)){i.classList.add(e);return}if(t<0||t>999999){i.classList.add(e);return}t==0&&(i.value=""),i.classList.remove(e)});const m=document.getElementById("recordPouet");m.addEventListener("paste",function(){setTimeout(()=>{try{const t=new URL(`${m.value}`);if(console.log(t.hostname),t.hostname!="www.pouet.net"){m.classList.add(e);return}}catch{return}try{const t=new URL(`${m.value}`);if(t.pathname!="/prod.php"){m.classList.add(e);return}const I=new URLSearchParams(t.search).get("which");m.value=I,m.classList.remove(e)}catch{m.classList.add(e)}},0)}),m.addEventListener("input",function(){let t=Number(m.value);if(isNaN(t)){m.classList.add(e);return}if(t<0||t>199999){m.classList.add(e);return}t==0&&(m.value=""),m.classList.remove(e)});const y=document.getElementById("record16colors");y.addEventListener("paste",function(){setTimeout(()=>{try{const t=new URL(`${y.value}`);if(t.hostname!="16colo.rs"){y.classList.add(e);return}const s=t.pathname;y.value=s,y.classList.remove(e)}catch{}},0)}),y.addEventListener("input",function(){if(y.value==""){y.classList.remove(e);return}});const g=document.getElementById("recordGitHub");g.addEventListener("paste",function(){setTimeout(()=>{try{const t=new URL(`${g.value}`);if(t.hostname!="github.com"){g.classList.add(e);return}const s=t.pathname;g.value=s,g.classList.remove(e)}catch{}},0)}),g.addEventListener("input",function(){if(g.value==""){g.classList.remove(e);return}});const f=document.getElementById("recordYouTube");f.addEventListener("paste",function(){setTimeout(()=>{try{const t=new URL(`${f.value}`);if(t.hostname!="youtube.com"&&t.hostname!="www.youtube.com"){f.classList.add(e);return}const u=new URLSearchParams(t.search).get("v");f.value=u,g.classList.remove(e)}catch{}},0)}),f.addEventListener("input",function(){setTimeout(()=>{if(f.value==""){f.classList.remove(e);return}if(new RegExp("^[a-zA-Z0-9_-]{11}$").test(f.value)){f.classList.remove(e);return}f.classList.add(e)},0)});const b=document.getElementById("recordFilename");b.addEventListener("input",function(){if(b.value=b.value.trimStart(),b.value==""){b.classList.add(e);return}b.classList.remove(e)});const a=document.getElementById("recordPlatform");a.addEventListener("change",function(t){a.classList.remove(e);const s=t.target.value;if(s.length==0){a.classList.add(e);return}z(s)});function z(t){fetch("/editor/platform",{method:"POST",body:JSON.stringify({id:parseInt(B.value),value:t}),headers:p}).then(s=>{if(!s.ok)throw new Error(O);return a.classList.remove(e),a.classList.add(l),s.json()}).catch(s=>{a.classList.remove(l),a.classList.add(v),console.log(s.message)}),U(t,n.value)}const n=document.getElementById("recordTag");n.addEventListener("change",function(t){const s=t.target.value;P(s)});function P(t){if(n.classList.remove(e),U(a.value,t),A(t),t.length==0){n.classList.add(e),n.value="";return}fetch("/editor/tag",{method:"POST",body:JSON.stringify({id:parseInt(B.value),value:t}),headers:p}).then(s=>{if(!s.ok)throw new Error(O);return n.classList.remove(e),n.classList.add(l),s.json()}).catch(s=>{n.classList.remove(l),n.classList.add(v),document.getElementById("tagInfo").textContent="",console.log(s.message)})}function U(t,s){fetch("/editor/platform+tag",{method:"POST",body:JSON.stringify({platform:t,tag:s}),headers:p}).then(u=>u.text()).then(u=>{document.getElementById("platformTagInfo").textContent=u})}function A(t){fetch("/editor/tag/info",{method:"POST",body:JSON.stringify({tag:t}),headers:p}).then(s=>s.text()).then(s=>{document.getElementById("tagInfo").textContent=s})}document.getElementById("recTagsReset").addEventListener("click",function(){const t=document.getElementById("recOSOg").value,s=document.getElementById("recTagOg").value;a.value=t,n.value=s,a.classList.remove(e),n.classList.remove(e),a.value.length==0&&a.classList.add(e),n.value.length==0&&n.classList.add(e),z(t),P(s)});const D=document.getElementById("recordReleasersLabel"),$=document.getElementById("recordTitleLabel");n.addEventListener("change",function(){setTimeout(()=>{if(n.value=="magazine"){S();return}h()},0)});function S(){D.textContent="Magazine",$.textContent="Issue"}function h(){D.textContent="Releasers",$.textContent="Title"}document.getElementById("recordDosText").addEventListener("click",function(){z("text"),P(""),h()}),document.getElementById("recordAmigaText").addEventListener("click",function(){a.value="textamiga",a.classList.remove(e),n.value="",n.classList.add(e),h()}),document.getElementById("recordProof").addEventListener("click",function(){a.value="image",a.classList.remove(e),n.value="releaseproof",n.classList.remove(e),h()}),document.getElementById("recordDostro").addEventListener("click",function(){a.value="dos",a.classList.remove(e),n.value="releaseadvert",n.classList.remove(e),h()}),document.getElementById("recordWintro").addEventListener("click",function(){a.value="windows",a.classList.remove(e),n.value="releaseadvert",n.classList.remove(e),h()}),document.getElementById("recordBBStro").addEventListener("click",function(){a.value="dos",a.classList.remove(e),n.value="bbs",n.classList.remove(e),h()}),document.getElementById("recordBBSAnsi").addEventListener("click",function(){a.value="ansi",a.classList.remove(e),n.value="bbs",n.classList.remove(e),h()}),document.getElementById("recordTextMag").addEventListener("click",function(){a.value="text",n.value="magazine",S()}),document.getElementById("recordDosMag").addEventListener("click",function(){a.value="dos",a.classList.remove(e),n.value="magazine",n.classList.remove(e),S()}),document.getElementById("recordReset").addEventListener("click",function(){setTimeout(()=>{w.checked!=!0?k.classList.add(v):k.classList.remove(v),R.classList.remove(v),n.value=="magazine"?S():h(),document.querySelectorAll("input").forEach(s=>{s.classList.remove(e)},0)})})})();
