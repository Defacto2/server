/* uploader.min.js Â© Defacto2 2024 */
(()=>{function o(e){let t=document.getElementById(e);if(t==null)throw new Error(`The ${e} element is null.`);return t}function l(e){if(`${e}`=="")return!0;let t=1980,s=new Date().getFullYear();return!(e<t||e>s)}function d(e){return`${e}`==""?!0:!(e<1||e>12)}function w(e){return`${e}`==""?!0:!(e<1||e>31)}function te(e){let t=document.getElementById(e);if(t==null)throw new Error(`The ${e} element is null.`);t.addEventListener("click",function(){let s="Choose...",a=!0;ae(),k.value==""&&(k.classList.add(r),a=!1),(B.value==""||B.value==s)&&(B.classList.add(r),a=!1),(T.value==""||T.value==s)&&(T.classList.add(r),a=!1),I.value==""&&(I.classList.add(r),a=!1),S.value==""&&(S.classList.add(r),a=!1),l(z.value)==!1&&(z.classList.add(r),a=!1),d(Y.value)==!1&&(Y.classList.add(r),a=!1),w(F.value)==!1&&(F.classList.add(r),a=!1),a==!0&&se.submit()})}var r="is-invalid",se=document.getElementById("advancedUploader");se.addEventListener("reset",ae);function ae(){k.classList.remove(r),B.classList.remove(r),T.classList.remove(r),I.classList.remove(r),S.classList.remove(r),z.classList.remove(r),Y.classList.remove(r),F.classList.remove(r)}var k=document.getElementById("advFile"),B=document.getElementById("advSelOS"),T=document.getElementById("advSelCat"),I=document.getElementById("advTitle"),S=document.getElementById("releasersAdv"),z=document.getElementById("advYear"),Y=document.getElementById("advMonth"),F=document.getElementById("advDay");var R=document.getElementById("imageFile"),C=document.getElementById("imageTitle"),H=document.getElementById("imageReleasers"),U=document.getElementById("imageYear"),A=document.getElementById("imageMonth"),oe=document.getElementById("imageUploader"),c="is-invalid";function ne(){R.classList.remove(c),C.classList.remove(c),H.classList.remove(c),U.classList.remove(c),A.classList.remove(c)}oe.addEventListener("reset",ne);function re(e){let t=document.getElementById(e);if(t==null)throw new Error(`The ${e} element is null.`);t.addEventListener("click",function(){let s=!0;ne(),R.value==""&&(R.classList.add(c),s=!1),C.value==""&&(C.classList.add(c),s=!1),H.value==""&&(H.classList.add(c),s=!1),l(U.value)==!1&&(U.classList.add(c),s=!1),d(A.value)==!1&&(A.classList.add(c),s=!1),s==!0&&oe.submit()})}var Le="application/x-freearc",ge="application/octet-stream",ye="application/x-bzip",xe="application/x-bzip2",be="application/gzip",Ee="application/vnd.rar",we="application/x-tar",Be="application/zip",Te="application/x-7z-compressed";function Me(e){return[Le,ye,xe,be,Ee,we,Be,Te].includes(e)!=!1}function $e(e){return[ge].includes(e)}function ie(e){let t=!1;return t=$e(e),!!(t||(t=Me(e),t))}function b(e){if(bootstrap===void 0)throw new Error("The bootstrap object is undefined.");let t=o(e);return new bootstrap.Modal(t)}function M(e,t){let s=document.getElementById(t);if(s==null)throw new Error(`The ${t} element is null.`);let a=o(e);if(a.addEventListener("shown.bs.modal",function(){s.focus()}),bootstrap===void 0)throw new Error("The bootstrap object is undefined.");return new bootstrap.Modal(a)}async function le(e){try{let t=await ke(e),s=await fetch(`/uploader/sha384/${t}`,{method:"PUT",headers:{"Content-Type":"text/plain"},body:t});if(!s.ok)throw new Error(`Hashing is not possible, server response: ${s.status}`);return await s.text()=="true"}catch(t){console.log(`Hashing is not possible: ${t}`)}}async function ke(e){try{let t=await e.arrayBuffer(),s=await crypto.subtle.digest("SHA-384",t);return Array.from(new Uint8Array(s)).map(a=>a.toString(16).padStart(2,"0")).join("")}catch(t){throw new Error(`Could not use arrayBuffer or crypto.subtle: ${t}`)}}var D="uploader-intro-form",n="is-invalid",h="d-none",j=1024*1024,de=100*j,Ie=100,Se=o(D),u=o("uploader-intro-alert"),E=o("uploader-intro-file"),ze=o("uploader-intro-list-1"),Ye=o("uploader-intro-list-2"),p=o("uploader-intro-month"),L=o("uploader-intro-releaser-1"),P=o("uploader-intro-results"),f=o("uploader-intro-year"),v=o("uploader-intro-youtube");Se.addEventListener("reset",me);E.addEventListener("change",Fe);L.addEventListener("input",He);f.addEventListener("input",Ae);p.addEventListener("input",Ue);v.addEventListener("input",De);function ce(e){o(e).addEventListener("click",function(){let s=!0;if(L.value==""&&(L.classList.add(n),s=!1),l(f.value)==!1&&(f.classList.add(n),s=!1),d(p.value)==!1&&(p.classList.add(n),s=!1),p.value!=""&&f.value==""&&(f.classList.add(n),s=!1),E.value==""&&(E.classList.add(n),s=!1),s==!1){u.innerText="Please correct the problems with the form.",u.classList.remove(h);return}me(),P.classList.remove(h)})}function ue(){htmx.on(`#${D}`,"htmx:xhr:progress",function(e){e.target.id==`${D}`&&htmx.find("#uploader-intro-progress").setAttribute("value",e.detail.loaded/e.detail.total*Ie)})}async function Fe(){let e=this.files[0],t="";E.classList.remove(n),u.innerText="",u.classList.add(h);let s=[Re(e),Ce(e)];if(s=s.filter(g=>g!=""),s.length>0){u.innerText=s.join(" "),u.classList.remove(h),this.value=t,this.classList.add(n);return}if(await le(e)==!0){u.innerText=`The chosen file already exists in the database: ${e.name}`,u.classList.remove(h),this.value=t,this.classList.add(n);return}}function Re(e){return e.size>de?`The chosen file is too big at ${Math.round(e.size/j)}MB, maximum size is ${de/j}MB.`:""}function Ce(e){return ie(e.type)?"":`The chosen file mime type ${e.type} is probably not suitable for an intro.`}function me(){ze.innerHTML="",Ye.innerHTML="",P.innerHTML="",P.classList.add(h),u.innerText="",u.classList.add(h),f.classList.remove(n),p.classList.remove(n),L.classList.remove(n),v.classList.remove(n),E.classList.remove(n)}function He(){return L.value==""?(L.classList.add(n),!1):(L.classList.remove(n),!0)}function Ue(){return d(p.value)==!1?(p.classList.add(n),!1):(p.classList.remove(n),!0)}function Ae(){return l(f.value)==!1?(f.classList.add(n),!1):(f.classList.remove(n),!0)}function De(){return v.value==""?(v.classList.remove(n),!0):new RegExp(/^[a-zA-Z0-9_-]{11}$/).test(v.value)==!1?(v.classList.add(n),!1):(v.classList.remove(n),!0)}var je=M("uploader-pouet-modal","pouet-submission"),Pe=M("uploader-demozoo-modal","demozoo-submission"),Ke=M("uploader-intro-modal","uploader-intro-file"),qe=b("uploaderText"),Ge=b("uploaderImg"),Oe=b("uploaderMag"),Xe=b("uploaderAdv"),Ze="d",_e="p",Je="i",Ne="n",Qe="g",Ve="m",We="a";function fe(){document.addEventListener("keydown",function(e){if(!(!e.ctrlKey||!e.altKey))switch(e.key){case Ze:Pe.show();break;case _e:je.show();break;case Je:Ke.show();break;case Ne:qe.show();break;case Qe:Ge.show();break;case Ve:Oe.show();break;case We:Xe.show();break}})}var K=document.getElementById("magFile"),q=document.getElementById("magTitle"),G=document.getElementById("magIssue"),O=document.getElementById("magYear"),X=document.getElementById("magMonth"),Z=document.getElementById("magDay"),i="is-invalid";function et(){K.classList.remove(i),q.classList.remove(i),G.classList.remove(i),O.classList.remove(i),X.classList.remove(i),Z.classList.remove(i)}var tt=document.getElementById("magUploader");function pe(e){let t=document.getElementById(e);if(t==null)throw new Error(`The ${e} element is null.`);t.addEventListener("click",function(){let s=!0;et(),K.value==""&&(K.classList.add(i),s=!1),q.value==""&&(q.classList.add(i),s=!1),G.value==""&&(G.classList.add(i),s=!1),l(O.value)==!1&&(O.classList.add(i),s=!1),d(X.value)==!1&&(X.classList.add(i),s=!1),w(Z.value)==!1&&(Z.classList.add(i),s=!1),s==!0&&tt.submit()})}function ve(e,t){let s=document.getElementById(e);if(s==null)throw new Error(`The ${e} element is null.`);let a=document.getElementById(t);if(a==null)throw new Error(`The ${t} form element is null.`);a.addEventListener("reset",he),s.addEventListener("click",function(){st()==!0&&a.submit()})}var _=o("textFile"),J=o("textTitle"),N=o("textReleasers"),Q=o("textYear"),V=o("textMonth"),m="is-invalid";function he(){_.classList.remove(m),J.classList.remove(m),N.classList.remove(m),Q.classList.remove(m),V.classList.remove(m)}function st(){let e=!0;return he(),_.value==""&&(_.classList.add(m),e=!1),J.value==""&&(J.classList.add(m),e=!1),N.value==""&&(N.classList.add(m),e=!1),l(Q.value)==!1&&(Q.classList.add(m),e=!1),d(V.value)==!1&&(V.classList.add(m),e=!1),e}var y="d-none";function W(e,t){let s=o(e),a=o(`${e}-error`),g=o(`${e}-results`);o(`${e}-close`).addEventListener("click",ee),o(`${e}-clear`).addEventListener("click",ee);function ee(){s.value="",s.focus(),a.innerText="",a.classList.add(y),g.innerHTML=""}document.body.addEventListener("htmx:beforeRequest",function(){at(a,g)}),document.body.addEventListener("htmx:afterRequest",function(x){if(x.detail.elt===null||x.detail.elt.id!==`${e}`)return;if(x.detail.successful)return ot(a);let $=x.detail.xhr;if(x.detail.failed&&$)return $.status===404?nt(a,g,t):it(a,$);rt(a)})}function at(e,t){t.innerHTML="",e.innerText="",e.classList.add(y)}function ot(e){e.classList.add(y),e.innerText=""}function nt(e,t,s){t.innerText=`Production not found on ${s}.`,e.classList.add(y),e.innerText=""}function rt(e){e.innerText="Something with the browser is not working, please refresh the page.",e.classList.remove(y)}function it(e,t){e.innerText=`Something went wrong, ${t.status} status: ${t.responseText}.`,e.classList.remove(y)}(()=>{"use strict";fe(),te("advSubmit"),re("imageSubmit"),ce("uploader-intro-submit"),ue(),pe("magSubmit"),ve("textSubmit","textUploader"),W("demozoo-submission","Demozoo"),W("pouet-submission","Pou\xEBt")})();})();
