/* uploader.min.js Â© Defacto2 2024 */
(()=>{function a(e){let s=document.getElementById(e);if(s==null)throw new Error(`The ${e} element is null.`);return s}function l(e){if(`${e}`=="")return!0;let s=1980,t=new Date().getFullYear();return!(e<s||e>t)}function d(e){return`${e}`==""?!0:!(e<1||e>12)}function R(e){return`${e}`==""?!0:!(e<1||e>31)}function ce(e,s){if(e=="")return!0;let t=Number(e),o=Number(s);if(!Number.isInteger(o)||o<1)throw new Error(`The ID sanity value is invalid: ${o}`);return Number.isInteger(t)&&t>0&&t<=o}function me(e){let s=document.getElementById(e);if(s==null)throw new Error(`The ${e} element is null.`);s.addEventListener("click",function(){let t="Choose...",o=!0;pe(),O.value==""&&(O.classList.add(i),o=!1),(C.value==""||C.value==t)&&(C.classList.add(i),o=!1),(D.value==""||D.value==t)&&(D.classList.add(i),o=!1),N.value==""&&(N.classList.add(i),o=!1),K.value==""&&(K.classList.add(i),o=!1),l(q.value)==!1&&(q.classList.add(i),o=!1),d(G.value)==!1&&(G.classList.add(i),o=!1),R(X.value)==!1&&(X.classList.add(i),o=!1),o==!0&&fe.submit()})}var i="is-invalid",fe=document.getElementById("advancedUploader");fe.addEventListener("reset",pe);function pe(){O.classList.remove(i),C.classList.remove(i),D.classList.remove(i),N.classList.remove(i),K.classList.remove(i),q.classList.remove(i),G.classList.remove(i),X.classList.remove(i)}var O=document.getElementById("advFile"),C=document.getElementById("advSelOS"),D=document.getElementById("advSelCat"),N=document.getElementById("advTitle"),K=document.getElementById("releasersAdv"),q=document.getElementById("advYear"),G=document.getElementById("advMonth"),X=document.getElementById("advDay");var Z=document.getElementById("imageFile"),_=document.getElementById("imageTitle"),J=document.getElementById("imageReleasers"),Q=document.getElementById("imageYear"),V=document.getElementById("imageMonth"),ve=document.getElementById("imageUploader"),m="is-invalid";function he(){Z.classList.remove(m),_.classList.remove(m),J.classList.remove(m),Q.classList.remove(m),V.classList.remove(m)}ve.addEventListener("reset",he);function Le(e){let s=document.getElementById(e);if(s==null)throw new Error(`The ${e} element is null.`);s.addEventListener("click",function(){let t=!0;he(),Z.value==""&&(Z.classList.add(m),t=!1),_.value==""&&(_.classList.add(m),t=!1),J.value==""&&(J.classList.add(m),t=!1),l(Q.value)==!1&&(Q.classList.add(m),t=!1),d(V.value)==!1&&(V.classList.add(m),t=!1),t==!0&&ve.submit()})}function A(e){if(bootstrap===void 0)throw new Error("The bootstrap object is undefined.");let s=a(e);return new bootstrap.Modal(s,{keyboard:!0})}function I(e,s){let t=document.getElementById(s);if(t==null)throw new Error(`The ${s} element is null.`);let o=a(e);if(o.addEventListener("shown.bs.modal",function(){t.focus()}),bootstrap===void 0)throw new Error("The bootstrap object is undefined.");return new bootstrap.Modal(o,{keyboard:!0})}async function j(e){try{let s=await Fe(e),t=await fetch(`/uploader/sha384/${s}`,{method:"PUT",headers:{"Content-Type":"text/plain"},body:s});if(!t.ok)throw new Error(`Hashing is not possible, server response: ${t.status}`);return await t.text()=="true"}catch(s){console.log(`Hashing is not possible: ${s}`)}}async function Fe(e){try{let s=await e.arrayBuffer(),t=await crypto.subtle.digest("SHA-384",s);return Array.from(new Uint8Array(t)).map(o=>o.toString(16).padStart(2,"0")).join("")}catch(s){throw new Error(`Could not use arrayBuffer or crypto.subtle: ${s}`)}}var Re=I("uploader-pouet-modal","pouet-submission"),Ce=I("uploader-demozoo-modal","demozoo-submission"),De=I("uploader-intro-modal","uploader-intro-file"),Ae=I("uploader-text-modal","uploader-text-file"),je=A("uploaderImg"),Pe=A("uploaderMag"),Ue=A("uploaderAdv"),Oe="d",Ne="p",Ke="i",qe="n",Ge="g",Xe="m",Ze="a";function ge(){document.addEventListener("keydown",function(e){if(!(!e.ctrlKey||!e.altKey))switch(e.key){case Oe:Ce.show();break;case Ne:Re.show();break;case Ke:De.show();break;case qe:Ae.show();break;case Ge:je.show();break;case Xe:Pe.show();break;case Ze:Ue.show();break}})}var W=document.getElementById("magFile"),ee=document.getElementById("magTitle"),te=document.getElementById("magIssue"),se=document.getElementById("magYear"),ae=document.getElementById("magMonth"),oe=document.getElementById("magDay"),u="is-invalid";function _e(){W.classList.remove(u),ee.classList.remove(u),te.classList.remove(u),se.classList.remove(u),ae.classList.remove(u),oe.classList.remove(u)}var Je=document.getElementById("magUploader");function xe(e){let s=document.getElementById(e);if(s==null)throw new Error(`The ${e} element is null.`);s.addEventListener("click",function(){let t=!0;_e(),W.value==""&&(W.classList.add(u),t=!1),ee.value==""&&(ee.classList.add(u),t=!1),te.value==""&&(te.classList.add(u),t=!1),l(se.value)==!1&&(se.classList.add(u),t=!1),d(ae.value)==!1&&(ae.classList.add(u),t=!1),R(oe.value)==!1&&(oe.classList.add(u),t=!1),t==!0&&Je.submit()})}var ne="is-invalid",w="d-none";function re(e,s){let t=a(e),o=a(`${e}-error`),c=a(`${e}-results`);a(`${e}-close`).addEventListener("click",F),a(`${e}-clear`).addEventListener("click",F);function F(){t.value="",t.focus(),t.classList.remove(ne),o.innerText="",o.classList.add(w),c.innerHTML=""}let $=45e4,Ye=2e5;switch(e){case"demozoo-submission":ye(t,$);break;case"pouet-submission":ye(t,Ye);break}document.body.addEventListener("htmx:beforeRequest",function(){Qe(o,c)}),document.body.addEventListener("htmx:afterRequest",function(k){if(k.detail.elt===null||k.detail.elt.id!==`${e}`)return;if(k.detail.successful)return Ve(o);let U=k.detail.xhr;if(k.detail.failed&&U)return U.status===404?We(o,c,s):tt(o,U);et(o)})}function ye(e,s){e.addEventListener("input",function(){if(!ce(e.value,s)){e.classList.add(ne);return}e.classList.remove(ne)})}function Qe(e,s){s.innerHTML="",e.innerText="",e.classList.add(w)}function Ve(e){e.classList.add(w),e.innerText=""}function We(e,s,t){s.innerText=`Production not found on ${t}.`,e.classList.add(w),e.innerText=""}function et(e){e.innerText="Something with the browser is not working, please refresh the page.",e.classList.remove(w)}function tt(e,s){e.innerText=`Something went wrong, ${s.status} status: ${s.responseText}.`,e.classList.remove(w)}var st="application/x-freearc",at="application/octet-stream",ot="application/x-bzip",nt="application/x-bzip2",rt="application/gzip",it="application/vnd.rar",lt="application/x-tar",dt="application/zip",ut="application/x-7z-compressed";function ct(e){return[st,ot,nt,rt,it,lt,dt,ut].includes(e)!=!1}function mt(e){return[at].includes(e)}function P(e){let s=!1;return s=mt(e),!!(s||(s=ct(e),s))}var ie="uploader-intro-form",n="is-invalid",v="d-none",le=1024*1024,be=100*le,ft=100,pt=a(ie),f=a("uploader-intro-alert"),S=a("uploader-intro-file"),Ee=a("uploader-intro-last-modified"),vt=a("uploader-intro-list-1"),ht=a("uploader-intro-list-2"),Te=a("uploader-intro-magic"),x=a("uploader-intro-month"),E=a("uploader-intro-releaser-1"),M=a("uploader-intro-results"),h=a("uploader-intro-year"),b=a("uploader-intro-youtube");pt.addEventListener("reset",function(){Ee.value="",Te.value="",Be()});S.addEventListener("change",Lt);E.addEventListener("input",yt);h.addEventListener("input",Et);x.addEventListener("input",bt);b.addEventListener("input",Tt);function we(e){a(e).addEventListener("click",function(){let t=!0;if(E.value==""&&(E.classList.add(n),t=!1),l(h.value)==!1&&(h.classList.add(n),t=!1),d(x.value)==!1&&(x.classList.add(n),t=!1),x.value!=""&&h.value==""&&(h.classList.add(n),t=!1),S.value==""&&(S.classList.add(n),t=!1),t==!1){f.innerText="Please correct the problems with the form.",f.classList.remove(v);return}Be(),M.innerText="...",M.classList.remove(v)})}function Me(){htmx.on(`#${ie}`,"htmx:xhr:progress",function(e){e.target.id==`${ie}`&&htmx.find("#uploader-intro-progress").setAttribute("value",e.detail.loaded/e.detail.total*ft)})}async function Lt(){let e=this.files[0],s="";S.classList.remove(n),f.innerText="",f.classList.add(v);let t=[gt(e),xt(e)];if(t=t.filter($=>$!=""),t.length>0){f.innerText=t.join(" "),f.classList.remove(v),this.value=s,this.classList.add(n),M.classList.remove(v);return}if(await j(e)==!0){f.innerText=`The chosen file already exists in the database: ${e.name}`,f.classList.remove(v),this.value=s,this.classList.add(n),M.classList.remove(v);return}let c=e.lastModified,H=new Date().getTime(),Y=60*60*1e3;H-c<Y||(console.log("The file was last modified more than an hour ago."),Ee.value=c),e.type!=""&&(console.log(`The file mime type is ${e.type}.`),Te.value=e.type)}function gt(e){return e.size>be?`The chosen file is too big at ${Math.round(e.size/le)}MB, maximum size is ${be/le}MB.`:""}function xt(e){return P(e.type)?"":`The chosen file mime type ${e.type} is probably not suitable for an intro.`}function Be(){vt.innerHTML="",ht.innerHTML="",M.innerHTML="",M.classList.add(v),f.innerText="",f.classList.add(v),h.classList.remove(n),x.classList.remove(n),E.classList.remove(n),b.classList.remove(n),S.classList.remove(n)}function yt(){return E.value==""?(E.classList.add(n),!1):(E.classList.remove(n),!0)}function bt(){return d(x.value)==!1?(x.classList.add(n),!1):(x.classList.remove(n),!0)}function Et(){return l(h.value)==!1?(h.classList.add(n),!1):(h.classList.remove(n),!0)}function Tt(){return b.value==""?(b.classList.remove(n),!0):new RegExp(/^[a-zA-Z0-9_-]{11}$/).test(b.value)==!1?(b.classList.add(n),!1):(b.classList.remove(n),!0)}var de="uploader-text-form",r="is-invalid",L="d-none",ue=1024*1024,$e=100*ue,wt=100,Mt=a(de),p=a("uploader-text-alert"),z=a("uploader-text-file"),ke=a("uploader-text-last-modified"),Bt=a("uploader-text-list-1"),$t=a("uploader-text-list-2"),Ie=a("uploader-text-magic"),y=a("uploader-text-month"),T=a("uploader-text-releaser-1"),B=a("uploader-text-results"),g=a("uploader-text-year");Mt.addEventListener("reset",function(){ke.value="",Ie.value="",He()});z.addEventListener("change",kt);T.addEventListener("input",zt);g.addEventListener("input",Yt);y.addEventListener("input",Ht);function Se(e){a(e).addEventListener("click",function(){let t=!0;if(T.value==""&&(T.classList.add(r),t=!1),l(g.value)==!1&&(g.classList.add(r),t=!1),d(y.value)==!1&&(y.classList.add(r),t=!1),y.value!=""&&g.value==""&&(g.classList.add(r),t=!1),z.value==""&&(z.classList.add(r),t=!1),t==!1){p.innerText="Please correct the problems with the form.",p.classList.remove(L);return}He(),B.innerText="...",B.classList.remove(L)})}function ze(){htmx.on(`#${de}`,"htmx:xhr:progress",function(e){e.target.id==`${de}`&&htmx.find("#uploader-text-progress").setAttribute("value",e.detail.loaded/e.detail.total*wt)})}async function kt(){let e=this.files[0],s="";z.classList.remove(r),p.innerText="",p.classList.add(L);let t=[It(e),St(e)];if(t=t.filter($=>$!=""),t.length>0){p.innerText=t.join(" "),p.classList.remove(L),this.value=s,this.classList.add(r),B.classList.remove(L);return}if(await j(e)==!0){p.innerText=`The chosen file already exists in the database: ${e.name}`,p.classList.remove(L),this.value=s,this.classList.add(r),B.classList.remove(L);return}let c=e.lastModified,H=new Date().getTime(),Y=60*60*1e3;H-c<Y||(console.log("The file was last modified more than an hour ago."),ke.value=c),e.type!=""&&(console.log(`The file mime type is ${e.type}.`),Ie.value=e.type)}function It(e){return e.size>$e?`The chosen file is too big at ${Math.round(e.size/ue)}MB, maximum size is ${$e/ue}MB.`:""}function St(e){return P(e.type)?"":`The chosen file mime type ${e.type} is probably not suitable for an intro.`}function He(){Bt.innerHTML="",$t.innerHTML="",B.innerHTML="",B.classList.add(L),p.innerText="",p.classList.add(L),g.classList.remove(r),y.classList.remove(r),T.classList.remove(r),z.classList.remove(r)}function zt(){return T.value==""?(T.classList.add(r),!1):(T.classList.remove(r),!0)}function Ht(){return d(y.value)==!1?(y.classList.add(r),!1):(y.classList.remove(r),!0)}function Yt(){return l(g.value)==!1?(g.classList.add(r),!1):(g.classList.remove(r),!0)}(()=>{"use strict";ge(),me("advSubmit"),Le("imageSubmit"),we("uploader-intro-submit"),Me(),Se("uploader-text-submit"),ze(),xe("magSubmit"),re("demozoo-submission","Demozoo"),re("pouet-submission","Pou\xEBt")})();})();
