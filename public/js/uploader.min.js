/* uploader.min.js Â© Defacto2 2024 */
(()=>{function r(e){let a=document.getElementById(e);if(a==null)throw new Error(`The ${e} element is null.`);return a}function o(e){if(`${e}`=="")return!0;let a=1980,t=new Date().getFullYear();return!(e<a||e>t)}function l(e){return`${e}`==""?!0:!(e<1||e>12)}function W(e){return`${e}`==""?!0:!(e<1||e>31)}function we(e,a){if(e=="")return!0;let t=Number(e),s=Number(a);if(!Number.isInteger(s)||s<1)throw new Error(`The ID sanity value is invalid: ${s}`);return Number.isInteger(t)&&t>0&&t<=s}var n="is-invalid",b="d-none",nt=100,ue=1024*1024,Te=100*ue;function E(e,a){if(e==null)throw new Error("The elementId value of focusModalById is null.");if(a==null)throw new Error("The submissionId value of focusModalById is null.");let t=document.getElementById(a);if(t==null)throw new Error(`The ${a} element is null.`);let s=r(e);if(s.addEventListener("shown.bs.modal",function(){t.focus()}),bootstrap===void 0)throw new Error("The bootstrap object is undefined.");return new bootstrap.Modal(s,{keyboard:!0})}async function it(e){if(e==null)throw new Error("The file value of checkSHA is null.");try{let a=await ot(e),t=await fetch(`/uploader/sha384/${a}`,{method:"PUT",headers:{"Content-Type":"text/plain"},body:a});if(!t.ok)throw new Error(`Hashing is not possible, server response: ${t.status}`);return await t.text()=="true"}catch(a){console.log(`Hashing is not possible: ${a}`)}}async function ot(e){if(e==null)throw new Error("The file value of sha384 is null.");try{let a=await e.arrayBuffer(),t=await crypto.subtle.digest("SHA-384",a);return Array.from(new Uint8Array(t)).map(s=>s.toString(16).padStart(2,"0")).join("")}catch(a){throw new Error(`Could not use arrayBuffer or crypto.subtle: ${a}`)}}function F(e,a){if(e==null)throw new Error("The formId value of progress is null.");if(a==null)throw new Error("The elementId value of progress is null.");htmx.on(`#${e}`,"htmx:xhr:progress",function(t){t.target.id==`${e}`&&htmx.find(`#${a}`).setAttribute("value",t.detail.loaded/t.detail.total*nt)})}function c(e){if(e==null)throw new Error("The file value of checkSize is null.");return e.size>Te?`The chosen file is too big at ${Math.round(e.size/ue)}MB, maximum size is ${Te/ue}MB.`:""}function u(){return this.value==""?(this.classList.add(n),!1):(this.classList.remove(n),!0)}function be(){return W(this.value)==!1?(this.classList.add(n),!1):(this.classList.remove(n),!0)}function d(){return console.log(`The month value is ${this.value}.`),l(this.value)==!1?(this.classList.add(n),!1):(this.classList.remove(n),!0)}function f(){return o(this.value)==!1?(this.classList.add(n),!1):(this.classList.remove(n),!0)}function p(e,a,t,s){if(e==null)throw new Error("The errors value of checkErrors is null.");if(a==null)throw new Error("The alert value of checkErrors is null.");if(t==null)throw new Error("The fileInput value of checkErrors is null.");if(s==null)throw new Error("The results value of checkErrors is null.");e=e.filter(g=>g!=""),!(e.length<=0)&&(a.innerText=e.join(" "),a.classList.remove(b),t.innerText="",t.classList.add(n),s.classList.add(b))}async function m(e,a,t,s){if(e==null)throw new Error("The file value of checkDuplicate is null.");if(a==null)throw new Error("The alert value of checkDuplicate is null.");if(t==null)throw new Error("The fileInput value of checkDuplicate is null.");if(s==null)throw new Error("The results value of checkDuplicate is null.");await it(e)!=!1&&(a.innerText=`The chosen file already exists in the database: ${e.name}`,a.classList.remove(b),t.innerText="",t.classList.add(n),s.classList.add(b))}function h(e,a,t){if(e==null)throw new Error("The file1 value of hiddenDetails is null.");if(a==null)throw new Error("The lastMod value of hiddenDetails is null.");if(t==null)throw new Error("The magic value of hiddenDetails is null.");let s=e.lastModified,g=new Date().getTime(),ge=60*60*1e3;g-s<ge||(a.value=s),e.type!=""&&(t.value=e.type)}function Ee(){return this.value==""?(this.classList.remove(n),!0):new RegExp(/^[a-zA-Z0-9_-]{11}$/).test(this.value)==!1?(this.classList.add(n),!1):(this.classList.remove(n),!0)}function v(e,a,t){if(e==null)throw new Error("The fileInput value of resetInput is null.");if(a==null)throw new Error("The alert value of resetInput is null.");if(t==null)throw new Error("The results value of resetInput is null.");e.innerText="",e.classList.remove(n),a.innerText="",a.classList.add(b),t.innerText="",t.classList.add(b)}function x(e,a){if(e==null)throw new Error("The alert value of submitError is null.");if(a==null)throw new Error("The results value of submitError is null.");e.innerText="Please correct the problems with the form.",e.classList.remove(b),a.innerText="",a.classList.add(b)}function de(){return this.value==""?(this.classList.add(n),!1):(this.classList.remove(n),!0)}var lt=E("uploader-pouet-modal","pouet-submission"),ct=E("uploader-demozoo-modal","demozoo-submission"),ut=E("uploader-intro-modal","uploader-intro-file"),dt=E("uploader-text-modal","uploader-text-file"),ft=E("uploader-image-modal","uploader-image-file"),pt=E("uploader-magazine-modal","uploader-magazine-file"),mt=E("uploader-advanced-modal","uploader-advanced-file"),ht="d",vt="p",xt="i",Lt="n",gt="g",yt="m",wt="a";function ke(){document.addEventListener("keydown",function(e){if(!(!e.ctrlKey||!e.altKey))switch(e.key){case ht:ct.show();break;case vt:lt.show();break;case xt:ut.show();break;case Lt:dt.show();break;case gt:ft.show();break;case yt:pt.show();break;case wt:mt.show();break}})}var fe="is-invalid",j="d-none";function pe(e,a){let t=r(e),s=r(`${e}-error`),g=r(`${e}-results`);r(`${e}-close`).addEventListener("click",ye),r(`${e}-clear`).addEventListener("click",ye);function ye(){t.value="",t.focus(),t.classList.remove(fe),s.innerText="",s.classList.add(j),g.innerHTML=""}let at=45e4,st=2e5;switch(e){case"demozoo-submission":Me(t,at);break;case"pouet-submission":Me(t,st);break}document.body.addEventListener("htmx:beforeRequest",function(){Tt(s,g)}),document.body.addEventListener("htmx:afterRequest",function(V){if(V.detail.elt===null||V.detail.elt.id!==`${e}`)return;if(V.detail.successful)return bt(s);let ce=V.detail.xhr;if(V.detail.failed&&ce)return ce.status===404?Et(s,g,a):Mt(s,ce);kt(s)})}function Me(e,a){e.addEventListener("input",function(){if(!we(e.value,a)){e.classList.add(fe);return}e.classList.remove(fe)})}function Tt(e,a){a.innerHTML="",e.innerText="",e.classList.add(j)}function bt(e){e.classList.add(j),e.innerText=""}function Et(e,a,t){a.innerText=`Production not found on ${t}.`,e.classList.add(j),e.innerText=""}function kt(e){e.innerText="Something with the browser is not working, please refresh the page.",e.classList.remove(j)}function Mt(e,a){e.innerText=`Something went wrong, ${a.status} status: ${a.responseText}.`,e.classList.remove(j)}var zt="application/x-freearc",$t="application/x-arj",Bt="application/x-bzip",It="application/x-bzip2",Dt="application/gzip",St="application/vnd.rar",Ht="application/x-tar",Yt="application/zip",Ft="application/x-7z-compressed",jt="application/x-msdos-program",Rt="image/bmp",At="image/gif",Ct="image/jpeg",Nt="image/vnd.zbrush.pcx",Pt="image/png",Kt="image/tiff",qt="image/webp",Gt="application/x-csh",Ot="application/x-chrome-extension",Ut="text/x-script.perl",Vt="application/x-httpd-php",Xt="text/x-script.phyton",Zt="text/x-script.rexx",_t="application/x-sh",Jt="application/x-shellscript",Qt="text/x-script.tcl",Wt="text/x-shellscript",er="text/x-script.zsh";function tr(){return[Gt,Ot,Ut,Vt,Xt,Zt,_t,Jt,Qt,Wt,er]}function ze(){return[jt]}function ee(){return[zt,$t,Bt,It,Dt,St,Ht,Yt,Ft]}function $e(){return["application/octet-stream","application/x-binary","application/x-ms-dos-executable"]}function rr(){return[Rt,At,Ct,Nt,Pt,Kt,qt]}function Be(){return["text/plain","text/x-nfo"]}function Ie(e){return tr().includes(e)}function De(e){return rr().concat(ee()).includes(e)}function Se(e){return ze().concat(ee(),$e()).includes(e)}function He(e){return Be().concat(ee(),ze(),$e()).includes(e)}function Ye(e){return Be().concat(ee()).includes(e)}var ar="uploader-image-form",y="is-invalid",me="d-none",sr=r(ar),A=r("uploader-image-alert"),I=r("uploader-image-file"),Fe=r("uploader-image-last-modified"),nr=r("uploader-image-list-1"),ir=r("uploader-image-list-2"),je=r("uploader-image-magic"),X=r("uploader-image-month"),te=r("uploader-image-releaser-1"),k=r("uploader-image-results"),R=r("uploader-image-year");sr.addEventListener("reset",function(){Fe.value="",je.value="",Ae()});I.addEventListener("change",or);te.addEventListener("input",u);R.addEventListener("input",f);X.addEventListener("input",d);function Re(e){r(e).addEventListener("click",function(){let t=!0;if(te.value==""&&(te.classList.add(y),t=!1),o(R.value)==!1&&(R.classList.add(y),t=!1),l(X.value)==!1&&(X.classList.add(y),t=!1),X.value!=""&&R.value==""&&(R.classList.add(y),t=!1),I.value==""&&(I.classList.add(y),t=!1),t==!1)return x(A,k);Ae(),k.innerText="...",k.classList.remove(me)})}async function or(){v(I,A,k);let e=this.files[0],a=[c(e),lr(e)];p(a,A,I,k),m(e,A,I,k),h(e,Fe,je)}function lr(e){return De(e.type)?"":`The chosen file mime type ${e.type} is probably not suitable for an image.`}function Ae(){nr.innerHTML="",ir.innerHTML="",k.innerHTML="",k.classList.add(me),A.innerText="",A.classList.add(me),R.classList.remove(y),X.classList.remove(y),te.classList.remove(y),I.classList.remove(y)}var cr="uploader-intro-form",L="is-invalid",he="d-none",ur=r(cr),N=r("uploader-intro-alert"),D=r("uploader-intro-file"),Ce=r("uploader-intro-last-modified"),dr=r("uploader-intro-list-1"),fr=r("uploader-intro-list-2"),Ne=r("uploader-intro-magic"),Z=r("uploader-intro-month"),re=r("uploader-intro-releaser-1"),M=r("uploader-intro-results"),C=r("uploader-intro-year"),Pe=r("uploader-intro-youtube");ur.addEventListener("reset",function(){Ce.value="",Ne.value="",qe()});D.addEventListener("change",pr);re.addEventListener("input",u);C.addEventListener("input",f);Z.addEventListener("input",d);Pe.addEventListener("input",Ee);function Ke(e){r(e).addEventListener("click",function(){let t=!0;if(re.value==""&&(re.classList.add(L),t=!1),o(C.value)==!1&&(C.classList.add(L),t=!1),l(Z.value)==!1&&(Z.classList.add(L),t=!1),Z.value!=""&&C.value==""&&(C.classList.add(L),t=!1),D.value==""&&(D.classList.add(L),t=!1),t==!1)return x(N,M);qe(),M.innerText="...",M.classList.remove(he)})}async function pr(){v(D,N,M);let e=this.files[0],a=[c(e),mr(e)];p(a,N,D,M),m(e,N,D,M),h(e,Ce,Ne)}function mr(e){return Se(e.type)?"":`The chosen file mime type ${e.type} is probably not suitable for an intro.`}function qe(){dr.innerHTML="",fr.innerHTML="",M.innerHTML="",M.classList.add(he),N.innerText="",N.classList.add(he),C.classList.remove(L),Z.classList.remove(L),re.classList.remove(L),Pe.classList.remove(L),D.classList.remove(L)}var hr="uploader-magazine-form",w="is-invalid",ve="d-none",vr=r(hr),K=r("uploader-magazine-alert"),S=r("uploader-magazine-file"),Ge=r("uploader-magazine-last-modified"),xr=r("uploader-magazine-list-1"),Oe=r("uploader-magazine-magic"),_=r("uploader-magazine-month"),ae=r("uploader-magazine-releaser-1"),z=r("uploader-magazine-results"),P=r("uploader-magazine-year");vr.addEventListener("reset",function(){Ge.value="",Oe.value="",Ve()});S.addEventListener("change",Lr);ae.addEventListener("input",u);P.addEventListener("input",f);_.addEventListener("input",d);function Ue(e){r(e).addEventListener("click",function(){let t=!0;if(ae.value==""&&(ae.classList.add(w),t=!1),o(P.value)==!1&&(P.classList.add(w),t=!1),l(_.value)==!1&&(_.classList.add(w),t=!1),_.value!=""&&P.value==""&&(P.classList.add(w),t=!1),S.value==""&&(S.classList.add(w),t=!1),t==!1)return x(K,z);Ve(),z.innerText="...",z.classList.remove(ve)})}async function Lr(){v(S,K,z);let e=this.files[0],a=[c(e),gr(e)];p(a,K,S,z),m(e,K,S,z),h(e,Ge,Oe)}function gr(e){return He(e.type)?"":`The chosen file mime type ${e.type} is probably not suitable for an image.`}function Ve(){xr.innerHTML="",z.innerHTML="",z.classList.add(ve),K.innerText="",K.classList.add(ve),P.classList.remove(w),_.classList.remove(w),ae.classList.remove(w),S.classList.remove(w)}var yr="uploader-text-form",T="is-invalid",xe="d-none",wr=r(yr),G=r("uploader-text-alert"),H=r("uploader-text-file"),Xe=r("uploader-text-last-modified"),Tr=r("uploader-text-list-1"),br=r("uploader-text-list-2"),Ze=r("uploader-text-magic"),J=r("uploader-text-month"),se=r("uploader-text-releaser-1"),$=r("uploader-text-results"),q=r("uploader-text-year");wr.addEventListener("reset",function(){Xe.value="",Ze.value="",Je()});H.addEventListener("change",Er);se.addEventListener("input",u);q.addEventListener("input",f);J.addEventListener("input",d);function _e(e){r(e).addEventListener("click",function(){let t=!0;if(se.value==""&&(se.classList.add(T),t=!1),o(q.value)==!1&&(q.classList.add(T),t=!1),l(J.value)==!1&&(J.classList.add(T),t=!1),J.value!=""&&q.value==""&&(q.classList.add(T),t=!1),H.value==""&&(H.classList.add(T),t=!1),t==!1)return x(G,$);Je(),$.innerText="...",$.classList.remove(xe)})}async function Er(){v(H,G,$);let e=this.files[0],a=[c(e),kr(e)];p(a,G,H,$),m(e,G,H,$),h(e,Xe,Ze)}function kr(e){return Ye(e.type)?"":`The chosen file mime type ${e.type} is probably not suitable for a text.`}function Je(){Tr.innerHTML="",br.innerHTML="",$.innerHTML="",$.classList.add(xe),G.innerText="",G.classList.add(xe),q.classList.remove(T),J.classList.remove(T),se.classList.remove(T),H.classList.remove(T)}var Mr="uploader-advanced-form",i="is-invalid",Le="d-none",zr=r(Mr),U=r("uploader-advanced-alert"),ne=r("uploader-advanced-category"),$r=r("uploader-advanced-classification-help"),ie=r("uploader-advanced-day"),Y=r("uploader-advanced-file"),Qe=r("uploader-advanced-last-modified"),Br=r("uploader-advanced-list-1"),Ir=r("uploader-advanced-list-2"),We=r("uploader-advanced-magic"),Q=r("uploader-advanced-month"),oe=r("uploader-advanced-operating-system"),le=r("uploader-advanced-releaser-1"),B=r("uploader-advanced-results"),O=r("uploader-advanced-year");zr.addEventListener("reset",function(){Qe.value="",We.value="",tt()});Y.addEventListener("change",Dr);le.addEventListener("input",u);O.addEventListener("input",f);Q.addEventListener("input",d);ie.addEventListener("input",be);ne.addEventListener("change",de);oe.addEventListener("change",de);function et(e){r(e).addEventListener("click",function(){let t=!0;if(le.value==""&&(le.classList.add(i),t=!1),o(O.value)==!1&&(O.classList.add(i),t=!1),l(Q.value)==!1&&(Q.classList.add(i),t=!1),W(ie.value)==!1&&(ie.classList.add(i),t=!1),Q.value!=""&&O.value==""&&(O.classList.add(i),t=!1),Y.value==""&&(Y.classList.add(i),t=!1),oe.value==""&&(oe.classList.add(i),t=!1),ne.value==""&&(ne.classList.add(i),t=!1),t==!1)return x(U,B);tt(),B.innerText="...",B.classList.remove(Le)})}async function Dr(){v(Y,U,B);let e=this.files[0],a=[c(e),Sr(e)];p(a,U,Y,B),m(e,U,Y,B),h(e,Qe,We)}function Sr(e){return Ie(e.type)?`The chosen file mime type ${e.type} is probably not suitable for an upload.`:""}function tt(){Br.innerHTML="",Ir.innerHTML="",B.innerHTML="",$r.innerHTML="",B.classList.add(Le),U.innerText="",U.classList.add(Le),O.classList.remove(i),Q.classList.remove(i),ie.classList.remove(i),le.classList.remove(i),Y.classList.remove(i),oe.classList.remove(i),ne.classList.remove(i)}(()=>{"use strict";ke(),pe("demozoo-submission","Demozoo"),pe("pouet-submission","Pou\xEBt"),Re("uploader-image-submit"),F("uploader-image-form","uploader-image-progress"),Ke("uploader-intro-submit"),F("uploader-intro-form","uploader-intro-progress"),Ue("uploader-magazine-submit"),F("uploader-magazine-form","uploader-magazine-progress"),_e("uploader-text-submit"),F("uploader-text-form","uploader-text-progress"),et("uploader-advanced-submit"),F("uploader-advanced-form","uploader-advanced-progress")})();})();
