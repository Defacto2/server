/* uploader.min.js Â© Defacto2 2024 */
(()=>{function r(e){let o=document.getElementById(e);if(o==null)throw new Error(`The ${e} element is null.`);return o}function i(e){if(`${e}`=="")return!0;let o=1980,t=new Date().getFullYear();return!(e<o||e>t)}function s(e){return`${e}`==""?!0:!(e<1||e>12)}function xe(e,o){if(e=="")return!0;let t=Number(e),n=Number(o);if(!Number.isInteger(n)||n<1)throw new Error(`The ID sanity value is invalid: ${n}`);return Number.isInteger(t)&&t>0&&t<=n}var a="is-invalid",y="d-none",We=100,le=1024*1024,ge=100*le;function E(e,o){if(e==null)throw new Error("The elementId value of focusModalById is null.");if(o==null)throw new Error("The submissionId value of focusModalById is null.");let t=document.getElementById(o);if(t==null)throw new Error(`The ${o} element is null.`);let n=r(e);if(n.addEventListener("shown.bs.modal",function(){t.focus()}),bootstrap===void 0)throw new Error("The bootstrap object is undefined.");return new bootstrap.Modal(n,{keyboard:!0})}async function et(e){if(e==null)throw new Error("The file value of checkSHA is null.");try{let o=await tt(e),t=await fetch(`/uploader/sha384/${o}`,{method:"PUT",headers:{"Content-Type":"text/plain"},body:o});if(!t.ok)throw new Error(`Hashing is not possible, server response: ${t.status}`);return await t.text()=="true"}catch(o){console.log(`Hashing is not possible: ${o}`)}}async function tt(e){if(e==null)throw new Error("The file value of sha384 is null.");try{let o=await e.arrayBuffer(),t=await crypto.subtle.digest("SHA-384",o);return Array.from(new Uint8Array(t)).map(n=>n.toString(16).padStart(2,"0")).join("")}catch(o){throw new Error(`Could not use arrayBuffer or crypto.subtle: ${o}`)}}function F(e,o){if(e==null)throw new Error("The formId value of progress is null.");if(o==null)throw new Error("The elementId value of progress is null.");htmx.on(`#${e}`,"htmx:xhr:progress",function(t){t.target.id==`${e}`&&htmx.find(`#${o}`).setAttribute("value",t.detail.loaded/t.detail.total*We)})}function l(e){if(e==null)throw new Error("The file value of checkSize is null.");return e.size>ge?`The chosen file is too big at ${Math.round(e.size/le)}MB, maximum size is ${ge/le}MB.`:""}function u(){return this.value==""?(this.classList.add(a),!1):(this.classList.remove(a),!0)}function c(){return console.log(`The month value is ${this.value}.`),s(this.value)==!1?(this.classList.add(a),!1):(this.classList.remove(a),!0)}function d(){return i(this.value)==!1?(this.classList.add(a),!1):(this.classList.remove(a),!0)}function f(e,o,t,n){if(e==null)throw new Error("The errors value of checkErrors is null.");if(o==null)throw new Error("The alert value of checkErrors is null.");if(t==null)throw new Error("The fileInput value of checkErrors is null.");if(n==null)throw new Error("The results value of checkErrors is null.");e=e.filter(g=>g!=""),!(e.length<=0)&&(o.innerText=e.join(" "),o.classList.remove(y),t.innerText="",t.classList.add(a),n.classList.add(y))}async function p(e,o,t,n){if(e==null)throw new Error("The file value of checkDuplicate is null.");if(o==null)throw new Error("The alert value of checkDuplicate is null.");if(t==null)throw new Error("The fileInput value of checkDuplicate is null.");if(n==null)throw new Error("The results value of checkDuplicate is null.");await et(e)!=!1&&(o.innerText=`The chosen file already exists in the database: ${e.name}`,o.classList.remove(y),t.innerText="",t.classList.add(a),n.classList.add(y))}function m(e,o,t){if(e==null)throw new Error("The file1 value of hiddenDetails is null.");if(o==null)throw new Error("The lastMod value of hiddenDetails is null.");if(t==null)throw new Error("The magic value of hiddenDetails is null.");let n=e.lastModified,g=new Date().getTime(),ve=60*60*1e3;g-n<ve||(o.value=n),e.type!=""&&(t.value=e.type)}function W(){return this.value==""?(this.classList.remove(a),!0):new RegExp(/^[a-zA-Z0-9_-]{11}$/).test(this.value)==!1?(this.classList.add(a),!1):(this.classList.remove(a),!0)}function h(e,o,t){if(e==null)throw new Error("The fileInput value of resetInput is null.");if(o==null)throw new Error("The alert value of resetInput is null.");if(t==null)throw new Error("The results value of resetInput is null.");e.innerText="",e.classList.remove(a),o.innerText="",o.classList.add(y),t.innerText="",t.classList.add(y)}function v(e,o){if(e==null)throw new Error("The alert value of submitError is null.");if(o==null)throw new Error("The results value of submitError is null.");e.innerText="Please correct the problems with the form.",e.classList.remove(y),o.innerText="",o.classList.add(y)}var rt=E("uploader-pouet-modal","pouet-submission"),ot=E("uploader-demozoo-modal","demozoo-submission"),nt=E("uploader-intro-modal","uploader-intro-file"),it=E("uploader-text-modal","uploader-text-file"),st=E("uploader-image-modal","uploader-image-file"),at=E("uploader-magazine-modal","uploader-magazine-file"),lt=E("uploader-advanced-modal","uploader-advanced-file"),ut="d",ct="p",dt="i",ft="n",pt="g",mt="m",ht="a";function we(){document.addEventListener("keydown",function(e){if(!(!e.ctrlKey||!e.altKey))switch(e.key){case ut:ot.show();break;case ct:rt.show();break;case dt:nt.show();break;case ft:it.show();break;case pt:st.show();break;case mt:at.show();break;case ht:lt.show();break}})}var ue="is-invalid",R="d-none";function ce(e,o){let t=r(e),n=r(`${e}-error`),g=r(`${e}-results`);r(`${e}-close`).addEventListener("click",Le),r(`${e}-clear`).addEventListener("click",Le);function Le(){t.value="",t.focus(),t.classList.remove(ue),n.innerText="",n.classList.add(R),g.innerHTML=""}let Qe=45e4,Ve=2e5;switch(e){case"demozoo-submission":Te(t,Qe);break;case"pouet-submission":Te(t,Ve);break}document.body.addEventListener("htmx:beforeRequest",function(){vt(n,g)}),document.body.addEventListener("htmx:afterRequest",function(X){if(X.detail.elt===null||X.detail.elt.id!==`${e}`)return;if(X.detail.successful)return Lt(n);let ae=X.detail.xhr;if(X.detail.failed&&ae)return ae.status===404?xt(n,g,o):wt(n,ae);gt(n)})}function Te(e,o){e.addEventListener("input",function(){if(!xe(e.value,o)){e.classList.add(ue);return}e.classList.remove(ue)})}function vt(e,o){o.innerHTML="",e.innerText="",e.classList.add(R)}function Lt(e){e.classList.add(R),e.innerText=""}function xt(e,o,t){o.innerText=`Production not found on ${t}.`,e.classList.add(R),e.innerText=""}function gt(e){e.innerText="Something with the browser is not working, please refresh the page.",e.classList.remove(R)}function wt(e,o){e.innerText=`Something went wrong, ${o.status} status: ${o.responseText}.`,e.classList.remove(R)}var Tt="application/x-freearc",bt="application/x-bzip",yt="application/x-bzip2",Et="application/gzip",kt="application/vnd.rar",Mt="application/x-tar",zt="application/zip",$t="application/x-7z-compressed",It="application/x-msdos-program",Bt="image/gif",St="image/jpeg",Dt="image/png";function be(){return[It]}function ee(){return[Tt,bt,yt,Et,kt,Mt,zt,$t]}function ye(){return["application/octet-stream","application/x-binary"]}function Ht(){return[Bt,St,Dt]}function Ee(){return["text/plain"]}function ke(e){return Ht().concat(ee()).includes(e)}function te(e){return be().concat(ee(),ye()).includes(e)}function Me(e){return Ee().concat(ee(),be(),ye()).includes(e)}function ze(e){return Ee().concat(ee()).includes(e)}var Yt="uploader-image-form",w="is-invalid",de="d-none",Ft=r(Yt),j=r("uploader-image-alert"),B=r("uploader-image-file"),$e=r("uploader-image-last-modified"),Rt=r("uploader-image-list-1"),Ct=r("uploader-image-list-2"),Ie=r("uploader-image-magic"),Z=r("uploader-image-month"),re=r("uploader-image-releaser-1"),k=r("uploader-image-results"),C=r("uploader-image-year");Ft.addEventListener("reset",function(){$e.value="",Ie.value="",Se()});B.addEventListener("change",jt);re.addEventListener("input",u);C.addEventListener("input",d);Z.addEventListener("input",c);function Be(e){r(e).addEventListener("click",function(){let t=!0;if(re.value==""&&(re.classList.add(w),t=!1),i(C.value)==!1&&(C.classList.add(w),t=!1),s(Z.value)==!1&&(Z.classList.add(w),t=!1),Z.value!=""&&C.value==""&&(C.classList.add(w),t=!1),B.value==""&&(B.classList.add(w),t=!1),t==!1)return v(j,k);Se(),k.innerText="...",k.classList.remove(de)})}async function jt(){h(B,j,k);let e=this.files[0],o=[l(e),At(e)];f(o,j,B,k),p(e,j,B,k),m(e,$e,Ie)}function At(e){return ke(e.type)?"":`The chosen file mime type ${e.type} is probably not suitable for an image.`}function Se(){Rt.innerHTML="",Ct.innerHTML="",k.innerHTML="",k.classList.add(de),j.innerText="",j.classList.add(de),C.classList.remove(w),Z.classList.remove(w),re.classList.remove(w),B.classList.remove(w)}var Nt="uploader-intro-form",L="is-invalid",fe="d-none",Pt=r(Nt),N=r("uploader-intro-alert"),S=r("uploader-intro-file"),De=r("uploader-intro-last-modified"),Kt=r("uploader-intro-list-1"),qt=r("uploader-intro-list-2"),He=r("uploader-intro-magic"),_=r("uploader-intro-month"),oe=r("uploader-intro-releaser-1"),M=r("uploader-intro-results"),A=r("uploader-intro-year"),Ye=r("uploader-intro-youtube");Pt.addEventListener("reset",function(){De.value="",He.value="",Re()});S.addEventListener("change",Gt);oe.addEventListener("input",u);A.addEventListener("input",d);_.addEventListener("input",c);Ye.addEventListener("input",W);function Fe(e){r(e).addEventListener("click",function(){let t=!0;if(oe.value==""&&(oe.classList.add(L),t=!1),i(A.value)==!1&&(A.classList.add(L),t=!1),s(_.value)==!1&&(_.classList.add(L),t=!1),_.value!=""&&A.value==""&&(A.classList.add(L),t=!1),S.value==""&&(S.classList.add(L),t=!1),t==!1)return v(N,M);Re(),M.innerText="...",M.classList.remove(fe)})}async function Gt(){h(S,N,M);let e=this.files[0],o=[l(e),Ot(e)];f(o,N,S,M),p(e,N,S,M),m(e,De,He)}function Ot(e){return te(e.type)?"":`The chosen file mime type ${e.type} is probably not suitable for an intro.`}function Re(){Kt.innerHTML="",qt.innerHTML="",M.innerHTML="",M.classList.add(fe),N.innerText="",N.classList.add(fe),A.classList.remove(L),_.classList.remove(L),oe.classList.remove(L),Ye.classList.remove(L),S.classList.remove(L)}var Ut="uploader-magazine-form",T="is-invalid",pe="d-none",Xt=r(Ut),K=r("uploader-magazine-alert"),D=r("uploader-magazine-file"),Ce=r("uploader-magazine-last-modified"),Zt=r("uploader-magazine-list-1"),je=r("uploader-magazine-magic"),J=r("uploader-magazine-month"),ne=r("uploader-magazine-releaser-1"),z=r("uploader-magazine-results"),P=r("uploader-magazine-year");Xt.addEventListener("reset",function(){Ce.value="",je.value="",Ne()});D.addEventListener("change",_t);ne.addEventListener("input",u);P.addEventListener("input",d);J.addEventListener("input",c);function Ae(e){r(e).addEventListener("click",function(){let t=!0;if(ne.value==""&&(ne.classList.add(T),t=!1),i(P.value)==!1&&(P.classList.add(T),t=!1),s(J.value)==!1&&(J.classList.add(T),t=!1),J.value!=""&&P.value==""&&(P.classList.add(T),t=!1),D.value==""&&(D.classList.add(T),t=!1),t==!1)return v(K,z);Ne(),z.innerText="...",z.classList.remove(pe)})}async function _t(){h(D,K,z);let e=this.files[0],o=[l(e),Jt(e)];f(o,K,D,z),p(e,K,D,z),m(e,Ce,je)}function Jt(e){return Me(e.type)?"":`The chosen file mime type ${e.type} is probably not suitable for an image.`}function Ne(){Zt.innerHTML="",z.innerHTML="",z.classList.add(pe),K.innerText="",K.classList.add(pe),P.classList.remove(T),J.classList.remove(T),ne.classList.remove(T),D.classList.remove(T)}var Qt="uploader-text-form",b="is-invalid",me="d-none",Vt=r(Qt),G=r("uploader-text-alert"),H=r("uploader-text-file"),Pe=r("uploader-text-last-modified"),Wt=r("uploader-text-list-1"),er=r("uploader-text-list-2"),Ke=r("uploader-text-magic"),Q=r("uploader-text-month"),ie=r("uploader-text-releaser-1"),$=r("uploader-text-results"),q=r("uploader-text-year");Vt.addEventListener("reset",function(){Pe.value="",Ke.value="",Ge()});H.addEventListener("change",tr);ie.addEventListener("input",u);q.addEventListener("input",d);Q.addEventListener("input",c);function qe(e){r(e).addEventListener("click",function(){let t=!0;if(ie.value==""&&(ie.classList.add(b),t=!1),i(q.value)==!1&&(q.classList.add(b),t=!1),s(Q.value)==!1&&(Q.classList.add(b),t=!1),Q.value!=""&&q.value==""&&(q.classList.add(b),t=!1),H.value==""&&(H.classList.add(b),t=!1),t==!1)return v(G,$);Ge(),$.innerText="...",$.classList.remove(me)})}async function tr(){h(H,G,$);let e=this.files[0],o=[l(e),rr(e)];f(o,G,H,$),p(e,G,H,$),m(e,Pe,Ke)}function rr(e){return ze(e.type)?"":`The chosen file mime type ${e.type} is probably not suitable for a text.`}function Ge(){Wt.innerHTML="",er.innerHTML="",$.innerHTML="",$.classList.add(me),G.innerText="",G.classList.add(me),q.classList.remove(b),Q.classList.remove(b),ie.classList.remove(b),H.classList.remove(b)}var or="uploader-intro-form",x="is-invalid",he="d-none",nr=r(or),U=r("uploader-intro-alert"),Y=r("uploader-intro-file"),Oe=r("uploader-intro-last-modified"),ir=r("uploader-intro-list-1"),sr=r("uploader-intro-list-2"),Ue=r("uploader-intro-magic"),V=r("uploader-intro-month"),se=r("uploader-intro-releaser-1"),I=r("uploader-intro-results"),O=r("uploader-intro-year"),Xe=r("uploader-intro-youtube");nr.addEventListener("reset",function(){Oe.value="",Ue.value="",_e()});Y.addEventListener("change",ar);se.addEventListener("input",u);O.addEventListener("input",d);V.addEventListener("input",c);Xe.addEventListener("input",W);function Ze(e){r(e).addEventListener("click",function(){let t=!0;if(se.value==""&&(se.classList.add(x),t=!1),i(O.value)==!1&&(O.classList.add(x),t=!1),s(V.value)==!1&&(V.classList.add(x),t=!1),V.value!=""&&O.value==""&&(O.classList.add(x),t=!1),Y.value==""&&(Y.classList.add(x),t=!1),t==!1)return v(U,I);_e(),I.innerText="...",I.classList.remove(he)})}async function ar(){h(Y,U,I);let e=this.files[0],o=[l(e),lr(e)];f(o,U,Y,I),p(e,U,Y,I),m(e,Oe,Ue)}function lr(e){return te(e.type)?"":`The chosen file mime type ${e.type} is probably not suitable for an intro.`}function _e(){ir.innerHTML="",sr.innerHTML="",I.innerHTML="",I.classList.add(he),U.innerText="",U.classList.add(he),O.classList.remove(x),V.classList.remove(x),se.classList.remove(x),Xe.classList.remove(x),Y.classList.remove(x)}(()=>{"use strict";we(),ce("demozoo-submission","Demozoo"),ce("pouet-submission","Pou\xEBt"),Be("uploader-image-submit"),F("uploader-image-form","uploader-image-progress"),Fe("uploader-intro-submit"),F("uploader-intro-form","uploader-intro-progress"),Ae("uploader-magazine-submit"),F("uploader-magazine-form","uploader-magazine-progress"),qe("uploader-text-submit"),F("uploader-text-form","uploader-text-progress"),Ze("uploader-advanced-submit"),F("uploader-advanced-form","uploader-advanced-progress")})();})();
