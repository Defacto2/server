/* uploader.min.js Â© Defacto2 2024 */
(()=>{function a(e){let s=document.getElementById(e);if(s==null)throw new Error(`The ${e} element is null.`);return s}function l(e){if(`${e}`=="")return!0;let s=1980,t=new Date().getFullYear();return!(e<s||e>t)}function d(e){return`${e}`==""?!0:!(e<1||e>12)}function B(e){return`${e}`==""?!0:!(e<1||e>31)}function se(e){let s=document.getElementById(e);if(s==null)throw new Error(`The ${e} element is null.`);s.addEventListener("click",function(){let t="Choose...",o=!0;ae(),I.value==""&&(I.classList.add(i),o=!1),(w.value==""||w.value==t)&&(w.classList.add(i),o=!1),(M.value==""||M.value==t)&&(M.classList.add(i),o=!1),$.value==""&&($.classList.add(i),o=!1),z.value==""&&(z.classList.add(i),o=!1),l(S.value)==!1&&(S.classList.add(i),o=!1),d(Y.value)==!1&&(Y.classList.add(i),o=!1),B(F.value)==!1&&(F.classList.add(i),o=!1),o==!0&&oe.submit()})}var i="is-invalid",oe=document.getElementById("advancedUploader");oe.addEventListener("reset",ae);function ae(){I.classList.remove(i),w.classList.remove(i),M.classList.remove(i),$.classList.remove(i),z.classList.remove(i),S.classList.remove(i),Y.classList.remove(i),F.classList.remove(i)}var I=document.getElementById("advFile"),w=document.getElementById("advSelOS"),M=document.getElementById("advSelCat"),$=document.getElementById("advTitle"),z=document.getElementById("releasersAdv"),S=document.getElementById("advYear"),Y=document.getElementById("advMonth"),F=document.getElementById("advDay");var R=document.getElementById("imageFile"),C=document.getElementById("imageTitle"),D=document.getElementById("imageReleasers"),U=document.getElementById("imageYear"),j=document.getElementById("imageMonth"),ne=document.getElementById("imageUploader"),c="is-invalid";function ie(){R.classList.remove(c),C.classList.remove(c),D.classList.remove(c),U.classList.remove(c),j.classList.remove(c)}ne.addEventListener("reset",ie);function re(e){let s=document.getElementById(e);if(s==null)throw new Error(`The ${e} element is null.`);s.addEventListener("click",function(){let t=!0;ie(),R.value==""&&(R.classList.add(c),t=!1),C.value==""&&(C.classList.add(c),t=!1),D.value==""&&(D.classList.add(c),t=!1),l(U.value)==!1&&(U.classList.add(c),t=!1),d(j.value)==!1&&(j.classList.add(c),t=!1),t==!0&&ne.submit()})}var ge="application/x-freearc",he="application/octet-stream",xe="application/x-bzip",ye="application/x-bzip2",Ee="application/gzip",be="application/vnd.rar",Be="application/x-tar",we="application/zip",Me="application/x-7z-compressed";function Te(e){return[ge,xe,ye,Ee,be,Be,we,Me].includes(e)!=!1}function ke(e){return[he].includes(e)}function le(e){return ok=!1,ok=ke(e),!!(ok||(ok=Te(e),ok))}var H="uploader-intro-form",n="is-invalid",h="d-none",A=1024*1024,de=100*A,Ie=100,$e=a(H),f=a("uploader-intro-alert"),E=a("uploader-intro-file"),ze=a("uploader-intro-list-1"),Se=a("uploader-intro-list-2"),v=a("uploader-intro-month"),L=a("uploader-intro-releaser-1"),P=a("uploader-intro-results"),m=a("uploader-intro-year"),p=a("uploader-intro-youtube");$e.addEventListener("reset",me);E.addEventListener("change",K);L.addEventListener("input",Re);m.addEventListener("input",De);v.addEventListener("input",Ce);p.addEventListener("input",Ue);function ce(e){a(e).addEventListener("click",function(){let t=!0;if(L.value==""&&(L.classList.add(n),t=!1),l(m.value)==!1&&(m.classList.add(n),t=!1),d(v.value)==!1&&(v.classList.add(n),t=!1),v.value!=""&&m.value==""&&(m.classList.add(n),t=!1),E.value==""&&(E.classList.add(n),t=!1),t==!1){f.innerText="Please correct the problems with the form.",f.classList.remove(h);return}me(),P.classList.remove(h)})}function ue(){htmx.on(`#${H}`,"htmx:xhr:progress",function(e){e.target.id==`${H}`&&htmx.find("#uploader-intro-progress").setAttribute("value",e.detail.loaded/e.detail.total*Ie)})}var K=class{constructor(){let s=this.files[0],t="";E.classList.remove(n),f.innerText="",f.classList.add(h);let o=[Ye(s),Fe(s)];if(o=o.filter(g=>g!=""),o.length>0){f.innerText=o.join(" "),f.classList.remove(h),this.value=t,this.classList.add(n);return}}};function Ye(e){return e.size>de?`The chosen file is too big at ${Math.round(e.size/A)}MB, maximum size is ${de/A}MB.`:""}function Fe(e){return le(e.type)?"":`The chosen file mime type ${e.type} is probably not suitable for an intro.`}function me(){ze.innerHTML="",Se.innerHTML="",P.innerHTML="",P.classList.add(h),f.innerText="",f.classList.add(h),m.classList.remove(n),v.classList.remove(n),L.classList.remove(n),p.classList.remove(n),E.classList.remove(n)}function Re(){return L.value==""?(L.classList.add(n),!1):(L.classList.remove(n),!0)}function Ce(){return d(v.value)==!1?(v.classList.add(n),!1):(v.classList.remove(n),!0)}function De(){return l(m.value)==!1?(m.classList.add(n),!1):(m.classList.remove(n),!0)}function Ue(){return p.value==""?(p.classList.remove(n),!0):new RegExp(/^[a-zA-Z0-9_-]{11}$/).test(p.value)==!1?(p.classList.add(n),!1):(p.classList.remove(n),!0)}function b(e){if(bootstrap===void 0)throw new Error("The bootstrap object is undefined.");let s=a(e);return new bootstrap.Modal(s)}function T(e,s){let t=document.getElementById(s);if(t==null)throw new Error(`The ${s} element is null.`);let o=a(e);if(o.addEventListener("shown.bs.modal",function(){t.focus()}),bootstrap===void 0)throw new Error("The bootstrap object is undefined.");return new bootstrap.Modal(o)}var je=T("uploader-pouet-modal","pouet-submission"),He=T("uploader-demozoo-modal","demozoo-submission"),Ae=T("uploader-intro-modal","uploader-intro-file"),Pe=b("uploaderText"),Ke=b("uploaderImg"),qe=b("uploaderMag"),Ge=b("uploaderAdv"),Oe="d",Xe="p",Ze="i",_e="n",Je="g",Ne="m",Qe="a";function fe(){document.addEventListener("keydown",function(e){if(!(!e.ctrlKey||!e.altKey))switch(e.key){case Oe:He.show();break;case Xe:je.show();break;case Ze:Ae.show();break;case _e:Pe.show();break;case Je:Ke.show();break;case Ne:qe.show();break;case Qe:Ge.show();break}})}var q=document.getElementById("magFile"),G=document.getElementById("magTitle"),O=document.getElementById("magIssue"),X=document.getElementById("magYear"),Z=document.getElementById("magMonth"),_=document.getElementById("magDay"),r="is-invalid";function Ve(){q.classList.remove(r),G.classList.remove(r),O.classList.remove(r),X.classList.remove(r),Z.classList.remove(r),_.classList.remove(r)}var We=document.getElementById("magUploader");function ve(e){let s=document.getElementById(e);if(s==null)throw new Error(`The ${e} element is null.`);s.addEventListener("click",function(){let t=!0;Ve(),q.value==""&&(q.classList.add(r),t=!1),G.value==""&&(G.classList.add(r),t=!1),O.value==""&&(O.classList.add(r),t=!1),l(X.value)==!1&&(X.classList.add(r),t=!1),d(Z.value)==!1&&(Z.classList.add(r),t=!1),B(_.value)==!1&&(_.classList.add(r),t=!1),t==!0&&We.submit()})}function pe(e,s){let t=document.getElementById(e);if(t==null)throw new Error(`The ${e} element is null.`);let o=document.getElementById(s);if(o==null)throw new Error(`The ${s} form element is null.`);o.addEventListener("reset",Le),t.addEventListener("click",function(){et()==!0&&o.submit()})}var J=a("textFile"),N=a("textTitle"),Q=a("textReleasers"),V=a("textYear"),W=a("textMonth"),u="is-invalid";function Le(){J.classList.remove(u),N.classList.remove(u),Q.classList.remove(u),V.classList.remove(u),W.classList.remove(u)}function et(){let e=!0;return Le(),J.value==""&&(J.classList.add(u),e=!1),N.value==""&&(N.classList.add(u),e=!1),Q.value==""&&(Q.classList.add(u),e=!1),l(V.value)==!1&&(V.classList.add(u),e=!1),d(W.value)==!1&&(W.classList.add(u),e=!1),e}var x="d-none";function ee(e,s){let t=a(e),o=a(`${e}-error`),g=a(`${e}-results`);a(`${e}-close`).addEventListener("click",te),a(`${e}-clear`).addEventListener("click",te);function te(){t.value="",t.focus(),o.innerText="",o.classList.add(x),g.innerHTML=""}document.body.addEventListener("htmx:beforeRequest",function(){tt(o,g)}),document.body.addEventListener("htmx:afterRequest",function(y){if(y.detail.elt===null||y.detail.elt.id!==`${e}`)return;if(y.detail.successful)return st(o);let k=y.detail.xhr;if(y.detail.failed&&k)return k.status===404?ot(o,g,s):nt(o,k);at(o)})}function tt(e,s){s.innerHTML="",e.innerText="",e.classList.add(x)}function st(e){e.classList.add(x),e.innerText=""}function ot(e,s,t){s.innerText=`Production not found on ${t}.`,e.classList.add(x),e.innerText=""}function at(e){e.innerText="Something with the browser is not working, please refresh the page.",e.classList.remove(x)}function nt(e,s){e.innerText=`Something went wrong, ${s.status} status: ${s.responseText}.`,e.classList.remove(x)}(()=>{"use strict";fe(),se("advSubmit"),re("imageSubmit"),ce("uploader-intro-submit"),ue(),ve("magSubmit"),pe("textSubmit","textUploader"),ee("demozoo-submission","Demozoo"),ee("pouet-submission","Pou\xEBt")})();})();
