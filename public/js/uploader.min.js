/* uploader.min.js Â© Defacto2 2024 */
(()=>{function o(e){let s=document.getElementById(e);if(s==null)throw new Error(`The ${e} element is null.`);return s}function l(e){if(`${e}`=="")return!0;let s=1980,t=new Date().getFullYear();return!(e<s||e>t)}function d(e){return`${e}`==""?!0:!(e<1||e>12)}function b(e){return`${e}`==""?!0:!(e<1||e>31)}function ee(e){let s=document.getElementById(e);if(s==null)throw new Error(`The ${e} element is null.`);s.addEventListener("click",function(){let t="Choose...",n=!0;se(),$.value==""&&($.classList.add(i),n=!1),(B.value==""||B.value==t)&&(B.classList.add(i),n=!1),(w.value==""||w.value==t)&&(w.classList.add(i),n=!1),k.value==""&&(k.classList.add(i),n=!1),S.value==""&&(S.classList.add(i),n=!1),l(Y.value)==!1&&(Y.classList.add(i),n=!1),d(F.value)==!1&&(F.classList.add(i),n=!1),b(R.value)==!1&&(R.classList.add(i),n=!1),n==!0&&te.submit()})}var i="is-invalid",te=document.getElementById("advancedUploader");te.addEventListener("reset",se);function se(){$.classList.remove(i),B.classList.remove(i),w.classList.remove(i),k.classList.remove(i),S.classList.remove(i),Y.classList.remove(i),F.classList.remove(i),R.classList.remove(i)}var $=document.getElementById("advFile"),B=document.getElementById("advSelOS"),w=document.getElementById("advSelCat"),k=document.getElementById("advTitle"),S=document.getElementById("releasersAdv"),Y=document.getElementById("advYear"),F=document.getElementById("advMonth"),R=document.getElementById("advDay");var z=document.getElementById("imageFile"),C=document.getElementById("imageTitle"),D=document.getElementById("imageReleasers"),U=document.getElementById("imageYear"),H=document.getElementById("imageMonth"),oe=document.getElementById("imageUploader"),c="is-invalid";function ne(){z.classList.remove(c),C.classList.remove(c),D.classList.remove(c),U.classList.remove(c),H.classList.remove(c)}oe.addEventListener("reset",ne);function ae(e){let s=document.getElementById(e);if(s==null)throw new Error(`The ${e} element is null.`);s.addEventListener("click",function(){let t=!0;ne(),z.value==""&&(z.classList.add(c),t=!1),C.value==""&&(C.classList.add(c),t=!1),D.value==""&&(D.classList.add(c),t=!1),l(U.value)==!1&&(U.classList.add(c),t=!1),d(H.value)==!1&&(H.classList.add(c),t=!1),t==!0&&oe.submit()})}var j="uploader-intro-form",a="is-invalid",x="d-none",ie=1024*1024,ve=100,pe=o(j),M=o("uploader-intro-file"),m=o("uploader-intro-year"),f=o("uploader-intro-month"),p=o("uploader-intro-releaser-1"),Le=o("uploader-intro-list-1"),ge=o("uploader-intro-list-2"),v=o("uploader-intro-youtube"),L=o("uploader-intro-alert"),A=o("uploader-intro-results");pe.addEventListener("reset",de);p.addEventListener("input",he);m.addEventListener("input",Ee);f.addEventListener("input",xe);v.addEventListener("input",ye);function re(e){o(e).addEventListener("click",function(){let t=!0;if(p.value==""&&(p.classList.add(a),t=!1),l(m.value)==!1&&(m.classList.add(a),t=!1),d(f.value)==!1&&(f.classList.add(a),t=!1),f.value!=""&&m.value==""&&(m.classList.add(a),t=!1),M.value==""&&(M.classList.add(a),t=!1),t==!1){console.error("Submit failed. Please check the form.");return}de(),A.classList.remove(x)})}function le(){htmx.on(`#${j}`,"htmx:xhr:progress",function(e){e.target.id==`${j}`&&htmx.find("#uploader-intro-progress").setAttribute("value",e.detail.loaded/e.detail.total*ve)}),M.addEventListener("change",function(){let e=this.files[0],s="";L.innerText="",L.classList.add(x),e.size>10*ie&&(errSize=Math.round(e.size/ie),L.innerText=`The chosen file is too big at ${errSize}MB, maximum size is 100MB.`,L.classList.remove(x),this.value=s)})}function de(){Le.innerHTML="",ge.innerHTML="",A.innerHTML="",A.classList.add(x),L.innerText="",L.classList.add(x),m.classList.remove(a),f.classList.remove(a),p.classList.remove(a),v.classList.remove(a),M.classList.remove(a)}function he(){return p.value==""?(p.classList.add(a),!1):(p.classList.remove(a),!0)}function xe(){return d(f.value)==!1?(f.classList.add(a),!1):(f.classList.remove(a),!0)}function Ee(){return l(m.value)==!1?(m.classList.add(a),!1):(m.classList.remove(a),!0)}function ye(){return v.value==""?(v.classList.remove(a),!0):new RegExp(/^[a-zA-Z0-9_-]{11}$/).test(v.value)==!1?(v.classList.add(a),!1):(v.classList.remove(a),!0)}function E(e){if(bootstrap===void 0)throw new Error("The bootstrap object is undefined.");let s=o(e);return new bootstrap.Modal(s)}function T(e,s){let t=document.getElementById(s);if(t==null)throw new Error(`The ${s} element is null.`);let n=o(e);if(n.addEventListener("shown.bs.modal",function(){t.focus()}),bootstrap===void 0)throw new Error("The bootstrap object is undefined.");return new bootstrap.Modal(n)}var be=T("uploader-pouet-modal","pouet-submission"),Be=T("uploader-demozoo-modal","demozoo-submission"),we=T("uploader-intro-modal","uploader-intro-file"),Me=E("uploaderText"),Te=E("uploaderImg"),Ie=E("uploaderMag"),$e=E("uploaderAdv"),ke="d",Se="p",Ye="i",Fe="n",Re="g",ze="m",Ce="a";function ce(){document.addEventListener("keydown",function(e){if(!(!e.ctrlKey||!e.altKey))switch(e.key){case ke:Be.show();break;case Se:be.show();break;case Ye:we.show();break;case Fe:Me.show();break;case Re:Te.show();break;case ze:Ie.show();break;case Ce:$e.show();break}})}var P=document.getElementById("magFile"),K=document.getElementById("magTitle"),q=document.getElementById("magIssue"),G=document.getElementById("magYear"),O=document.getElementById("magMonth"),X=document.getElementById("magDay"),r="is-invalid";function De(){P.classList.remove(r),K.classList.remove(r),q.classList.remove(r),G.classList.remove(r),O.classList.remove(r),X.classList.remove(r)}var Ue=document.getElementById("magUploader");function ue(e){let s=document.getElementById(e);if(s==null)throw new Error(`The ${e} element is null.`);s.addEventListener("click",function(){let t=!0;De(),P.value==""&&(P.classList.add(r),t=!1),K.value==""&&(K.classList.add(r),t=!1),q.value==""&&(q.classList.add(r),t=!1),l(G.value)==!1&&(G.classList.add(r),t=!1),d(O.value)==!1&&(O.classList.add(r),t=!1),b(X.value)==!1&&(X.classList.add(r),t=!1),t==!0&&Ue.submit()})}function me(e,s){let t=document.getElementById(e);if(t==null)throw new Error(`The ${e} element is null.`);let n=document.getElementById(s);if(n==null)throw new Error(`The ${s} form element is null.`);n.addEventListener("reset",fe),t.addEventListener("click",function(){He()==!0&&n.submit()})}var Z=o("textFile"),_=o("textTitle"),J=o("textReleasers"),N=o("textYear"),Q=o("textMonth"),u="is-invalid";function fe(){Z.classList.remove(u),_.classList.remove(u),J.classList.remove(u),N.classList.remove(u),Q.classList.remove(u)}function He(){let e=!0;return fe(),Z.value==""&&(Z.classList.add(u),e=!1),_.value==""&&(_.classList.add(u),e=!1),J.value==""&&(J.classList.add(u),e=!1),l(N.value)==!1&&(N.classList.add(u),e=!1),d(Q.value)==!1&&(Q.classList.add(u),e=!1),e}var g="d-none";function V(e,s){let t=o(e),n=o(`${e}-error`),y=o(`${e}-results`);o(`${e}-close`).addEventListener("click",W),o(`${e}-clear`).addEventListener("click",W);function W(){t.value="",t.focus(),n.innerText="",n.classList.add(g),y.innerHTML=""}document.body.addEventListener("htmx:beforeRequest",function(){je(n,y)}),document.body.addEventListener("htmx:afterRequest",function(h){if(h.detail.elt===null||h.detail.elt.id!==`${e}`)return;if(h.detail.successful)return Ae(n);let I=h.detail.xhr;if(h.detail.failed&&I)return I.status===404?Pe(n,y,s):qe(n,I);Ke(n)})}function je(e,s){s.innerHTML="",e.innerText="",e.classList.add(g)}function Ae(e){e.classList.add(g),e.innerText=""}function Pe(e,s,t){s.innerText=`Production not found on ${t}.`,e.classList.add(g),e.innerText=""}function Ke(e){e.innerText="Something with the browser is not working, please refresh the page.",e.classList.remove(g)}function qe(e,s){e.innerText=`Something went wrong, ${s.status} status: ${s.responseText}.`,e.classList.remove(g)}(()=>{"use strict";ce(),ee("advSubmit"),ae("imageSubmit"),re("uploader-intro-submit"),le(),ue("magSubmit"),me("textSubmit","textUploader"),V("demozoo-submission","Demozoo"),V("pouet-submission","Pou\xEBt")})();})();
