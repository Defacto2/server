/* uploader.min.js Â© Defacto2 2024 */
(()=>{function o(e){let t=document.getElementById(e);if(t==null)throw new Error(`The ${e} element is null.`);return t}function a(e){if(`${e}`=="")return!0;let t=1980,r=new Date().getFullYear();return!(e<t||e>r)}function i(e){return`${e}`==""?!0:!(e<1||e>12)}function Le(e){return`${e}`==""?!0:!(e<1||e>31)}function xe(e,t){if(e=="")return!0;let r=Number(e),s=Number(t);if(!Number.isInteger(s)||s<1)throw new Error(`The ID sanity value is invalid: ${s}`);return Number.isInteger(r)&&r>0&&r<=s}function ge(e){let t=document.getElementById(e);if(t==null)throw new Error(`The ${e} element is null.`);t.addEventListener("click",function(){let r="Choose...",s=!0;ye(),re.value==""&&(re.classList.add(n),s=!1),(Z.value==""||Z.value==r)&&(Z.classList.add(n),s=!1),(_.value==""||_.value==r)&&(_.classList.add(n),s=!1),oe.value==""&&(oe.classList.add(n),s=!1),se.value==""&&(se.classList.add(n),s=!1),a(ne.value)==!1&&(ne.classList.add(n),s=!1),i(ae.value)==!1&&(ae.classList.add(n),s=!1),Le(ie.value)==!1&&(ie.classList.add(n),s=!1),s==!0&&we.submit()})}var n="is-invalid",we=document.getElementById("advancedUploader");we.addEventListener("reset",ye);function ye(){re.classList.remove(n),Z.classList.remove(n),_.classList.remove(n),oe.classList.remove(n),se.classList.remove(n),ne.classList.remove(n),ae.classList.remove(n),ie.classList.remove(n)}var re=document.getElementById("advFile"),Z=document.getElementById("advSelOS"),_=document.getElementById("advSelCat"),oe=document.getElementById("advTitle"),se=document.getElementById("releasersAdv"),ne=document.getElementById("advYear"),ae=document.getElementById("advMonth"),ie=document.getElementById("advDay");var l="is-invalid",p="d-none",et=100,le=1024*1024,Te=100*le;function Ee(e){if(e==null)throw new Error("The elementId value of getModalById is null.");if(bootstrap===void 0)throw new Error("The bootstrap object is undefined.");let t=o(e);return new bootstrap.Modal(t,{keyboard:!0})}function B(e,t){if(e==null)throw new Error("The elementId value of focusModalById is null.");if(t==null)throw new Error("The submissionId value of focusModalById is null.");let r=document.getElementById(t);if(r==null)throw new Error(`The ${t} element is null.`);let s=o(e);if(s.addEventListener("shown.bs.modal",function(){r.focus()}),bootstrap===void 0)throw new Error("The bootstrap object is undefined.");return new bootstrap.Modal(s,{keyboard:!0})}async function tt(e){if(e==null)throw new Error("The file value of checkSHA is null.");try{let t=await rt(e),r=await fetch(`/uploader/sha384/${t}`,{method:"PUT",headers:{"Content-Type":"text/plain"},body:t});if(!r.ok)throw new Error(`Hashing is not possible, server response: ${r.status}`);return await r.text()=="true"}catch(t){console.log(`Hashing is not possible: ${t}`)}}async function rt(e){if(e==null)throw new Error("The file value of sha384 is null.");try{let t=await e.arrayBuffer(),r=await crypto.subtle.digest("SHA-384",t);return Array.from(new Uint8Array(r)).map(s=>s.toString(16).padStart(2,"0")).join("")}catch(t){throw new Error(`Could not use arrayBuffer or crypto.subtle: ${t}`)}}function P(e,t){if(e==null)throw new Error("The formId value of progress is null.");if(t==null)throw new Error("The elementId value of progress is null.");htmx.on(`#${e}`,"htmx:xhr:progress",function(r){r.target.id==`${e}`&&htmx.find(`#${t}`).setAttribute("value",r.detail.loaded/r.detail.total*et)})}function h(e){if(e==null)throw new Error("The file value of checkSize is null.");return e.size>Te?`The chosen file is too big at ${Math.round(e.size/le)}MB, maximum size is ${Te/le}MB.`:""}function v(){return this.value==""?(this.classList.add(l),!1):(this.classList.remove(l),!0)}function L(){return console.log(`The month value is ${this.value}.`),i(this.value)==!1?(this.classList.add(l),!1):(this.classList.remove(l),!0)}function x(){return a(this.value)==!1?(this.classList.add(l),!1):(this.classList.remove(l),!0)}function g(e,t,r,s){if(e==null)throw new Error("The errors value of checkErrors is null.");if(t==null)throw new Error("The alert value of checkErrors is null.");if(r==null)throw new Error("The fileInput value of checkErrors is null.");if(s==null)throw new Error("The results value of checkErrors is null.");e=e.filter(c=>c!=""),!(e.length<=0)&&(t.innerText=e.join(" "),t.classList.remove(p),r.innerText="",r.classList.add(l),s.classList.add(p))}async function w(e,t,r,s){if(e==null)throw new Error("The file value of checkDuplicate is null.");if(t==null)throw new Error("The alert value of checkDuplicate is null.");if(r==null)throw new Error("The fileInput value of checkDuplicate is null.");if(s==null)throw new Error("The results value of checkDuplicate is null.");await tt(e)!=!1&&(t.innerText=`The chosen file already exists in the database: ${e.name}`,t.classList.remove(p),r.innerText="",r.classList.add(l),s.classList.add(p))}function y(e,t,r){if(e==null)throw new Error("The file1 value of hiddenDetails is null.");if(t==null)throw new Error("The lastMod value of hiddenDetails is null.");if(r==null)throw new Error("The magic value of hiddenDetails is null.");let s=e.lastModified,c=new Date().getTime(),he=60*60*1e3;c-s<he||(t.value=s),e.type!=""&&(r.value=e.type)}function be(){return this.value==""?(this.classList.remove(l),!0):new RegExp(/^[a-zA-Z0-9_-]{11}$/).test(this.value)==!1?(this.classList.add(l),!1):(this.classList.remove(l),!0)}function T(e,t,r){if(e==null)throw new Error("The fileInput value of resetInput is null.");if(t==null)throw new Error("The alert value of resetInput is null.");if(r==null)throw new Error("The results value of resetInput is null.");e.innerText="",e.classList.remove(l),t.innerText="",t.classList.add(p),r.innerText="",r.classList.add(p)}function E(e,t){if(e==null)throw new Error("The alert value of submitError is null.");if(t==null)throw new Error("The results value of submitError is null.");e.innerText="Please correct the problems with the form.",e.classList.remove(p),t.innerText="",t.classList.add(p)}var ot=B("uploader-pouet-modal","pouet-submission"),st=B("uploader-demozoo-modal","demozoo-submission"),nt=B("uploader-intro-modal","uploader-intro-file"),at=B("uploader-text-modal","uploader-text-file"),it=B("uploader-image-modal","uploader-image-file"),lt=B("uploader-magazine-modal","uploader-magazine-file"),ut=Ee("uploaderAdv"),ct="d",dt="p",ft="i",mt="n",pt="g",ht="m",vt="a";function ke(){document.addEventListener("keydown",function(e){if(!(!e.ctrlKey||!e.altKey))switch(e.key){case ct:st.show();break;case dt:ot.show();break;case ft:nt.show();break;case mt:at.show();break;case pt:it.show();break;case ht:lt.show();break;case vt:ut.show();break}})}var ue="is-invalid",H="d-none";function ce(e,t){let r=o(e),s=o(`${e}-error`),c=o(`${e}-results`);o(`${e}-close`).addEventListener("click",ve),o(`${e}-clear`).addEventListener("click",ve);function ve(){r.value="",r.focus(),r.classList.remove(ue),s.innerText="",s.classList.add(H),c.innerHTML=""}let Ve=45e4,We=2e5;switch(e){case"demozoo-submission":Me(r,Ve);break;case"pouet-submission":Me(r,We);break}document.body.addEventListener("htmx:beforeRequest",function(){Lt(s,c)}),document.body.addEventListener("htmx:afterRequest",function(O){if(O.detail.elt===null||O.detail.elt.id!==`${e}`)return;if(O.detail.successful)return xt(s);let te=O.detail.xhr;if(O.detail.failed&&te)return te.status===404?gt(s,c,t):yt(s,te);wt(s)})}function Me(e,t){e.addEventListener("input",function(){if(!xe(e.value,t)){e.classList.add(ue);return}e.classList.remove(ue)})}function Lt(e,t){t.innerHTML="",e.innerText="",e.classList.add(H)}function xt(e){e.classList.add(H),e.innerText=""}function gt(e,t,r){t.innerText=`Production not found on ${r}.`,e.classList.add(H),e.innerText=""}function wt(e){e.innerText="Something with the browser is not working, please refresh the page.",e.classList.remove(H)}function yt(e,t){e.innerText=`Something went wrong, ${t.status} status: ${t.responseText}.`,e.classList.remove(H)}var Tt="application/x-freearc",Et="application/x-bzip",bt="application/x-bzip2",kt="application/gzip",Mt="application/vnd.rar",zt="application/x-tar",Bt="application/zip",It="application/x-7z-compressed",$t="application/x-msdos-program",St="image/gif",Dt="image/jpeg",Ht="image/png";function ze(){return[$t]}function J(){return[Tt,Et,bt,kt,Mt,zt,Bt,It]}function Be(){return["application/octet-stream","application/x-binary"]}function Yt(){return[St,Dt,Ht]}function Ie(){return["text/plain"]}function $e(e){return Yt().concat(J()).includes(e)}function Se(e){return ze().concat(J(),Be()).includes(e)}function De(e){return Ie().concat(J(),ze(),Be()).includes(e)}function He(e){return Ie().concat(J()).includes(e)}var Ft="uploader-image-form",d="is-invalid",de="d-none",Ct=o(Ft),F=o("uploader-image-alert"),I=o("uploader-image-file"),Ye=o("uploader-image-last-modified"),Rt=o("uploader-image-list-1"),At=o("uploader-image-list-2"),Fe=o("uploader-image-magic"),K=o("uploader-image-month"),Q=o("uploader-image-releaser-1"),b=o("uploader-image-results"),Y=o("uploader-image-year");Ct.addEventListener("reset",function(){Ye.value="",Fe.value="",Re()});I.addEventListener("change",jt);Q.addEventListener("input",v);Y.addEventListener("input",x);K.addEventListener("input",L);function Ce(e){o(e).addEventListener("click",function(){let r=!0;if(Q.value==""&&(Q.classList.add(d),r=!1),a(Y.value)==!1&&(Y.classList.add(d),r=!1),i(K.value)==!1&&(K.classList.add(d),r=!1),K.value!=""&&Y.value==""&&(Y.classList.add(d),r=!1),I.value==""&&(I.classList.add(d),r=!1),r==!1)return E(F,b);Re(),b.innerText="...",b.classList.remove(de)})}async function jt(){T(I,F,b);let e=this.files[0],t=[h(e),Ut(e)];g(t,F,I,b),w(e,F,I,b),y(e,Ye,Fe)}function Ut(e){return $e(e.type)?"":`The chosen file mime type ${e.type} is probably not suitable for an image.`}function Re(){Rt.innerHTML="",At.innerHTML="",b.innerHTML="",b.classList.add(de),F.innerText="",F.classList.add(de),Y.classList.remove(d),K.classList.remove(d),Q.classList.remove(d),I.classList.remove(d)}var Nt="uploader-intro-form",u="is-invalid",fe="d-none",Ot=o(Nt),R=o("uploader-intro-alert"),$=o("uploader-intro-file"),Ae=o("uploader-intro-last-modified"),Pt=o("uploader-intro-list-1"),Kt=o("uploader-intro-list-2"),je=o("uploader-intro-magic"),q=o("uploader-intro-month"),V=o("uploader-intro-releaser-1"),k=o("uploader-intro-results"),C=o("uploader-intro-year"),Ue=o("uploader-intro-youtube");Ot.addEventListener("reset",function(){Ae.value="",je.value="",Oe()});$.addEventListener("change",qt);V.addEventListener("input",v);C.addEventListener("input",x);q.addEventListener("input",L);Ue.addEventListener("input",be);function Ne(e){o(e).addEventListener("click",function(){let r=!0;if(V.value==""&&(V.classList.add(u),r=!1),a(C.value)==!1&&(C.classList.add(u),r=!1),i(q.value)==!1&&(q.classList.add(u),r=!1),q.value!=""&&C.value==""&&(C.classList.add(u),r=!1),$.value==""&&($.classList.add(u),r=!1),r==!1)return E(R,k);Oe(),k.innerText="...",k.classList.remove(fe)})}async function qt(){T($,R,k);let e=this.files[0],t=[h(e),Gt(e)];g(t,R,$,k),w(e,R,$,k),y(e,Ae,je)}function Gt(e){return Se(e.type)?"":`The chosen file mime type ${e.type} is probably not suitable for an intro.`}function Oe(){Pt.innerHTML="",Kt.innerHTML="",k.innerHTML="",k.classList.add(fe),R.innerText="",R.classList.add(fe),C.classList.remove(u),q.classList.remove(u),V.classList.remove(u),Ue.classList.remove(u),$.classList.remove(u)}var Xt="uploader-magazine-form",f="is-invalid",me="d-none",Zt=o(Xt),j=o("uploader-magazine-alert"),S=o("uploader-magazine-file"),Pe=o("uploader-magazine-last-modified"),_t=o("uploader-magazine-list-1"),Ke=o("uploader-magazine-magic"),G=o("uploader-magazine-month"),W=o("uploader-magazine-releaser-1"),M=o("uploader-magazine-results"),A=o("uploader-magazine-year");Zt.addEventListener("reset",function(){Pe.value="",Ke.value="",Ge()});S.addEventListener("change",Jt);W.addEventListener("input",v);A.addEventListener("input",x);G.addEventListener("input",L);function qe(e){o(e).addEventListener("click",function(){let r=!0;if(W.value==""&&(W.classList.add(f),r=!1),a(A.value)==!1&&(A.classList.add(f),r=!1),i(G.value)==!1&&(G.classList.add(f),r=!1),G.value!=""&&A.value==""&&(A.classList.add(f),r=!1),S.value==""&&(S.classList.add(f),r=!1),r==!1)return E(j,M);Ge(),M.innerText="...",M.classList.remove(me)})}async function Jt(){T(S,j,M);let e=this.files[0],t=[h(e),Qt(e)];g(t,j,S,M),w(e,j,S,M),y(e,Pe,Ke)}function Qt(e){return De(e.type)?"":`The chosen file mime type ${e.type} is probably not suitable for an image.`}function Ge(){_t.innerHTML="",M.innerHTML="",M.classList.add(me),j.innerText="",j.classList.add(me),A.classList.remove(f),G.classList.remove(f),W.classList.remove(f),S.classList.remove(f)}var Vt="uploader-text-form",m="is-invalid",pe="d-none",Wt=o(Vt),N=o("uploader-text-alert"),D=o("uploader-text-file"),Xe=o("uploader-text-last-modified"),er=o("uploader-text-list-1"),tr=o("uploader-text-list-2"),Ze=o("uploader-text-magic"),X=o("uploader-text-month"),ee=o("uploader-text-releaser-1"),z=o("uploader-text-results"),U=o("uploader-text-year");Wt.addEventListener("reset",function(){Xe.value="",Ze.value="",Je()});D.addEventListener("change",rr);ee.addEventListener("input",v);U.addEventListener("input",x);X.addEventListener("input",L);function _e(e){o(e).addEventListener("click",function(){let r=!0;if(ee.value==""&&(ee.classList.add(m),r=!1),a(U.value)==!1&&(U.classList.add(m),r=!1),i(X.value)==!1&&(X.classList.add(m),r=!1),X.value!=""&&U.value==""&&(U.classList.add(m),r=!1),D.value==""&&(D.classList.add(m),r=!1),r==!1)return E(N,z);Je(),z.innerText="...",z.classList.remove(pe)})}async function rr(){T(D,N,z);let e=this.files[0],t=[h(e),or(e)];g(t,N,D,z),w(e,N,D,z),y(e,Xe,Ze)}function or(e){return He(e.type)?"":`The chosen file mime type ${e.type} is probably not suitable for a text.`}function Je(){er.innerHTML="",tr.innerHTML="",z.innerHTML="",z.classList.add(pe),N.innerText="",N.classList.add(pe),U.classList.remove(m),X.classList.remove(m),ee.classList.remove(m),D.classList.remove(m)}(()=>{"use strict";ke(),ce("demozoo-submission","Demozoo"),ce("pouet-submission","Pou\xEBt"),Ce("uploader-image-submit"),P("uploader-image-form","uploader-image-progress"),Ne("uploader-intro-submit"),P("uploader-intro-form","uploader-intro-progress"),qe("uploader-magazine-submit"),P("uploader-magazine-form","uploader-magazine-progress"),_e("uploader-text-submit"),P("uploader-text-form","uploader-text-progress"),ge("advSubmit")})();})();
