/* uploader.min.js Â© Defacto2 2024 */
(()=>{function n(e){let s=document.getElementById(e);if(s==null)throw new Error(`The ${e} element is null.`);return s}function l(e){if(`${e}`=="")return!0;let s=1980,t=new Date().getFullYear();return!(e<s||e>t)}function d(e){return`${e}`==""?!0:!(e<1||e>12)}function w(e){return`${e}`==""?!0:!(e<1||e>31)}function se(e,s){if(e=="")return!0;let t=Number(e),a=Number(s);if(!Number.isInteger(a)||a<1)throw new Error(`The ID sanity value is invalid: ${a}`);return Number.isInteger(t)&&t>0&&t<=a}function ae(e){let s=document.getElementById(e);if(s==null)throw new Error(`The ${e} element is null.`);s.addEventListener("click",function(){let t="Choose...",a=!0;oe(),k.value==""&&(k.classList.add(r),a=!1),(B.value==""||B.value==t)&&(B.classList.add(r),a=!1),(T.value==""||T.value==t)&&(T.classList.add(r),a=!1),I.value==""&&(I.classList.add(r),a=!1),S.value==""&&(S.classList.add(r),a=!1),l(z.value)==!1&&(z.classList.add(r),a=!1),d(Y.value)==!1&&(Y.classList.add(r),a=!1),w(F.value)==!1&&(F.classList.add(r),a=!1),a==!0&&ne.submit()})}var r="is-invalid",ne=document.getElementById("advancedUploader");ne.addEventListener("reset",oe);function oe(){k.classList.remove(r),B.classList.remove(r),T.classList.remove(r),I.classList.remove(r),S.classList.remove(r),z.classList.remove(r),Y.classList.remove(r),F.classList.remove(r)}var k=document.getElementById("advFile"),B=document.getElementById("advSelOS"),T=document.getElementById("advSelCat"),I=document.getElementById("advTitle"),S=document.getElementById("releasersAdv"),z=document.getElementById("advYear"),Y=document.getElementById("advMonth"),F=document.getElementById("advDay");var R=document.getElementById("imageFile"),C=document.getElementById("imageTitle"),D=document.getElementById("imageReleasers"),H=document.getElementById("imageYear"),U=document.getElementById("imageMonth"),re=document.getElementById("imageUploader"),c="is-invalid";function ie(){R.classList.remove(c),C.classList.remove(c),D.classList.remove(c),H.classList.remove(c),U.classList.remove(c)}re.addEventListener("reset",ie);function le(e){let s=document.getElementById(e);if(s==null)throw new Error(`The ${e} element is null.`);s.addEventListener("click",function(){let t=!0;ie(),R.value==""&&(R.classList.add(c),t=!1),C.value==""&&(C.classList.add(c),t=!1),D.value==""&&(D.classList.add(c),t=!1),l(H.value)==!1&&(H.classList.add(c),t=!1),d(U.value)==!1&&(U.classList.add(c),t=!1),t==!0&&re.submit()})}var Ee="application/x-freearc",we="application/octet-stream",Be="application/x-bzip",Te="application/x-bzip2",Me="application/gzip",$e="application/vnd.rar",ke="application/x-tar",Ie="application/zip",Se="application/x-7z-compressed";function ze(e){return[Ee,Be,Te,Me,$e,ke,Ie,Se].includes(e)!=!1}function Ye(e){return[we].includes(e)}function de(e){let s=!1;return s=Ye(e),!!(s||(s=ze(e),s))}function b(e){if(bootstrap===void 0)throw new Error("The bootstrap object is undefined.");let s=n(e);return new bootstrap.Modal(s)}function M(e,s){let t=document.getElementById(s);if(t==null)throw new Error(`The ${s} element is null.`);let a=n(e);if(a.addEventListener("shown.bs.modal",function(){t.focus()}),bootstrap===void 0)throw new Error("The bootstrap object is undefined.");return new bootstrap.Modal(a)}async function ce(e){try{let s=await Fe(e),t=await fetch(`/uploader/sha384/${s}`,{method:"PUT",headers:{"Content-Type":"text/plain"},body:s});if(!t.ok)throw new Error(`Hashing is not possible, server response: ${t.status}`);return await t.text()=="true"}catch(s){console.log(`Hashing is not possible: ${s}`)}}async function Fe(e){try{let s=await e.arrayBuffer(),t=await crypto.subtle.digest("SHA-384",s);return Array.from(new Uint8Array(t)).map(a=>a.toString(16).padStart(2,"0")).join("")}catch(s){throw new Error(`Could not use arrayBuffer or crypto.subtle: ${s}`)}}var A="uploader-intro-form",o="is-invalid",h="d-none",j=1024*1024,ue=100*j,Re=100,Ce=n(A),u=n("uploader-intro-alert"),E=n("uploader-intro-file"),De=n("uploader-intro-list-1"),He=n("uploader-intro-list-2"),p=n("uploader-intro-month"),L=n("uploader-intro-releaser-1"),P=n("uploader-intro-results"),f=n("uploader-intro-year"),v=n("uploader-intro-youtube");Ce.addEventListener("reset",pe);E.addEventListener("change",Ue);L.addEventListener("input",Pe);f.addEventListener("input",Ke);p.addEventListener("input",Ne);v.addEventListener("input",qe);function me(e){n(e).addEventListener("click",function(){let t=!0;if(L.value==""&&(L.classList.add(o),t=!1),l(f.value)==!1&&(f.classList.add(o),t=!1),d(p.value)==!1&&(p.classList.add(o),t=!1),p.value!=""&&f.value==""&&(f.classList.add(o),t=!1),E.value==""&&(E.classList.add(o),t=!1),t==!1){u.innerText="Please correct the problems with the form.",u.classList.remove(h);return}pe(),P.classList.remove(h)})}function fe(){htmx.on(`#${A}`,"htmx:xhr:progress",function(e){e.target.id==`${A}`&&htmx.find("#uploader-intro-progress").setAttribute("value",e.detail.loaded/e.detail.total*Re)})}async function Ue(){let e=this.files[0],s="";E.classList.remove(o),u.innerText="",u.classList.add(h);let t=[Ae(e),je(e)];if(t=t.filter(g=>g!=""),t.length>0){u.innerText=t.join(" "),u.classList.remove(h),this.value=s,this.classList.add(o);return}if(await ce(e)==!0){u.innerText=`The chosen file already exists in the database: ${e.name}`,u.classList.remove(h),this.value=s,this.classList.add(o);return}}function Ae(e){return e.size>ue?`The chosen file is too big at ${Math.round(e.size/j)}MB, maximum size is ${ue/j}MB.`:""}function je(e){return de(e.type)?"":`The chosen file mime type ${e.type} is probably not suitable for an intro.`}function pe(){De.innerHTML="",He.innerHTML="",P.innerHTML="",P.classList.add(h),u.innerText="",u.classList.add(h),f.classList.remove(o),p.classList.remove(o),L.classList.remove(o),v.classList.remove(o),E.classList.remove(o)}function Pe(){return L.value==""?(L.classList.add(o),!1):(L.classList.remove(o),!0)}function Ne(){return d(p.value)==!1?(p.classList.add(o),!1):(p.classList.remove(o),!0)}function Ke(){return l(f.value)==!1?(f.classList.add(o),!1):(f.classList.remove(o),!0)}function qe(){return v.value==""?(v.classList.remove(o),!0):new RegExp(/^[a-zA-Z0-9_-]{11}$/).test(v.value)==!1?(v.classList.add(o),!1):(v.classList.remove(o),!0)}var Ge=M("uploader-pouet-modal","pouet-submission"),Oe=M("uploader-demozoo-modal","demozoo-submission"),Xe=M("uploader-intro-modal","uploader-intro-file"),Ze=b("uploaderText"),_e=b("uploaderImg"),Je=b("uploaderMag"),Qe=b("uploaderAdv"),Ve="d",We="p",et="i",tt="n",st="g",at="m",nt="a";function ve(){document.addEventListener("keydown",function(e){if(!(!e.ctrlKey||!e.altKey))switch(e.key){case Ve:Oe.show();break;case We:Ge.show();break;case et:Xe.show();break;case tt:Ze.show();break;case st:_e.show();break;case at:Je.show();break;case nt:Qe.show();break}})}var N=document.getElementById("magFile"),K=document.getElementById("magTitle"),q=document.getElementById("magIssue"),G=document.getElementById("magYear"),O=document.getElementById("magMonth"),X=document.getElementById("magDay"),i="is-invalid";function ot(){N.classList.remove(i),K.classList.remove(i),q.classList.remove(i),G.classList.remove(i),O.classList.remove(i),X.classList.remove(i)}var rt=document.getElementById("magUploader");function he(e){let s=document.getElementById(e);if(s==null)throw new Error(`The ${e} element is null.`);s.addEventListener("click",function(){let t=!0;ot(),N.value==""&&(N.classList.add(i),t=!1),K.value==""&&(K.classList.add(i),t=!1),q.value==""&&(q.classList.add(i),t=!1),l(G.value)==!1&&(G.classList.add(i),t=!1),d(O.value)==!1&&(O.classList.add(i),t=!1),w(X.value)==!1&&(X.classList.add(i),t=!1),t==!0&&rt.submit()})}function Le(e,s){let t=document.getElementById(e);if(t==null)throw new Error(`The ${e} element is null.`);let a=document.getElementById(s);if(a==null)throw new Error(`The ${s} form element is null.`);a.addEventListener("reset",ge),t.addEventListener("click",function(){it()==!0&&a.submit()})}var Z=n("textFile"),_=n("textTitle"),J=n("textReleasers"),Q=n("textYear"),V=n("textMonth"),m="is-invalid";function ge(){Z.classList.remove(m),_.classList.remove(m),J.classList.remove(m),Q.classList.remove(m),V.classList.remove(m)}function it(){let e=!0;return ge(),Z.value==""&&(Z.classList.add(m),e=!1),_.value==""&&(_.classList.add(m),e=!1),J.value==""&&(J.classList.add(m),e=!1),l(Q.value)==!1&&(Q.classList.add(m),e=!1),d(V.value)==!1&&(V.classList.add(m),e=!1),e}var W="is-invalid",y="d-none";function ee(e,s){let t=n(e),a=n(`${e}-error`),g=n(`${e}-results`);n(`${e}-close`).addEventListener("click",te),n(`${e}-clear`).addEventListener("click",te);function te(){t.value="",t.focus(),t.classList.remove(W),a.innerText="",a.classList.add(y),g.innerHTML=""}let xe=45e4,be=2e5;switch(e){case"demozoo-submission":ye(t,xe);break;case"pouet-submission":ye(t,be);break}document.body.addEventListener("htmx:beforeRequest",function(){lt(a,g)}),document.body.addEventListener("htmx:afterRequest",function(x){if(x.detail.elt===null||x.detail.elt.id!==`${e}`)return;if(x.detail.successful)return dt(a);let $=x.detail.xhr;if(x.detail.failed&&$)return $.status===404?ct(a,g,s):mt(a,$);ut(a)})}function ye(e,s){e.addEventListener("input",function(){if(!se(e.value,s)){e.classList.add(W);return}e.classList.remove(W)})}function lt(e,s){s.innerHTML="",e.innerText="",e.classList.add(y)}function dt(e){e.classList.add(y),e.innerText=""}function ct(e,s,t){s.innerText=`Production not found on ${t}.`,e.classList.add(y),e.innerText=""}function ut(e){e.innerText="Something with the browser is not working, please refresh the page.",e.classList.remove(y)}function mt(e,s){e.innerText=`Something went wrong, ${s.status} status: ${s.responseText}.`,e.classList.remove(y)}(()=>{"use strict";ve(),ae("advSubmit"),le("imageSubmit"),me("uploader-intro-submit"),fe(),he("magSubmit"),Le("textSubmit","textUploader"),ee("demozoo-submission","Demozoo"),ee("pouet-submission","Pou\xEBt")})();})();
