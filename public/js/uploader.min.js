/* uploader.min.js Â© Defacto2 2024 */
(()=>{function o(e){let s=document.getElementById(e);if(s==null)throw new Error(`The ${e} element is null.`);return s}function l(e){if(`${e}`=="")return!0;let s=1980,t=new Date().getFullYear();return!(e<s||e>t)}function d(e){return`${e}`==""?!0:!(e<1||e>12)}function b(e){return`${e}`==""?!0:!(e<1||e>31)}function te(e){let s=document.getElementById(e);if(s==null)throw new Error(`The ${e} element is null.`);s.addEventListener("click",function(){let t="Choose...",n=!0;oe(),I.value==""&&(I.classList.add(i),n=!1),(B.value==""||B.value==t)&&(B.classList.add(i),n=!1),(w.value==""||w.value==t)&&(w.classList.add(i),n=!1),$.value==""&&($.classList.add(i),n=!1),S.value==""&&(S.classList.add(i),n=!1),l(z.value)==!1&&(z.classList.add(i),n=!1),d(Y.value)==!1&&(Y.classList.add(i),n=!1),b(F.value)==!1&&(F.classList.add(i),n=!1),n==!0&&se.submit()})}var i="is-invalid",se=document.getElementById("advancedUploader");se.addEventListener("reset",oe);function oe(){I.classList.remove(i),B.classList.remove(i),w.classList.remove(i),$.classList.remove(i),S.classList.remove(i),z.classList.remove(i),Y.classList.remove(i),F.classList.remove(i)}var I=document.getElementById("advFile"),B=document.getElementById("advSelOS"),w=document.getElementById("advSelCat"),$=document.getElementById("advTitle"),S=document.getElementById("releasersAdv"),z=document.getElementById("advYear"),Y=document.getElementById("advMonth"),F=document.getElementById("advDay");var R=document.getElementById("imageFile"),C=document.getElementById("imageTitle"),D=document.getElementById("imageReleasers"),U=document.getElementById("imageYear"),j=document.getElementById("imageMonth"),ne=document.getElementById("imageUploader"),c="is-invalid";function ae(){R.classList.remove(c),C.classList.remove(c),D.classList.remove(c),U.classList.remove(c),j.classList.remove(c)}ne.addEventListener("reset",ae);function ie(e){let s=document.getElementById(e);if(s==null)throw new Error(`The ${e} element is null.`);s.addEventListener("click",function(){let t=!0;ae(),R.value==""&&(R.classList.add(c),t=!1),C.value==""&&(C.classList.add(c),t=!1),D.value==""&&(D.classList.add(c),t=!1),l(U.value)==!1&&(U.classList.add(c),t=!1),d(j.value)==!1&&(j.classList.add(c),t=!1),t==!0&&ne.submit()})}var Le="application/x-freearc",ge="application/octet-stream",he="application/x-bzip",xe="application/x-bzip2",ye="application/gzip",Ee="application/vnd.rar",be="application/x-tar",Be="application/zip",we="application/x-7z-compressed";function Me(e){return[Le,he,xe,ye,Ee,be,Be,we].includes(e)!=!1}function Te(e){return[ge].includes(e)}function re(e){return ok=!1,ok=Te(e),!!(ok||(ok=Me(e),ok))}var H="uploader-intro-form",a="is-invalid",x="d-none",A=1024*1024,ke=100,le=100*A,Ie=o(H),L=o("uploader-intro-alert"),M=o("uploader-intro-file"),$e=o("uploader-intro-list-1"),Se=o("uploader-intro-list-2"),f=o("uploader-intro-month"),v=o("uploader-intro-releaser-1"),P=o("uploader-intro-results"),m=o("uploader-intro-year"),p=o("uploader-intro-youtube");Ie.addEventListener("reset",ue);M.addEventListener("change",ze);v.addEventListener("input",Re);m.addEventListener("input",De);f.addEventListener("input",Ce);p.addEventListener("input",Ue);function de(e){o(e).addEventListener("click",function(){let t=!0;if(v.value==""&&(v.classList.add(a),t=!1),l(m.value)==!1&&(m.classList.add(a),t=!1),d(f.value)==!1&&(f.classList.add(a),t=!1),f.value!=""&&m.value==""&&(m.classList.add(a),t=!1),M.value==""&&(M.classList.add(a),t=!1),t==!1){console.error("Submit failed. Please check the form.");return}ue(),P.classList.remove(x)})}function ce(){htmx.on(`#${H}`,"htmx:xhr:progress",function(e){e.target.id==`${H}`&&htmx.find("#uploader-intro-progress").setAttribute("value",e.detail.loaded/e.detail.total*ke)})}function ze(){let e=this.files[0],s="";L.innerText="",L.classList.add(x);let t=[Ye(e),Fe(e)];if(t=t.filter(n=>n!=""),t.length>0){L.innerText=t.join(" "),L.classList.remove(x),this.value=s;return}}function Ye(e){return e.size>le?(errSize=Math.round(e.size/A),`The chosen file is too big at ${errSize}MB, maximum size is ${le/A}MB.`):""}function Fe(e){return re(e.type)?"":`The chosen file mime type ${e.type} is probably not suitable for an intro.`}function ue(){$e.innerHTML="",Se.innerHTML="",P.innerHTML="",P.classList.add(x),L.innerText="",L.classList.add(x),m.classList.remove(a),f.classList.remove(a),v.classList.remove(a),p.classList.remove(a),M.classList.remove(a)}function Re(){return v.value==""?(v.classList.add(a),!1):(v.classList.remove(a),!0)}function Ce(){return d(f.value)==!1?(f.classList.add(a),!1):(f.classList.remove(a),!0)}function De(){return l(m.value)==!1?(m.classList.add(a),!1):(m.classList.remove(a),!0)}function Ue(){return p.value==""?(p.classList.remove(a),!0):new RegExp(/^[a-zA-Z0-9_-]{11}$/).test(p.value)==!1?(p.classList.add(a),!1):(p.classList.remove(a),!0)}function y(e){if(bootstrap===void 0)throw new Error("The bootstrap object is undefined.");let s=o(e);return new bootstrap.Modal(s)}function T(e,s){let t=document.getElementById(s);if(t==null)throw new Error(`The ${s} element is null.`);let n=o(e);if(n.addEventListener("shown.bs.modal",function(){t.focus()}),bootstrap===void 0)throw new Error("The bootstrap object is undefined.");return new bootstrap.Modal(n)}var je=T("uploader-pouet-modal","pouet-submission"),He=T("uploader-demozoo-modal","demozoo-submission"),Ae=T("uploader-intro-modal","uploader-intro-file"),Pe=y("uploaderText"),Ke=y("uploaderImg"),qe=y("uploaderMag"),Ge=y("uploaderAdv"),Oe="d",Xe="p",Ze="i",_e="n",Je="g",Ne="m",Qe="a";function me(){document.addEventListener("keydown",function(e){if(!(!e.ctrlKey||!e.altKey))switch(e.key){case Oe:He.show();break;case Xe:je.show();break;case Ze:Ae.show();break;case _e:Pe.show();break;case Je:Ke.show();break;case Ne:qe.show();break;case Qe:Ge.show();break}})}var K=document.getElementById("magFile"),q=document.getElementById("magTitle"),G=document.getElementById("magIssue"),O=document.getElementById("magYear"),X=document.getElementById("magMonth"),Z=document.getElementById("magDay"),r="is-invalid";function Ve(){K.classList.remove(r),q.classList.remove(r),G.classList.remove(r),O.classList.remove(r),X.classList.remove(r),Z.classList.remove(r)}var We=document.getElementById("magUploader");function fe(e){let s=document.getElementById(e);if(s==null)throw new Error(`The ${e} element is null.`);s.addEventListener("click",function(){let t=!0;Ve(),K.value==""&&(K.classList.add(r),t=!1),q.value==""&&(q.classList.add(r),t=!1),G.value==""&&(G.classList.add(r),t=!1),l(O.value)==!1&&(O.classList.add(r),t=!1),d(X.value)==!1&&(X.classList.add(r),t=!1),b(Z.value)==!1&&(Z.classList.add(r),t=!1),t==!0&&We.submit()})}function pe(e,s){let t=document.getElementById(e);if(t==null)throw new Error(`The ${e} element is null.`);let n=document.getElementById(s);if(n==null)throw new Error(`The ${s} form element is null.`);n.addEventListener("reset",ve),t.addEventListener("click",function(){et()==!0&&n.submit()})}var _=o("textFile"),J=o("textTitle"),N=o("textReleasers"),Q=o("textYear"),V=o("textMonth"),u="is-invalid";function ve(){_.classList.remove(u),J.classList.remove(u),N.classList.remove(u),Q.classList.remove(u),V.classList.remove(u)}function et(){let e=!0;return ve(),_.value==""&&(_.classList.add(u),e=!1),J.value==""&&(J.classList.add(u),e=!1),N.value==""&&(N.classList.add(u),e=!1),l(Q.value)==!1&&(Q.classList.add(u),e=!1),d(V.value)==!1&&(V.classList.add(u),e=!1),e}var g="d-none";function W(e,s){let t=o(e),n=o(`${e}-error`),E=o(`${e}-results`);o(`${e}-close`).addEventListener("click",ee),o(`${e}-clear`).addEventListener("click",ee);function ee(){t.value="",t.focus(),n.innerText="",n.classList.add(g),E.innerHTML=""}document.body.addEventListener("htmx:beforeRequest",function(){tt(n,E)}),document.body.addEventListener("htmx:afterRequest",function(h){if(h.detail.elt===null||h.detail.elt.id!==`${e}`)return;if(h.detail.successful)return st(n);let k=h.detail.xhr;if(h.detail.failed&&k)return k.status===404?ot(n,E,s):at(n,k);nt(n)})}function tt(e,s){s.innerHTML="",e.innerText="",e.classList.add(g)}function st(e){e.classList.add(g),e.innerText=""}function ot(e,s,t){s.innerText=`Production not found on ${t}.`,e.classList.add(g),e.innerText=""}function nt(e){e.innerText="Something with the browser is not working, please refresh the page.",e.classList.remove(g)}function at(e,s){e.innerText=`Something went wrong, ${s.status} status: ${s.responseText}.`,e.classList.remove(g)}(()=>{"use strict";me(),te("advSubmit"),ie("imageSubmit"),de("uploader-intro-submit"),ce(),fe("magSubmit"),pe("textSubmit","textUploader"),W("demozoo-submission","Demozoo"),W("pouet-submission","Pou\xEBt")})();})();
