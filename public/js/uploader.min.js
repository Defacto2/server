/* uploader.min.js Â© Defacto2 2024 */
(()=>{function o(e){let s=document.getElementById(e);if(s==null)throw new Error(`The ${e} element is null.`);return s}function l(e){if(`${e}`=="")return!0;let s=1980,t=new Date().getFullYear();return!(e<s||e>t)}function d(e){return`${e}`==""?!0:!(e<1||e>12)}function T(e){return`${e}`==""?!0:!(e<1||e>31)}function ne(e,s){if(e=="")return!0;let t=Number(e),a=Number(s);if(!Number.isInteger(a)||a<1)throw new Error(`The ID sanity value is invalid: ${a}`);return Number.isInteger(t)&&t>0&&t<=a}function re(e){let s=document.getElementById(e);if(s==null)throw new Error(`The ${e} element is null.`);s.addEventListener("click",function(){let t="Choose...",a=!0;le(),z.value==""&&(z.classList.add(r),a=!1),(B.value==""||B.value==t)&&(B.classList.add(r),a=!1),(M.value==""||M.value==t)&&(M.classList.add(r),a=!1),Y.value==""&&(Y.classList.add(r),a=!1),F.value==""&&(F.classList.add(r),a=!1),l(H.value)==!1&&(H.classList.add(r),a=!1),d(R.value)==!1&&(R.classList.add(r),a=!1),T(C.value)==!1&&(C.classList.add(r),a=!1),a==!0&&ie.submit()})}var r="is-invalid",ie=document.getElementById("advancedUploader");ie.addEventListener("reset",le);function le(){z.classList.remove(r),B.classList.remove(r),M.classList.remove(r),Y.classList.remove(r),F.classList.remove(r),H.classList.remove(r),R.classList.remove(r),C.classList.remove(r)}var z=document.getElementById("advFile"),B=document.getElementById("advSelOS"),M=document.getElementById("advSelCat"),Y=document.getElementById("advTitle"),F=document.getElementById("releasersAdv"),H=document.getElementById("advYear"),R=document.getElementById("advMonth"),C=document.getElementById("advDay");var D=document.getElementById("imageFile"),U=document.getElementById("imageTitle"),A=document.getElementById("imageReleasers"),j=document.getElementById("imageYear"),P=document.getElementById("imageMonth"),de=document.getElementById("imageUploader"),c="is-invalid";function ce(){D.classList.remove(c),U.classList.remove(c),A.classList.remove(c),j.classList.remove(c),P.classList.remove(c)}de.addEventListener("reset",ce);function ue(e){let s=document.getElementById(e);if(s==null)throw new Error(`The ${e} element is null.`);s.addEventListener("click",function(){let t=!0;ce(),D.value==""&&(D.classList.add(c),t=!1),U.value==""&&(U.classList.add(c),t=!1),A.value==""&&(A.classList.add(c),t=!1),l(j.value)==!1&&(j.classList.add(c),t=!1),d(P.value)==!1&&(P.classList.add(c),t=!1),t==!0&&de.submit()})}var Me="application/x-freearc",$e="application/octet-stream",ke="application/x-bzip",Ie="application/x-bzip2",Se="application/gzip",ze="application/vnd.rar",Ye="application/x-tar",Fe="application/zip",He="application/x-7z-compressed";function Re(e){return[Me,ke,Ie,Se,ze,Ye,Fe,He].includes(e)!=!1}function Ce(e){return[$e].includes(e)}function me(e){let s=!1;return s=Ce(e),!!(s||(s=Re(e),s))}function E(e){if(bootstrap===void 0)throw new Error("The bootstrap object is undefined.");let s=o(e);return new bootstrap.Modal(s,{keyboard:!0})}function $(e,s){let t=document.getElementById(s);if(t==null)throw new Error(`The ${s} element is null.`);let a=o(e);if(a.addEventListener("shown.bs.modal",function(){t.focus()}),bootstrap===void 0)throw new Error("The bootstrap object is undefined.");return new bootstrap.Modal(a,{keyboard:!0})}async function fe(e){try{let s=await De(e),t=await fetch(`/uploader/sha384/${s}`,{method:"PUT",headers:{"Content-Type":"text/plain"},body:s});if(!t.ok)throw new Error(`Hashing is not possible, server response: ${t.status}`);return await t.text()=="true"}catch(s){console.log(`Hashing is not possible: ${s}`)}}async function De(e){try{let s=await e.arrayBuffer(),t=await crypto.subtle.digest("SHA-384",s);return Array.from(new Uint8Array(t)).map(a=>a.toString(16).padStart(2,"0")).join("")}catch(s){throw new Error(`Could not use arrayBuffer or crypto.subtle: ${s}`)}}var N="uploader-intro-form",n="is-invalid",f="d-none",O=1024*1024,pe=100*O,Ue=100,Ae=o(N),u=o("uploader-intro-alert"),w=o("uploader-intro-file"),ve=o("uploader-intro-last-modified"),je=o("uploader-intro-list-1"),Pe=o("uploader-intro-list-2"),he=o("uploader-intro-magic"),v=o("uploader-intro-month"),g=o("uploader-intro-releaser-1"),y=o("uploader-intro-results"),p=o("uploader-intro-year"),L=o("uploader-intro-youtube");Ae.addEventListener("reset",function(){ve.value="",he.value="",ye()});w.addEventListener("change",Ne);g.addEventListener("input",qe);p.addEventListener("input",Xe);v.addEventListener("input",Ge);L.addEventListener("input",Ze);function Le(e){o(e).addEventListener("click",function(){let t=!0;if(g.value==""&&(g.classList.add(n),t=!1),l(p.value)==!1&&(p.classList.add(n),t=!1),d(v.value)==!1&&(v.classList.add(n),t=!1),v.value!=""&&p.value==""&&(p.classList.add(n),t=!1),w.value==""&&(w.classList.add(n),t=!1),t==!1){u.innerText="Please correct the problems with the form.",u.classList.remove(f);return}ye(),y.innerText="...",y.classList.remove(f)})}function ge(){htmx.on(`#${N}`,"htmx:xhr:progress",function(e){e.target.id==`${N}`&&htmx.find("#uploader-intro-progress").setAttribute("value",e.detail.loaded/e.detail.total*Ue)})}async function Ne(){let e=this.files[0],s="";w.classList.remove(n),u.innerText="",u.classList.add(f);let t=[Oe(e),Ke(e)];if(t=t.filter(I=>I!=""),t.length>0){u.innerText=t.join(" "),u.classList.remove(f),this.value=s,this.classList.add(n),y.classList.remove(f);return}if(await fe(e)==!0){u.innerText=`The chosen file already exists in the database: ${e.name}`,u.classList.remove(f),this.value=s,this.classList.add(n),y.classList.remove(f);return}let h=e.lastModified,ae=new Date().getTime(),oe=60*60*1e3;ae-h<oe||(console.log("The file was last modified more than an hour ago."),ve.value=h),e.type!=""&&(console.log(`The file mime type is ${e.type}.`),he.value=e.type)}function Oe(e){return e.size>pe?`The chosen file is too big at ${Math.round(e.size/O)}MB, maximum size is ${pe/O}MB.`:""}function Ke(e){return me(e.type)?"":`The chosen file mime type ${e.type} is probably not suitable for an intro.`}function ye(){je.innerHTML="",Pe.innerHTML="",y.innerHTML="",y.classList.add(f),u.innerText="",u.classList.add(f),p.classList.remove(n),v.classList.remove(n),g.classList.remove(n),L.classList.remove(n),w.classList.remove(n)}function qe(){return g.value==""?(g.classList.add(n),!1):(g.classList.remove(n),!0)}function Ge(){return d(v.value)==!1?(v.classList.add(n),!1):(v.classList.remove(n),!0)}function Xe(){return l(p.value)==!1?(p.classList.add(n),!1):(p.classList.remove(n),!0)}function Ze(){return L.value==""?(L.classList.remove(n),!0):new RegExp(/^[a-zA-Z0-9_-]{11}$/).test(L.value)==!1?(L.classList.add(n),!1):(L.classList.remove(n),!0)}var _e=$("uploader-pouet-modal","pouet-submission"),Je=$("uploader-demozoo-modal","demozoo-submission"),Qe=$("uploader-intro-modal","uploader-intro-file"),Ve=E("uploaderText"),We=E("uploaderImg"),et=E("uploaderMag"),tt=E("uploaderAdv"),st="d",at="p",ot="i",nt="n",rt="g",it="m",lt="a";function xe(){document.addEventListener("keydown",function(e){if(!(!e.ctrlKey||!e.altKey))switch(e.key){case st:Je.show();break;case at:_e.show();break;case ot:Qe.show();break;case nt:Ve.show();break;case rt:We.show();break;case it:et.show();break;case lt:tt.show();break}})}var K=document.getElementById("magFile"),q=document.getElementById("magTitle"),G=document.getElementById("magIssue"),X=document.getElementById("magYear"),Z=document.getElementById("magMonth"),_=document.getElementById("magDay"),i="is-invalid";function dt(){K.classList.remove(i),q.classList.remove(i),G.classList.remove(i),X.classList.remove(i),Z.classList.remove(i),_.classList.remove(i)}var ct=document.getElementById("magUploader");function be(e){let s=document.getElementById(e);if(s==null)throw new Error(`The ${e} element is null.`);s.addEventListener("click",function(){let t=!0;dt(),K.value==""&&(K.classList.add(i),t=!1),q.value==""&&(q.classList.add(i),t=!1),G.value==""&&(G.classList.add(i),t=!1),l(X.value)==!1&&(X.classList.add(i),t=!1),d(Z.value)==!1&&(Z.classList.add(i),t=!1),T(_.value)==!1&&(_.classList.add(i),t=!1),t==!0&&ct.submit()})}function Ee(e,s){let t=document.getElementById(e);if(t==null)throw new Error(`The ${e} element is null.`);let a=document.getElementById(s);if(a==null)throw new Error(`The ${s} form element is null.`);a.addEventListener("reset",we),t.addEventListener("click",function(){ut()==!0&&a.submit()})}var J=o("textFile"),Q=o("textTitle"),V=o("textReleasers"),W=o("textYear"),ee=o("textMonth"),m="is-invalid";function we(){J.classList.remove(m),Q.classList.remove(m),V.classList.remove(m),W.classList.remove(m),ee.classList.remove(m)}function ut(){let e=!0;return we(),J.value==""&&(J.classList.add(m),e=!1),Q.value==""&&(Q.classList.add(m),e=!1),V.value==""&&(V.classList.add(m),e=!1),l(W.value)==!1&&(W.classList.add(m),e=!1),d(ee.value)==!1&&(ee.classList.add(m),e=!1),e}var te="is-invalid",x="d-none";function se(e,s){let t=o(e),a=o(`${e}-error`),h=o(`${e}-results`);o(`${e}-close`).addEventListener("click",k),o(`${e}-clear`).addEventListener("click",k);function k(){t.value="",t.focus(),t.classList.remove(te),a.innerText="",a.classList.add(x),h.innerHTML=""}let I=45e4,Be=2e5;switch(e){case"demozoo-submission":Te(t,I);break;case"pouet-submission":Te(t,Be);break}document.body.addEventListener("htmx:beforeRequest",function(){mt(a,h)}),document.body.addEventListener("htmx:afterRequest",function(b){if(b.detail.elt===null||b.detail.elt.id!==`${e}`)return;if(b.detail.successful)return ft(a);let S=b.detail.xhr;if(b.detail.failed&&S)return S.status===404?pt(a,h,s):ht(a,S);vt(a)})}function Te(e,s){e.addEventListener("input",function(){if(!ne(e.value,s)){e.classList.add(te);return}e.classList.remove(te)})}function mt(e,s){s.innerHTML="",e.innerText="",e.classList.add(x)}function ft(e){e.classList.add(x),e.innerText=""}function pt(e,s,t){s.innerText=`Production not found on ${t}.`,e.classList.add(x),e.innerText=""}function vt(e){e.innerText="Something with the browser is not working, please refresh the page.",e.classList.remove(x)}function ht(e,s){e.innerText=`Something went wrong, ${s.status} status: ${s.responseText}.`,e.classList.remove(x)}(()=>{"use strict";xe(),re("advSubmit"),ue("imageSubmit"),Le("uploader-intro-submit"),ge(),be("magSubmit"),Ee("textSubmit","textUploader"),se("demozoo-submission","Demozoo"),se("pouet-submission","Pou\xEBt")})();})();
