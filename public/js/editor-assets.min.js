/* editor-assets.min.js Â© Defacto2 2024 */
(()=>{function u(t){let r=document.getElementById(t);if(r==null){console.error(`The ${t} for getElmById() element is null.`);return}return r}var g="is-invalid",f="d-none",Y=100,v=1024*1024,L=100*v;async function z(t){if(t==null)throw new Error("The file value of checkSHA is null.");try{let r=await U(t),i=await fetch(`/uploader/sha384/${r}`,{method:"PATCH",headers:{"Content-Type":"text/plain"},body:r});if(!i.ok)throw new Error(`Hashing is not possible, server response: ${i.status}`);return await i.text()=="true"}catch(r){console.log(`Hashing is not possible: ${r}`)}}async function U(t){if(t==null)throw new Error("The file value of sha384 is null.");try{let r=await t.arrayBuffer(),i=await crypto.subtle.digest("SHA-384",r);return Array.from(new Uint8Array(i)).map(a=>a.toString(16).padStart(2,"0")).join("")}catch(r){throw new Error(`Could not use arrayBuffer or crypto.subtle: ${r}`)}}function T(t,r){if(t==null)throw new Error("The formId value of progress is null.");if(r==null)throw new Error("The elementId value of progress is null.");htmx.on(`#${t}`,"htmx:xhr:progress",function(i){i.target.id==`${t}`&&htmx.find(`#${r}`).setAttribute("value",i.detail.loaded/i.detail.total*Y)})}function $(t){if(t==null)throw new Error("The file value of checkSize is null.");return t.size>L?`The chosen file is too big at ${Math.round(t.size/v)}MB, maximum size is ${L/v}MB.`:""}function B(t,r,i,a){if(t==null)throw new Error("The errors value of checkErrors is null.");if(r==null)throw new Error("The alert value of checkErrors is null.");if(i==null)throw new Error("The fileInput value of checkErrors is null.");if(a==null)throw new Error("The results value of checkErrors is null.");t=t.filter(h=>h!=""),!(t.length<=0)&&(r.innerText=t.join(" "),r.classList.remove(f),i.innerText="",i.classList.add(g),a.classList.add(f))}async function M(t,r,i,a){if(t==null)throw new Error("The file value of checkDuplicate is null.");if(r==null)throw new Error("The alert value of checkDuplicate is null.");if(i==null)throw new Error("The fileInput value of checkDuplicate is null.");if(a==null)throw new Error("The results value of checkDuplicate is null.");await z(t)!=!1&&(r.innerText=`The chosen file already exists in the database: ${t.name}`,r.classList.remove(f),i.innerText="",i.classList.add(g),a.classList.add(f))}function I(t,r,i){if(t==null)throw new Error("The fileInput value of resetInput is null.");if(r==null)throw new Error("The alert value of resetInput is null.");if(i==null)throw new Error("The results value of resetInput is null.");t.innerText="",t.classList.remove(g),r.innerText="",r.classList.add(f),i.innerText="",i.classList.add(f)}(()=>{"use strict";T("artifact-editor-dl-form","artifact-editor-dl-progress"),T("artifact-editor-preview-form","artifact-editor-preview-progress");let t=u("artifact-editor-preview-reset"),r=u("artifact-editor-replace-preview"),i=u("artifact-editor-preview-submit"),a=u("artifact-editor-dl-alert"),h=u("artifact-editor-dl-reset"),S=u("artifact-editor-last-modified"),x=u("artifact-editor-dl-results"),d=u("artifact-editor-dl-up");d.addEventListener("change",C);async function C(){I(d,a,x);let e=this.files[0],s=[$(e)];B(s,a,d,x),M(e,a,d,x);let n=e.lastModified,o=new Date().getTime(),l=60*60*1e3;o-n<l||(S.value=n)}let E=document.getElementById("artifact-editor-modal");if(E==null){console.error("the data editor modal is missing");return}let b=document.getElementById("asset-editor-modal");if(b==null){console.error("the asset editor modal is missing");return}let k=document.getElementById("emulate-editor-modal");if(k==null){console.error("the emulate editor modal is missing");return}let D=new bootstrap.Modal(E),H=new bootstrap.Modal(b),A=new bootstrap.Modal(k);switch(new URL(window.location.href).hash){case"#data-editor":D.show(),history.replaceState(null,"",window.location.pathname);break;case"#file-editor":H.show(),history.replaceState(null,"",window.location.pathname);break;case"#emulate-editor":A.show(),history.replaceState(null,"",window.location.pathname);break;default:}document.body.addEventListener("htmx:afterRequest",function(e){y(e,"artifact-editor-dl-form","artifact-editor-dl-up","artifact-editor-dl-feedback"),y(e,"artifact-editor-preview-form","artifact-editor-replace-preview","artifact-editor-preview-feedback"),p(e,"artifact-editor-image-delete","artifact-editor-image-feedback"),p(e,"artifact-editor-imagepreview-delete","artifact-editor-image-feedback"),p(e,"artifact-editor-imagethumb-delete","artifact-editor-image-feedback"),p(e,"artifact-editor-image-pixelate","artifact-editor-preview-feedback"),m(e,"artifact-editor-link-delete","artifact-editor-link-feedback"),m(e,"artifact-editor-comp-previewcopy","artifact-editor-comp-feedback"),m(e,"artifact-editor-comp-previewtext","artifact-editor-comp-feedback"),m(e,"artifact-editor-comp-textcopy","artifact-editor-comp-feedback")});function m(e,s,n){if(e.detail.elt===null||e.detail.elt.id!==`${s}`&&e.detail.elt.name!==s)return;let o=document.getElementById(n);if(o===null)throw new Error(`The htmx successful feedback element ${n} is null`);let l="text-danger",c=e.detail.xhr,w=c.status===200||c.status===302;if(e.detail&&e.detail.successful||w){o.innerText=`${c.responseText}`,o.classList.remove(l);return}if(e.detail&&e.detail.failed!==void 0&&e.detail.failed&&e.detail.xhr){o.classList.add(l),o.innerText=`Something on the server is not working, ${c.status} status: ${c.responseText}.`;return}o.classList.add(l),o.innerText="Something with the browser is not working, please try again or refresh the page."}function p(e,s,n){if(e.detail.elt===null||e.detail.elt.id!==`${s}`)return;let o=document.getElementById(n);if(o===null)throw new Error(`The htmx successful feedback element ${n} is null`);let l="text-danger",c="text-success",w=e.detail.xhr;if(e.detail.successful){o.innerText="The delete request was successful, about to refresh the page.",o.classList.remove(l),o.classList.add(c),setTimeout(()=>{location.reload()},500);return}if(e.detail.failed&&e.detail.xhr){o.classList.add(l),o.innerText=`Something on the server is not working, ${w.status} status: ${w.responseText}.`;return}o.classList.add(l),o.innerText="Something with the browser is not working, please try again or refresh the page."}function y(e,s,n,o){if(e.detail.elt===null||e.detail.elt.id!==`${s}`)return;let l=document.getElementById(n);if(l===null)throw new Error(`The htmx successful input element ${n} is null`);let c=document.getElementById(o);if(c===null)throw new Error(`The htmx successful feedback element ${o} is null`);if(e.detail.successful)return F(e,l,c);if(e.detail.failed&&e.detail.xhr)return j(e,l,c);R(l,c)}function F(e,s,n){let o=e.detail.xhr;n.innerText=`${o.responseText}`,n.classList.remove("invalid-feedback"),n.classList.add("valid-feedback"),s.classList.remove("is-invalid"),s.classList.add("is-valid"),setTimeout(()=>{location.reload()},500)}function j(e,s,n){let o=e.detail.xhr;n.innerText=`Something on the server is not working, ${o.status} status: ${o.responseText}.`,n.classList.remove("valid-feedback"),n.classList.add("invalid-feedback"),s.classList.remove("is-valid"),s.classList.add("is-invalid")}function R(e,s){e.classList.remove("is-valid"),e.classList.add("is-invalid"),s.innerText="Something with the browser is not working, please try again or refresh the page.",s.classList.remove("d-none")}h.addEventListener("click",function(){a.innerText="",a.classList.add("d-none"),d.value="",d.classList.remove("is-invalid","is-valid")}),t.addEventListener("click",function(){r.value="",r.classList.remove("is-invalid","is-valid")}),r.addEventListener("change",function(e){e.target.value.trim()!==""&&(console.log("Submitting the image or photo preview form"),i.click())})})();})();
