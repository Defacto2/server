/* editor-assets.min.js Â© Defacto2 2025 */
(()=>{function d(r){let t=document.getElementById(r);if(t==null){console.error(`The ${r} for getElmById() element is null.`);return}return t}var M="is-invalid",v="d-none",ae=100,D=1024*1024,O=100*D;async function oe(r){if(r==null)throw new Error("The file value of checkSHA is null.");let t=await se(r),o=await fetch(`/uploader/sha384/${t}`,{method:"PATCH",headers:{"Content-Type":"text/plain"},body:t});if(!o.ok)throw new Error(`Hashing is not possible, server response: ${o.status}`);return await o.text()}async function se(r){if(r==null)throw new Error("The file value of sha384 is null.");try{let t=await r.arrayBuffer(),o=await crypto.subtle.digest("SHA-384",t);return Array.from(new Uint8Array(o)).map(l=>l.toString(16).padStart(2,"0")).join("")}catch(t){throw new Error(`Could not use arrayBuffer or crypto.subtle: ${t}`)}}function C(r,t){if(r==null)throw new Error("The formId value of progress is null.");if(t==null)throw new Error("The elementId value of progress is null.");htmx.on(`#${r}`,"htmx:xhr:progress",function(o){o.target.id==`${r}`&&htmx.find(`#${t}`).setAttribute("value",o.detail.loaded/o.detail.total*ae)})}function Y(r){if(r==null)throw new Error("The file value of checkSize is null.");return r.size>O?`The chosen file is too big at ${Math.round(r.size/D)}MB, maximum size is ${O/D}MB.`:""}function G(r,t,o,l){if(r==null)throw new Error("The errors value of checkErrors is null.");if(t==null)throw new Error("The alert value of checkErrors is null.");if(o==null)throw new Error("The fileInput value of checkErrors is null.");if(l==null)throw new Error("The results value of checkErrors is null.");r=r.filter(m=>m.trim()!=""),!(r.length<=0)&&(t.innerText=r.join(" "),t.classList.remove(v),o.innerText="",o.classList.add(M),l.classList.add(v))}async function K(r,t,o,l){if(r==null)throw new Error("The file value of checkDuplicate is null.");if(t==null)throw new Error("The alert value of checkDuplicate is null.");if(o==null)throw new Error("The fileInput value of checkDuplicate is null.");if(l==null)throw new Error("The results value of checkDuplicate is null.");let m=()=>{t.classList.remove(v),o.innerText="",o.classList.add(M),l.classList.add(v)},L="";try{let u=await oe(r);if(u=="")return;L=u}catch(u){console.log(`${u}`),t.innerText=`${u}`,m();return}t.innerText="The chosen file already exists in the database: ";let p=document.createElement("a");p.href=`/f/${L}`,p.innerText=`${r.name}`,t.appendChild(p),m()}function X(r,t,o){if(r==null)throw new Error("The fileInput value of resetInput is null.");if(t==null)throw new Error("The alert value of resetInput is null.");if(o==null)throw new Error("The results value of resetInput is null.");r.innerText="",r.classList.remove(M),t.innerText="",t.classList.add(v),o.innerText="",o.classList.add(v)}(()=>{"use strict";C("artifact-editor-dl-form","artifact-editor-dl-progress"),C("artifact-editor-preview-form","artifact-editor-preview-progress");let r=d("artifact-editor-preview-reset"),t=d("artifact-editor-replace-preview"),o=d("artifact-editor-preview-submit"),l=d("artifact-editor-dl-alert"),m=d("artifact-editor-dl-reset"),L=d("artifact-editor-last-modified"),p=d("artifact-editor-dl-results"),u=d("artifact-editor-dl-up");u.addEventListener("change",W);async function W(){X(u,l,p);let e=this.files[0],n=[Y(e)];G(n,l,u,p),K(e,l,u,p);let s=e.lastModified,a=new Date().getTime(),i=3600*1e3;a-s<i||(L.value=s)}let S=document.getElementById("artifact-editor-modal");if(S==null){console.error("the data editor modal is missing");return}let A=document.getElementById("asset-editor-modal");if(A==null){console.error("the asset editor modal is missing");return}let F=document.getElementById("emulate-editor-modal");if(F==null){console.error("the emulate editor modal is missing");return}let R=document.getElementById("artifact-delete-forever-modal");if(R==null){console.error("the delete editor modal is missing");return}let w=new bootstrap.Modal(S),g=new bootstrap.Modal(A),k=new bootstrap.Modal(F),y=new bootstrap.Modal(R);switch(new URL(window.location.href).hash){case"#data-editor":w.show(),history.replaceState(null,"",window.location.pathname);break;case"#file-editor":g.show(),history.replaceState(null,"",window.location.pathname);break;case"#emulate-editor":k.show(),history.replaceState(null,"",window.location.pathname);break;default:}document.addEventListener("keydown",function(e){if(!e.altKey||!e.shiftKey)return;let n="Enter",s="Home",a="PageDown",i="PageUp",c="Delete",b="Backspace",re="ArrowUp",te="ArrowDown",z=document.getElementById("editor-online-true"),j=document.getElementById("artifact-download-link"),H=document.getElementById("js-dos-run-app"),P=document.getElementById("artifact-view-content"),_=document.getElementById("artifact-enlarge-screenshot"),f=document.getElementById("artifact-editor-year"),B=document.getElementById("artifact-editor-month"),$=document.getElementById("artifact-editor-day"),h=document.getElementById("artifact-editor-title"),x=document.getElementById("artifact-editor-releaser-1"),I=document.getElementById("artifact-editor-releaser-2"),T=document.getElementById("artifact-editor-filename"),V=document.getElementById("artifact-editor-comment"),q=document.getElementById("named-group-page-1"),N=document.getElementById("named-group-page-2");switch(console.log("key",e.key),e.key){case"1":case"!":q&&(e.preventDefault(),q.click());break;case"2":case"@":N&&(e.preventDefault(),N.click());break;case"|":V&&V.focus();break;case"ArrowLeft":if(!f)break;switch(e.preventDefault(),document.activeElement){case f:$.focus();break;case B:f.focus();break;case $:B.focus();break;default:f.focus();break}break;case"ArrowRight":if(!f)break;switch(e.preventDefault(),document.activeElement){case f:B.focus();break;case B:$.focus();break;case $:f.focus();break;default:f.focus();break}break;case"ArrowDown":if(!h)break;switch(e.preventDefault(),document.activeElement){case h:x.focus();break;case x:I.focus();break;case I:T.focus();break;case T:h.focus();break;default:T.focus();break}break;case"ArrowUp":if(!h)break;switch(e.preventDefault(),document.activeElement){case h:T.focus();break;case x:h.focus();break;case I:x.focus();break;case T:I.focus();break;default:h.focus();break}break;case"E":case"e":_&&(e.preventDefault(),_.click());break;case"D":case"d":j&&(e.preventDefault(),j.click());break;case"R":case"r":H&&(e.preventDefault(),H.click());break;case"V":case"v":P&&(e.preventDefault(),P.click());break;case re:case te:z&&(e.preventDefault(),z.click());break;case n:e.preventDefault(),location.reload();break;case s:e.preventDefault(),g.hide(),k.hide(),y.hide(),w.show();break;case"i":case"I":case a:e.preventDefault(),w.hide(),k.hide(),y.hide(),g.show(),(e.key=="I"||e.key=="i")&&t.click();break;case i:e.preventDefault(),w.hide(),g.hide(),y.hide(),k.show();break;case c:e.preventDefault(),w.hide(),g.hide(),k.hide(),y.show();break;case b:e.preventDefault(),w.hide(),g.hide(),k.hide(),y.hide();break}}),document.body.addEventListener("htmx:afterRequest",function(e){U(e,"artifact-editor-dl-form","artifact-editor-dl-up","artifact-editor-dl-feedback"),U(e,"artifact-editor-preview-form","artifact-editor-replace-preview","artifact-editor-image-assets-feedback"),Z(e,"artifact-editor-image-pixelate","artifact-editor-image-assets-feedback"),E(e,"artifact-editor-link-delete","artifact-editor-link-feedback"),E(e,"artifact-editor-comp-previewcopy","artifact-editor-comp-feedback"),E(e,"artifact-editor-comp-previewtext","artifact-editor-comp-feedback"),E(e,"artifact-editor-comp-textcopy","artifact-editor-comp-feedback"),E(e,"artifact-editor-comp-dizcopy","artifact-editor-comp-feedback")});function E(e,n,s){if(e.detail.elt===null||e.detail.elt.id!==`${n}`&&e.detail.elt.name!==n)return;let a=document.getElementById(s);if(a===null)throw new Error(`The htmx successful feedback element ${s} is null`);let i="text-danger",c=e.detail.xhr,b=c.status===200||c.status===302;if(e.detail&&e.detail.successful||b){a.innerText=`${c.responseText}`,a.classList.remove(i);return}if(e.detail&&e.detail.failed!==void 0&&e.detail.failed&&e.detail.xhr){a.classList.add(i),a.innerText=`Something on the server is not working, ${c.status} status: ${c.responseText}.`;return}a.classList.add(i),a.innerText="Something with the browser is not working, please try again or refresh the page."}function Z(e,n,s){if(e.detail.elt===null||e.detail.elt.id!==`${n}`)return;let a=document.getElementById(s);if(a===null)throw new Error(`The htmx successful feedback element ${s} is null`);let i="text-danger",c="text-success",b=e.detail.xhr;if(e.detail.successful){a.innerText="About to refresh the page.",a.classList.remove(i),a.classList.add(c),setTimeout(()=>{location.reload()},500);return}if(e.detail.failed&&e.detail.xhr){a.classList.add(i),a.innerText=`Something on the server is not working, ${b.status} status: ${b.responseText}.`;return}a.classList.add(i),a.innerText="Something with the browser is not working, please try again or refresh the page."}function U(e,n,s,a){if(e.detail.elt===null||e.detail.elt.id!==`${n}`)return;let i=document.getElementById(s);if(i===null)throw new Error(`The htmx successful input element ${s} is null`);let c=document.getElementById(a);if(c===null)throw new Error(`The htmx successful feedback element ${a} is null`);if(e.detail.successful)return J(e,i,c);if(e.detail.failed&&e.detail.xhr)return Q(e,i,c);ee(i,c)}function J(e,n,s){let a=e.detail.xhr;s.innerText=`${a.responseText}`,s.classList.remove("invalid-feedback"),s.classList.add("valid-feedback"),n.classList.remove("is-invalid"),n.classList.add("is-valid"),setTimeout(()=>{location.reload()},500)}function Q(e,n,s){let a=e.detail.xhr;s.innerText=`Something on the server is not working, ${a.status} status: ${a.responseText}.`,s.classList.remove("valid-feedback"),s.classList.add("invalid-feedback"),n.classList.remove("is-valid"),n.classList.add("is-invalid")}function ee(e,n){e.classList.remove("is-valid"),e.classList.add("is-invalid"),n.innerText="Something with the browser is not working, please try again or refresh the page.",n.classList.remove("d-none")}m.addEventListener("click",function(){l.innerText="",l.classList.add("d-none"),u.value="",u.classList.remove("is-invalid","is-valid")}),r.addEventListener("click",function(){t.value="",t.classList.remove("is-invalid","is-valid")}),t.addEventListener("change",function(e){e.target.value.trim()!==""&&(console.log("Submitting the image or photo preview form"),o.click())})})();})();
