/* editor-assets.min.js Â© Defacto2 2025 */
(()=>{function d(r){let t=document.getElementById(r);if(t==null){console.error(`The ${r} for getElmById() element is null.`);return}return t}var y="is-invalid",v="d-none",N=100,T=1024*1024,R=100*T;async function X(r){if(r==null)throw new Error("The file value of checkSHA is null.");let t=await W(r),a=await fetch(`/uploader/sha384/${t}`,{method:"PATCH",headers:{"Content-Type":"text/plain"},body:t});if(!a.ok)throw new Error(`Hashing is not possible, server response: ${a.status}`);return await a.text()}async function W(r){if(r==null)throw new Error("The file value of sha384 is null.");try{let t=await r.arrayBuffer(),a=await crypto.subtle.digest("SHA-384",t);return Array.from(new Uint8Array(a)).map(c=>c.toString(16).padStart(2,"0")).join("")}catch(t){throw new Error(`Could not use arrayBuffer or crypto.subtle: ${t}`)}}function L(r,t){if(r==null)throw new Error("The formId value of progress is null.");if(t==null)throw new Error("The elementId value of progress is null.");htmx.on(`#${r}`,"htmx:xhr:progress",function(a){a.target.id==`${r}`&&htmx.find(`#${t}`).setAttribute("value",a.detail.loaded/a.detail.total*N)})}function U(r){if(r==null)throw new Error("The file value of checkSize is null.");return r.size>R?`The chosen file is too big at ${Math.round(r.size/T)}MB, maximum size is ${R/T}MB.`:""}function j(r,t,a,c){if(r==null)throw new Error("The errors value of checkErrors is null.");if(t==null)throw new Error("The alert value of checkErrors is null.");if(a==null)throw new Error("The fileInput value of checkErrors is null.");if(c==null)throw new Error("The results value of checkErrors is null.");r=r.filter(h=>h.trim()!=""),!(r.length<=0)&&(t.innerText=r.join(" "),t.classList.remove(v),a.innerText="",a.classList.add(y),c.classList.add(v))}async function z(r,t,a,c){if(r==null)throw new Error("The file value of checkDuplicate is null.");if(t==null)throw new Error("The alert value of checkDuplicate is null.");if(a==null)throw new Error("The fileInput value of checkDuplicate is null.");if(c==null)throw new Error("The results value of checkDuplicate is null.");let h=()=>{t.classList.remove(v),a.innerText="",a.classList.add(y),c.classList.add(v)},E="";try{let u=await X(r);if(u=="")return;E=u}catch(u){console.log(`${u}`),t.innerText=`${u}`,h();return}t.innerText="The chosen file already exists in the database: ";let f=document.createElement("a");f.href=`/f/${E}`,f.innerText=`${r.name}`,t.appendChild(f),h()}function H(r,t,a){if(r==null)throw new Error("The fileInput value of resetInput is null.");if(t==null)throw new Error("The alert value of resetInput is null.");if(a==null)throw new Error("The results value of resetInput is null.");r.innerText="",r.classList.remove(y),t.innerText="",t.classList.add(v),a.innerText="",a.classList.add(v)}(()=>{"use strict";L("artifact-editor-dl-form","artifact-editor-dl-progress"),L("artifact-editor-preview-form","artifact-editor-preview-progress");let r=d("artifact-editor-preview-reset"),t=d("artifact-editor-replace-preview"),a=d("artifact-editor-preview-submit"),c=d("artifact-editor-dl-alert"),h=d("artifact-editor-dl-reset"),E=d("artifact-editor-last-modified"),f=d("artifact-editor-dl-results"),u=d("artifact-editor-dl-up");u.addEventListener("change",P);async function P(){H(u,c,f);let e=this.files[0],s=[U(e)];j(s,c,u,f),z(e,c,u,f);let n=e.lastModified,o=new Date().getTime(),i=60*60*1e3;o-n<i||(E.value=n)}let x=document.getElementById("artifact-editor-modal");if(x==null){console.error("the data editor modal is missing");return}let $=document.getElementById("asset-editor-modal");if($==null){console.error("the asset editor modal is missing");return}let B=document.getElementById("emulate-editor-modal");if(B==null){console.error("the emulate editor modal is missing");return}let M=document.getElementById("artifact-delete-forever-modal");if(M==null){console.error("the delete editor modal is missing");return}let p=new bootstrap.Modal(x),m=new bootstrap.Modal($),w=new bootstrap.Modal(B),b=new bootstrap.Modal(M);switch(new URL(window.location.href).hash){case"#data-editor":p.show(),history.replaceState(null,"",window.location.pathname);break;case"#file-editor":m.show(),history.replaceState(null,"",window.location.pathname);break;case"#emulate-editor":w.show(),history.replaceState(null,"",window.location.pathname);break;default:}document.addEventListener("keydown",function(e){if(!e.altKey||!e.shiftKey)return;let s="Enter",n="Home",o="PageDown",i="PageUp",l="Delete",g="Backspace",G="ArrowUp",K="ArrowDown",I=document.getElementById("editor-online-true"),C=document.getElementById("artifact-download-link"),S=document.getElementById("js-dos-run-app"),A=document.getElementById("artifact-view-content"),F=document.getElementById("artifact-enlarge-screenshot");switch(e.key){case"E":case"e":F&&(e.preventDefault(),F.click());break;case"D":case"d":C&&(e.preventDefault(),C.click());break;case"R":case"r":S&&(e.preventDefault(),S.click());break;case"V":case"v":A&&(e.preventDefault(),A.click());break;case G:case K:I&&(e.preventDefault(),I.click());break;case s:e.preventDefault(),location.reload();break;case n:e.preventDefault(),m.hide(),w.hide(),b.hide(),p.show();break;case o:e.preventDefault(),p.hide(),w.hide(),b.hide(),m.show();break;case i:e.preventDefault(),p.hide(),m.hide(),b.hide(),w.show();break;case l:e.preventDefault(),p.hide(),m.hide(),w.hide(),b.show();break;case g:e.preventDefault(),p.hide(),m.hide(),w.hide(),b.hide();break}}),document.body.addEventListener("htmx:afterRequest",function(e){D(e,"artifact-editor-dl-form","artifact-editor-dl-up","artifact-editor-dl-feedback"),D(e,"artifact-editor-preview-form","artifact-editor-replace-preview","artifact-editor-image-assets-feedback"),q(e,"artifact-editor-image-pixelate","artifact-editor-image-assets-feedback"),k(e,"artifact-editor-link-delete","artifact-editor-link-feedback"),k(e,"artifact-editor-comp-previewcopy","artifact-editor-comp-feedback"),k(e,"artifact-editor-comp-previewtext","artifact-editor-comp-feedback"),k(e,"artifact-editor-comp-textcopy","artifact-editor-comp-feedback"),k(e,"artifact-editor-comp-dizcopy","artifact-editor-comp-feedback")});function k(e,s,n){if(e.detail.elt===null||e.detail.elt.id!==`${s}`&&e.detail.elt.name!==s)return;let o=document.getElementById(n);if(o===null)throw new Error(`The htmx successful feedback element ${n} is null`);let i="text-danger",l=e.detail.xhr,g=l.status===200||l.status===302;if(e.detail&&e.detail.successful||g){o.innerText=`${l.responseText}`,o.classList.remove(i);return}if(e.detail&&e.detail.failed!==void 0&&e.detail.failed&&e.detail.xhr){o.classList.add(i),o.innerText=`Something on the server is not working, ${l.status} status: ${l.responseText}.`;return}o.classList.add(i),o.innerText="Something with the browser is not working, please try again or refresh the page."}function q(e,s,n){if(e.detail.elt===null||e.detail.elt.id!==`${s}`)return;let o=document.getElementById(n);if(o===null)throw new Error(`The htmx successful feedback element ${n} is null`);let i="text-danger",l="text-success",g=e.detail.xhr;if(e.detail.successful){o.innerText="About to refresh the page.",o.classList.remove(i),o.classList.add(l),setTimeout(()=>{location.reload()},500);return}if(e.detail.failed&&e.detail.xhr){o.classList.add(i),o.innerText=`Something on the server is not working, ${g.status} status: ${g.responseText}.`;return}o.classList.add(i),o.innerText="Something with the browser is not working, please try again or refresh the page."}function D(e,s,n,o){if(e.detail.elt===null||e.detail.elt.id!==`${s}`)return;let i=document.getElementById(n);if(i===null)throw new Error(`The htmx successful input element ${n} is null`);let l=document.getElementById(o);if(l===null)throw new Error(`The htmx successful feedback element ${o} is null`);if(e.detail.successful)return V(e,i,l);if(e.detail.failed&&e.detail.xhr)return Y(e,i,l);O(i,l)}function V(e,s,n){let o=e.detail.xhr;n.innerText=`${o.responseText}`,n.classList.remove("invalid-feedback"),n.classList.add("valid-feedback"),s.classList.remove("is-invalid"),s.classList.add("is-valid"),setTimeout(()=>{location.reload()},500)}function Y(e,s,n){let o=e.detail.xhr;n.innerText=`Something on the server is not working, ${o.status} status: ${o.responseText}.`,n.classList.remove("valid-feedback"),n.classList.add("invalid-feedback"),s.classList.remove("is-valid"),s.classList.add("is-invalid")}function O(e,s){e.classList.remove("is-valid"),e.classList.add("is-invalid"),s.innerText="Something with the browser is not working, please try again or refresh the page.",s.classList.remove("d-none")}h.addEventListener("click",function(){c.innerText="",c.classList.add("d-none"),u.value="",u.classList.remove("is-invalid","is-valid")}),r.addEventListener("click",function(){t.value="",t.classList.remove("is-invalid","is-valid")}),t.addEventListener("change",function(e){e.target.value.trim()!==""&&(console.log("Submitting the image or photo preview form"),a.click())})})();})();
