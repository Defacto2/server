/* editor-assets.min.js Â© Defacto2 2024 */
(()=>{function u(r){let t=document.getElementById(r);if(t==null){console.error(`The ${r} for getElmById() element is null.`);return}return t}var b="is-invalid",f="d-none",q=100,v=1024*1024,x=100*v;async function P(r){if(r==null)throw new Error("The file value of checkSHA is null.");try{let t=await R(r),o=await fetch(`/uploader/sha384/${t}`,{method:"PATCH",headers:{"Content-Type":"text/plain"},body:t});if(!o.ok)throw new Error(`Hashing is not possible, server response: ${o.status}`);return await o.text()=="true"}catch(t){console.log(`Hashing is not possible: ${t}`)}}async function R(r){if(r==null)throw new Error("The file value of sha384 is null.");try{let t=await r.arrayBuffer(),o=await crypto.subtle.digest("SHA-384",t);return Array.from(new Uint8Array(o)).map(n=>n.toString(16).padStart(2,"0")).join("")}catch(t){throw new Error(`Could not use arrayBuffer or crypto.subtle: ${t}`)}}function T(r,t){if(r==null)throw new Error("The formId value of progress is null.");if(t==null)throw new Error("The elementId value of progress is null.");htmx.on(`#${r}`,"htmx:xhr:progress",function(o){o.target.id==`${r}`&&htmx.find(`#${t}`).setAttribute("value",o.detail.loaded/o.detail.total*q)})}function $(r){if(r==null)throw new Error("The file value of checkSize is null.");return r.size>x?`The chosen file is too big at ${Math.round(r.size/v)}MB, maximum size is ${x/v}MB.`:""}function M(r,t,o,n){if(r==null)throw new Error("The errors value of checkErrors is null.");if(t==null)throw new Error("The alert value of checkErrors is null.");if(o==null)throw new Error("The fileInput value of checkErrors is null.");if(n==null)throw new Error("The results value of checkErrors is null.");r=r.filter(p=>p!=""),!(r.length<=0)&&(t.innerText=r.join(" "),t.classList.remove(f),o.innerText="",o.classList.add(b),n.classList.add(f))}async function B(r,t,o,n){if(r==null)throw new Error("The file value of checkDuplicate is null.");if(t==null)throw new Error("The alert value of checkDuplicate is null.");if(o==null)throw new Error("The fileInput value of checkDuplicate is null.");if(n==null)throw new Error("The results value of checkDuplicate is null.");await P(r)!=!1&&(t.innerText=`The chosen file already exists in the database: ${r.name}`,t.classList.remove(f),o.innerText="",o.classList.add(b),n.classList.add(f))}function I(r,t,o){if(r==null)throw new Error("The fileInput value of resetInput is null.");if(t==null)throw new Error("The alert value of resetInput is null.");if(o==null)throw new Error("The results value of resetInput is null.");r.innerText="",r.classList.remove(b),t.innerText="",t.classList.add(f),o.innerText="",o.classList.add(f)}(()=>{"use strict";T("artifact-editor-dl-form","artifact-editor-dl-progress"),T("artifact-editor-preview-form","artifact-editor-preview-progress");let r=u("artifact-editor-preview-reset"),t=u("artifact-editor-replace-preview"),o=u("artifact-editor-preview-submit"),n=u("artifact-editor-dl-alert"),p=u("artifact-editor-dl-reset"),C=u("artifact-editor-last-modified"),g=u("artifact-editor-dl-results"),d=u("artifact-editor-dl-up");d.addEventListener("change",S);async function S(){I(d,n,g);let e=this.files[0],i=[$(e)];M(i,n,d,g),B(e,n,d,g);let s=e.lastModified,a=new Date().getTime(),l=60*60*1e3;a-s<l||(C.value=s)}let k=document.getElementById("artifact-editor-modal");if(k==null){console.error("the data editor modal is missing");return}let y=document.getElementById("asset-editor-modal");if(y==null){console.error("the asset editor modal is missing");return}let E=document.getElementById("emulate-editor-modal");if(E==null){console.error("the emulate editor modal is missing");return}let D=new bootstrap.Modal(k),A=new bootstrap.Modal(y),F=new bootstrap.Modal(E);switch(new URL(window.location.href).hash){case"#data-editor":D.show(),history.replaceState(null,"",window.location.pathname);break;case"#file-editor":A.show(),history.replaceState(null,"",window.location.pathname);break;case"#emulate-editor":F.show(),history.replaceState(null,"",window.location.pathname);break;default:}document.body.addEventListener("htmx:afterRequest",function(e){L(e,"artifact-editor-dl-form","artifact-editor-dl-up","artifact-editor-dl-feedback"),L(e,"artifact-editor-preview-form","artifact-editor-replace-preview","artifact-editor-preview-feedback"),m(e,"artifact-editor-image-delete","artifact-editor-image-feedback"),m(e,"artifact-editor-imagepreview-delete","artifact-editor-image-feedback"),m(e,"artifact-editor-imagethumb-delete","artifact-editor-image-feedback"),m(e,"artifact-editor-image-pixelate","artifact-editor-preview-feedback"),h(e,"artifact-editor-link-delete","artifact-editor-link-feedback"),h(e,"artifact-editor-comp-previewcopy","artifact-editor-comp-feedback"),h(e,"artifact-editor-comp-previewtext","artifact-editor-comp-feedback"),h(e,"artifact-editor-comp-textcopy","artifact-editor-comp-feedback"),h(e,"artifact-editor-comp-dizcopy","artifact-editor-comp-feedback")});function h(e,i,s){if(e.detail.elt===null||e.detail.elt.id!==`${i}`&&e.detail.elt.name!==i)return;let a=document.getElementById(s);if(a===null)throw new Error(`The htmx successful feedback element ${s} is null`);let l="text-danger",c=e.detail.xhr,w=c.status===200||c.status===302;if(e.detail&&e.detail.successful||w){a.innerText=`${c.responseText}`,a.classList.remove(l);return}if(e.detail&&e.detail.failed!==void 0&&e.detail.failed&&e.detail.xhr){a.classList.add(l),a.innerText=`Something on the server is not working, ${c.status} status: ${c.responseText}.`;return}a.classList.add(l),a.innerText="Something with the browser is not working, please try again or refresh the page."}function m(e,i,s){if(e.detail.elt===null||e.detail.elt.id!==`${i}`)return;let a=document.getElementById(s);if(a===null)throw new Error(`The htmx successful feedback element ${s} is null`);let l="text-danger",c="text-success",w=e.detail.xhr;if(e.detail.successful){a.innerText="The delete request was successful, about to refresh the page.",a.classList.remove(l),a.classList.add(c),setTimeout(()=>{location.reload()},500);return}if(e.detail.failed&&e.detail.xhr){a.classList.add(l),a.innerText=`Something on the server is not working, ${w.status} status: ${w.responseText}.`;return}a.classList.add(l),a.innerText="Something with the browser is not working, please try again or refresh the page."}function L(e,i,s,a){if(e.detail.elt===null||e.detail.elt.id!==`${i}`)return;let l=document.getElementById(s);if(l===null)throw new Error(`The htmx successful input element ${s} is null`);let c=document.getElementById(a);if(c===null)throw new Error(`The htmx successful feedback element ${a} is null`);if(e.detail.successful)return z(e,l,c);if(e.detail.failed&&e.detail.xhr)return H(e,l,c);j(l,c)}function z(e,i,s){let a=e.detail.xhr;s.innerText=`${a.responseText}`,s.classList.remove("invalid-feedback"),s.classList.add("valid-feedback"),i.classList.remove("is-invalid"),i.classList.add("is-valid"),setTimeout(()=>{location.reload()},500)}function H(e,i,s){let a=e.detail.xhr;s.innerText=`Something on the server is not working, ${a.status} status: ${a.responseText}.`,s.classList.remove("valid-feedback"),s.classList.add("invalid-feedback"),i.classList.remove("is-valid"),i.classList.add("is-invalid")}function j(e,i){e.classList.remove("is-valid"),e.classList.add("is-invalid"),i.innerText="Something with the browser is not working, please try again or refresh the page.",i.classList.remove("d-none")}p.addEventListener("click",function(){n.innerText="",n.classList.add("d-none"),d.value="",d.classList.remove("is-invalid","is-valid")}),r.addEventListener("click",function(){t.value="",t.classList.remove("is-invalid","is-valid")}),t.addEventListener("change",function(e){e.target.value.trim()!==""&&(console.log("Submitting the image or photo preview form"),o.click())})})();})();
