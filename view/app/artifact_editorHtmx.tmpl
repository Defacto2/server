{{- /*  artifact_editorHtmx.tmpl  */}}
{{- define "artifactEditorHtmx" -}}
{{- if eq false (index . "editor")}}{{/*  render nothing  */}}{{else}}
{{- $faSize := "fa-fw fa-2x" -}}
{{- $id := index . "modID"}}
{{- $previewImg := recordImgSample (index . "uuid")}}
{{- $thumbImg := recordThumbSample (index . "uuid")}}
{{- $record := index . "modOnline"}}
{{- $replace := "refresh the page to see the changes"}}
{{- $delay := "500ms" }}
{{- $hxClassification := "[name='artifact-editor-categories'],[name='artifact-editor-operatingsystem'],[name='artifact-editor-key']"}}
{{- $rel1 := (index . "modReleaser1")}}
{{- $rel2 := (index . "modReleaser2")}}
{{- $title := (index . "modTitle")}}
{{- /*  Artifact metadata editor  */}}
<div class="modal fade" id="artifact-editor-modal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" 
  aria-labelledby="artifact-editor-modal-label" aria-hidden="true">
  <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
    {{- /*  Modify the metadata for ID...  */}}
    <div class="modal-content">
      <div id="artifact-editor-modal-header" class="modal-header {{if eq $record true}}bg-success-subtle{{else}}bg-danger-subtle{{end}}">
        <i class="fal fa-file-alt {{ $faSize }}" title="Modify the record"></i> &nbsp;
        <h1 class="modal-title fs-5" id="artifact-editor-modal-label">Data editor for record key, {{index . "modID"}}</h1><br>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body container">
        <div id="artifact-editor-alert" class="alert alert-warning d-none" role="alert">
          {{/*  Error alerts will be written here  */}}
        </div>
        <div class="row">
          {{- /*  Public or hidden record */}}
          <div class="col-xl-2">
            <div class="d-grid">
              {{radioPublic ($record)}}
              <label class="btn btn-outline-success" for="artifact-editor-public">Public record</label>
            </div>
          </div>
          <div class="col-xl-2">
            <div class="d-grid">
              {{radioHidden ($record)}}
              <label class="btn btn-outline-danger" for="artifact-editor-hidden">Hidden record</label>
            </div>
          </div>
          {{- /*  Record key and Unique ID  */}}
          <div class="col-xl-3">
            <div class="input-group">
              <span class="input-group-text" id="artifact-editor-key-label">Record Key</span>
              <input type="text" value='{{index . "modID"}}' class="form-control" name="artifact-editor-key" 
                aria-describedby="artifact-editor-key-label" readonly>
            </div>
          </div>
          <div class="col-xl-5">
            <div class="input-group">
              <span class="input-group-text" id="artifact-editor-unique-id">Unique ID</span>
              <input type="text" value='{{index . "uuid"}}' class="form-control" aria-describedby="artifact-editor-unique-id" readonly>
            </div>
          </div>
        </div>
        <hr>
        <div class="row align-items-center">
          <div class="col-xl-6">
            {{- /*  Classifications  */}}
            <label class="form-label mt-2"><span class="col-form-label-lg">Classifications</span>, 
              <small id="artifact-editor-classification-help">{{classification (index . "modTag") (index . "modOS")}}</small>.
            </label>
            <div class="input-group mb-1">
              <label class="input-group-text w-50" for="artifact-editor-operating-system" id="artifact-editor-os-label">Operating system</label>
              <select name="artifact-editor-operatingsystem" id="artifact-editor-operating-system" class="form-select"
                aria-describedby="artifact-editor-os-label"
                hx-post="/editor/classifications" 
                hx-target="#artifact-editor-classification-help"
                hx-include="{{$hxClassification}}">
              {{- template "optionOS" . }}
              </select>
            </div>
            <div class="input-group">
              <label class="input-group-text w-50" for="artifact-editor-category" id="artifact-editor-category-label">Tag as category</label>
              <select name="artifact-editor-categories" id="artifact-editor-category" class="form-select"
                aria-describedby="artifact-editor-category-label"
                hx-post="/editor/classifications" 
                hx-target="#artifact-editor-classification-help"
                hx-include="{{$hxClassification}}">
              {{- template "optionTag" . }}
              </select>
            </div>
            <div class="btn-group" role="group" aria-label="Reset classifications">
              <button class="btn btn-link" name="reset-classifications" id="artifact-editor-reset-classifications" type="button" 
                data-reset-os="{{index . "modOS"}}" data-reset-cat="{{index . "modTag"}}"
                hx-post="/editor/classifications" 
                hx-target="#artifact-editor-classification-help"
                hx-include="{{$hxClassification}}">
                  Reset classifications <small>to <q>{{index . "modOS"}}</q> + <q>{{index . "modTag"}}</q></small></button>
            </div>
          </div>
          <div class="col-xl-6">
            <div><label class="col-form-label-lg">Popular</label></div>
            {{- /*  Popular classifications  */}}
            <div class="btn-group" role="group">
              <button class="btn btn-link" name="reset-classifications" id="artifact-editor-text-for-dos" type="button" 
                data-reset-os="text" data-reset-cat="releaseinformation"
                hx-post="/editor/classifications" 
                hx-target="#artifact-editor-classification-help"
                hx-include="{{$hxClassification}}">Text or NFO</button>
              <button class="btn btn-link" name="reset-classifications" id="artifact-editor-text-for-amiga" type="button"
                data-reset-os="textamiga" data-reset-cat="releaseinformation"
                hx-post="/editor/classifications" 
                hx-target="#artifact-editor-classification-help"
                hx-include="{{$hxClassification}}">Text for Amiga</button>
              <button class="btn btn-link" name="reset-classifications" id="artifact-editor-magazine-for-text" type="button"
                data-reset-os="text" data-reset-cat="magazine"
                hx-post="/editor/classifications" 
                hx-target="#artifact-editor-classification-help"
                hx-include="{{$hxClassification}}">Text magazine</button>
              <button class="btn btn-link" name="reset-classifications" id="artifact-editor-ansi-for-bbs" type="button"
                data-reset-os="ansi" data-reset-cat="bbs"
                hx-post="/editor/classifications" 
                hx-target="#artifact-editor-classification-help"
                hx-include="{{$hxClassification}}">ANSI for BBS</button>
            </div>
            <div class="btn-group" role="group">
              <button class="btn btn-link" name="reset-classifications" id="artifact-editor-intro-for-dos" type="button"
                data-reset-os="dos" data-reset-cat="releaseadvert"
                hx-post="/editor/classifications" 
                hx-target="#artifact-editor-classification-help"
                hx-include="{{$hxClassification}}">MsDos-tro</button>
              <button class="btn btn-link" name="reset-classifications" id="artifact-editor-trainer-for-dos" type="button"
                data-reset-os="dos" data-reset-cat="gamehack"
                hx-post="/editor/classifications" 
                hx-target="#artifact-editor-classification-help"
                hx-include="{{$hxClassification}}">MsDos trainer</button>
              <button class="btn btn-link" name="reset-classifications" id="artifact-editor-magazine-for-dos" type="button"
                data-reset-os="dos" data-reset-cat="magazine"
                hx-post="/editor/classifications" 
                hx-target="#artifact-editor-classification-help"
                hx-include="{{$hxClassification}}">MsDos magazine</button>
              <button class="btn btn-link" name="reset-classifications" id="artifact-editor-intro-for-bbs" type="button"
                data-reset-os="dos" data-reset-cat="bbs"
                hx-post="/editor/classifications" 
                hx-target="#artifact-editor-classification-help"
                hx-include="{{$hxClassification}}">BBS-tro</button>
            </div>
            <div class="btn-group" role="group">
              <button class="btn btn-link" name="reset-classifications" id="artifact-editor-intro-for-win" type="button"
                data-reset-os="windows" data-reset-cat="releaseadvert"
                hx-post="/editor/classifications" 
                hx-target="#artifact-editor-classification-help"
                hx-include="{{$hxClassification}}">Windows-tro</button>
              <button class="btn btn-link" name="reset-classifications" id="artifact-editor-trainer-for-win" type="button"
                data-reset-os="windows" data-reset-cat="gamehack"
                hx-post="/editor/classifications" 
                hx-target="#artifact-editor-classification-help"
                hx-include="{{$hxClassification}}">Windows trainer</button>
              <button class="btn btn-link" name="reset-classifications" id="artifact-editor-proof-of-release" type="button"
                data-reset-os="image" data-reset-cat="releaseproof"
                hx-post="/editor/classifications" 
                hx-target="#artifact-editor-classification-help"
                hx-include="{{$hxClassification}}">Proof of release</button>
            </div>
          </div>
        </div>
        <hr>
        <div class="row pb-3">
          {{/*  Filename  */}}
          <div class="col-xl-6">
            <label for="artifact-editor-filename" class="col-form-label-lg">Filename</label>
            <input type="text" class="form-control" id="artifact-editor-filename" autocomplete="off" maxlength="255"
              value="{{index . "filename"}}" aria-describedby="artifact-editor-filename-help">
            <div id="artifact-editor-filename-help" class="form-text">
              The filename should usually be left unchanged.<br>
              A file extension is always suggested, for example: <q>example.zip</q>.
            </div>
          </div>
          {{/*  VirusTotal  */}}
          <div class="col-xl-6">
            <label for="artifact-editor-virustotal" class="col-form-label-lg">VirusTotal alert</label>
            <input type="text" class="form-control" id="artifact-editor-virustotal" autocomplete="off" maxlength="256"
              aria-describedby="artifact-editor-virustotal-help" value="{{index . "virusTotal"}}">
            <div id="artifact-editor-virustotal-help" class="form-text">
              <span class="text-info-emphasis">Provide an link to a VirusTotal report to block the artifact download.</span><br>
              The VirusTotal alert should usually be left empty.
            </div>
          </div>
        </div>
        <hr>
        <div class="row">
          {{- /*  Title or brief description  */}}
          <div class="col-xl-10 offset-xl-1 mb-3">
            <label for="artifact-editor-title" class="col-form-label-lg">Title</label>
            <input type="text" name="artifact-editor-title" id="artifact-editor-title" autocomplete="off" maxlength="100"
              aria-describedby="artifact-editor-title-help" placeholder="example: 500000th release!" class="form-control form-control-lg" 
              value="{{$title}}"
              hx-post="/editor/title" 
              hx-trigger="keyup changed delay:1s"
              hx-include="[name='artifact-editor-key']">
            <div id="artifact-editor-title-help" class="form-text">An optional brief description or name of the release.</div>
            <div class="btn-group" role="group">
              <input type="hidden" name="artifact-editor-title-resetter" value="{{$title}}" readonly>
              <button class="btn btn-link" type="button" id="artifact-editor-title-reset"
                hx-post="/editor/title/reset"
                hx-target="#artifact-editor-title-quote"
                hx-include="[name='artifact-editor-key'],[name='artifact-editor-title-resetter']">
                  Reset title <small>to <q id="artifact-editor-title-quote">{{$title}}</q></small></button>
            </div>
          </div>
          {{- /*  Releasers  */}}
          <div class="col-xl-10 offset-xl-1 mb-3">
            <label for="artifact-editor-releaser-1" class="form-label"><span class="col-form-label-lg">Releasers</span> <small>maximum of 2</small></label>
            <form id="artifact-editor-releasers-form">
            <div class="input-group col-xl-3">
              <button class="btn btn-success" type="button" id="artifact-editor-releaser-update"
                hx-post="/editor/releasers"
                hx-include="[name='artifact-editor-key']"
                hx-vals='{"releaser1": "{{$rel1}}","releaser2": "{{$rel2}}"}'>Update releasers</button>
              <input type="text" list="artifact-editor-list-1" name="artifact-editor-releaser1" id="artifact-editor-releaser-1" autocomplete="off"
                  aria-describedby="artifact-editor-releasers-help" placeholder="example: Razor 1911" class="form-control{{if eq $rel1 ""}} is-invalid{{end}}" 
                  value="{{$rel1}}" data-reset-rel1="{{$rel1}}"
                  hx-post="/uploader/releaser/1" 
                  hx-trigger="keyup[checkUserKeydown.call(this, event)] changed delay:{{$delay}}"
                  hx-target="#artifact-editor-list-1" minlength="2" maxlength="100" required>
              <span class="input-group-text">+</span>
              <input type="text" list="artifact-editor-list-2" name="artifact-editor-releaser2" id="artifact-editor-releaser-2" autocomplete="off"
                  aria-describedby="artifact-editor-releasers-help" placeholder="example: Titan" class="form-control" 
                  value="{{$rel2}}" data-reset-rel2="{{$rel2}}"
                  hx-post="/uploader/releaser/2" 
                  hx-trigger="keyup[checkUserKeydown.call(this, event)] changed delay:{{$delay}}"
                  hx-target="#artifact-editor-list-2" minlength="2" maxlength="100">
            </div>
            </form>
            <datalist id="artifact-editor-list-1"></datalist>
            <datalist id="artifact-editor-list-2"></datalist>            
            <div id="artifact-editor-releasers-error" class="invalid-feedback{{if eq $rel1 ""}} d-block{{end}}">
              A releaser is required, for example: <q>Razor 1911</q>.
            </div>
            <div id="artifact-editor-releasers-help" class="form-text">
              A releaser can be a group name, bbs name or ftp site.<br> 
              A bbs name or ftp site must end with <q>BBS</q> or <q>FTP</q>,
              for example: <q>Dark Domain BBS</q> or <q>Dark Domain FTP</q>.
            </div>
            <div class="btn-group" role="group">
              <button class="btn btn-link" type="button" id="artifact-editor-releaser-reset"
              hx-post="/editor/releasers/reset"
              hx-include="[name='artifact-editor-key'],[name='artifact-editor-releaser1'],[name='artifact-editor-releaser2']"
              hx-vals='{"releaser1": "{{$rel1}}","releaser2": "{{$rel2}}"}'>Reset releasers <small>to <q>{{$rel1}}</q>+<q>{{$rel2}}</q></small></button>
            </div>
          </div>
        </div>
        <div class="row">
          {{- /*  Date of release  */}}
          <div class="col-xl-10 offset-xl-1">
            <label class="form-label col-form-label-lg">Date of release</label>
            <div class="btn-toolbar" role="toolbar">
              <div class="input-group">
                <span class="input-group-text">Year of release</span>
                <input type="number" name="artifact-editor-year" min="1980" max="{{exampleYear}}" 
                  id="artifact-editor-year" aria-label="Year of release" class="form-control input-date" 
                  value="{{index . "modYear"}}" data-reset-year="{{index . "modYear"}}" placeholder="{{exampleYear}}">
                <span class="input-group-text">Month</span>
                <input type="number" name="artifact-editor-month" min="1" max="12" 
                  id="artifact-editor-month" aria-label="Month of release" class="form-control input-date" 
                  value="{{index . "modMonth"}}" data-reset-month="{{index . "modMonth"}}" placeholder="{{exampleMonth}}">
                <span class="input-group-text">Day</span>
                <input type="number" name="artifact-editor-day" min="1" max="31" 
                  id="artifact-editor-day" aria-label="Day of release" class="form-control input-date" 
                  value="{{index . "modDay"}}" data-reset-day="{{index . "modDay"}}" placeholder="{{exampleDay}}">
              </div>
              <div class="btn-group" role="group" aria-label="First group">
                <button type="button" class="btn btn-link">Reset date</button>
                <button type="button" class="btn btn-link">Use artifact last modification date</button>
              </div>
            </div>
          </div>
        </div>
        <div class="row col-xl-10 offset-xl-1 mt-3">
          {{- /*  Creators  */}}
          <label class="form-label col-form-label-lg">Creators</label>
          <div class="input-group mb-1">
            <div class="form-floating">
              <input type="text" class="form-control" id="artifact-editor-credit-text" autocomplete="off" maxlength="1024"
                value="{{index . "writers"}}" data-reset-credit-text="{{index . "writers"}}" placeholder="example: Name">
              <label for="artifact-editor-credit-text">Writers</label>
            </div>
            <div class="form-floating">
              <input type="text" class="form-control" id="artifact-editor-credit-ill" autocomplete="off" maxlength="1024"
                value="{{index . "artists"}}" data-reset-credit-ill="{{index . "artists"}}" placeholder="example: Name">
              <label for="artifact-editor-credit-ill">Visual artists</label>
            </div>
          </div>
          <div class="input-group">
            <div class="form-floating">
              <input type="text" class="form-control" id="artifact-editor-credit-prog" autocomplete="off" maxlength="100" 
                value="{{index . "programmers"}}" data-reset-credit-prog="{{index . "programmers"}}" placeholder="example: Name">
              <label for="artifact-editor-credit-prog">Programmers</label>
            </div>
            <div class="form-floating">
              <input type="text" class="form-control" id="artifact-editor-credit-audio" autocomplete="off" maxlength="100"
                value="{{index . "musicians"}}" data-reset-credit-audio="{{index . "musicians"}}" placeholder="example: Name">
              <label for="artifact-editor-credit-audio">Musicians</label>
            </div>
          </div>
          <div class="form-text">Join multiple creators with commas, for example: <q>Name,Name two,Name3</q>.</div>
        </div>
        {{/*  Comments  */}}
        <div class="row col-xl-10 offset-xl-1 mt-3 pb-3">
          <label class="form-label col-form-label-lg">Comment</label>
          <div>
            <textarea class="form-control" id="artifact-editor-comment" style="height:6em;" 
              aria-describedby="artifact-editor-comment-help">{{index . "comment"}}</textarea>
            <div class="form-text" id="artifact-editor-comment-help">Optional, comments can be used to store longer form notes about the artifact.</div>
          </div>
        </div>
        {{- /*  Links  */}}
        <hr>
        <div class="row mt-3">
          <label class="form-label col-form-label-lg">Links</label>
          <div class="col-xl-2">
            <div class="form-floating">
              <input type="text" class="form-control" id="artifact-editor-youtube" autocomplete="off" maxlength="11" minlength="11"
                value="{{index . "youtube"}}" data-reset-youtube="{{index . "youtube"}}" placeholder="62BuDfBIcMo">
              <label for="artifact-editor-youtube">YouTube ID</label>
            </div>
          </div>
          <div class="col-xl-2">
            <div class="form-floating">
              <input type="number" min="1" max="{{ demozooSanity }}" class="form-control" id="artifact-editor-demozoo" 
                value="{{index . "demozoo"}}" data-reset-demozoo="{{index . "demozoo"}}" placeholder="185828">
              <label for="artifact-editor-demozoo">Demozoo prod</label>
            </div>
          </div>
          <div class="col-xl-2">
            <div class="form-floating">
              <input type="number" min="1" max="{{ pouetSanity }}" class="form-control" id="artifact-editor-pouet" 
                value="{{index . "pouet"}}" data-reset-pouet="{{index . "pouet"}}" placeholder="75854">
              <label for="artifact-editor-pouet">Pouet prod</label>
            </div>
          </div>
          <div class="col-xl-3">
            <div class="form-floating">
              <input type="text" class="form-control" id="artifact-editor-16colors" autocomplete="off" maxlength="1024" 
                value="{{index . "sixteenColors"}}" data-reset-16colors="{{index . "sixteenColors"}}" placeholder="/tags/magazine/dreadloc">
              <label for="artifact-editor-16colors">16colors partial</label>
            </div>
          </div>
          <div class="col-xl-3">
            <div class="form-floating">
              <input type="text" class="form-control" id="artifact-editor-github" autocomplete="off" maxlength="1024"
                value="{{index . "github"}}" data-reset-github="{{index . "github"}}" placeholder="/Defacto2/database">
              <label for="artifact-editor-github">GitHub repo</label>
            </div>
          </div>
        </div>
        <div class="row mt-1 pb-3">
          <div class="col-xl-6">
            <div class="form-floating">
            <input type="text" class="form-control" id="artifact-editor-link-releasers" autocomplete="off" maxlength="255"
              value="{{index . "listReleases"}}" data-reset-linkreleases="{{index . "listReleases"}}"  
              placeholder="example: NFO;9f1c2" aria-describedby="artifact-editor-link-releasers-help">
            <label for="artifact-editor-link-releasers">Link to releases</label>
            </div>
            <div class="form-text" id="artifact-editor-link-releasers-help">Brief description and file ID, for example: <q>NFO;<a href="/f/9f1c2">9f1c2</a>|Intro;<a href="/f/a92116e">a92116e</a></q>.</div>
          </div>
          <div class="col-xl-6">
            <div class="form-floating">
            <input type="text" class="form-control" id="artifact-editor-link-websites" autocomplete="off" maxlength="2048" 
              value="{{index . "listWebsites"}}" data-reset-linkwebsites="{{index . "listWebsites"}}" 
              placeholder="Web;example.com" aria-describedby="artifact-editor-link-websites-help">
            <label for="artifact-editor-link-websites">Link to websites</label>
            </div>
            <div class="form-text" id="artifact-editor-link-websites-help">Brief description and link, for example: <q>Web;<a href="https://example.com">example.com</a>|Docs;<a href="https://docs.example.com">docs.example.com</a></q>.</div>
          </div>
        </div>
      </div>
      {{/*  Switch to assets and reset buttons  */}}
      <div class="modal-footer g-3 mt-1">
        <div class="row col-12">
        <div class="col-md-4 text-start">
          <button type="button" class="btn btn-warning">Permenently delete record</button>
        </div>
        <div class="col-md-8 text-end">
          <button class="btn btn-dark">Data editor*</button>
          <button class="btn btn-primary" data-bs-target="#assetEditorModal" data-bs-toggle="modal">File assets editor</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div></div>
      </div>
    </div>
  </div>
</div>
{{- end}}
{{- end}}